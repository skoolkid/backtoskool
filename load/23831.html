<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 23831</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="load-Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Load routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-0">Prev: <a class="link" href=""></a></span></td>
<td class="up">Up: <a class="link" href="load.html#23831">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="32768.html">32768</a></span></td>
</tr>
</table>
<div class="description">23831: After the program 'bak2skool' has loaded, this is where it all starts...</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="loader" src="../images/scr/loader.gif" /></td>
<td class="" colspan="1" rowspan="1">This is the initial loader program for Back to Skool (as it appears after doing 'POKE 23762,0' to change the INK for the BASIC listing from white to black). Don't be fooled by the 'RANDOMIZE USR 23794': the floating point number stored underneath is actually 23831.</td>
</tr>
</table>
</div>
<div class="paragraph">
Entering the code here from BASIC means that <span class="register">C</span>=23 (the LSB of 23831); this value is used later on in the routine at <a class="link" href="32815.html">32815</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23831"></a>23831</td>
<td class="instruction">DI</td>
<td class="comment-11" rowspan="1">Disable interrupts</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23832"></a>23832</td>
<td class="instruction">LD B,49</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23834"></a>23834</td>
<td class="instruction">LD DE,65487</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23837"></a>23837</td>
<td class="instruction">CALL 24046</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="24046"></a>
<div class="comments">
<div class="paragraph">
And so begins the misdirection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24046"></a>24046</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23840</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24047"></a>24047</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23791</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24048"></a>24048</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24049"></a>24049</td>
<td class="instruction">LD DE,7</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24052"></a>24052</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23798</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24053"></a>24053</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Jump to 23791</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="23791"></a>
<div class="comments">
<div class="paragraph">
Undo some code obfuscation before continuing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23791"></a>23791</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="6">Do some XORing on the 49 bytes from 23798 to 23846</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23792"></a>23792</td>
<td class="instruction">XOR H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23793"></a>23793</td>
<td class="instruction">XOR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23794"></a>23794</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23795"></a>23795</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23796"></a>23796</td>
<td class="instruction">DJNZ 23791</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="23798"></a>
<div class="comments">
<div class="paragraph">
After the XORing:
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23798"></a>23798</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23799"></a>23799</td>
<td class="instruction">EX (SP),HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL'</span>=11563</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23800"></a>23800</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=45</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23801"></a>23801</td>
<td class="instruction">AND L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=41</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23802"></a>23802</td>
<td class="instruction">ADD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=84</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23803"></a>23803</td>
<td class="instruction">ADD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=127</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23804"></a>23804</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1"><span class="register">H'</span>=127</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23805"></a>23805</td>
<td class="instruction">ADD A,78</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=205</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23807"></a>23807</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">HL'</span>=32717</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23808"></a>23808</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23809"></a>23809</td>
<td class="instruction">LD HL,23551</td>
<td class="comment-11" rowspan="5">INK 1: PAPER 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23812"></a>23812</td>
<td class="instruction">LD (HL),9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23814"></a>23814</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23815"></a>23815</td>
<td class="instruction">BIT 3,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23817"></a>23817</td>
<td class="instruction">JR NZ,23812</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23819"></a>23819</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-11" rowspan="4">Clear the display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23821"></a>23821</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23822"></a>23822</td>
<td class="instruction">BIT 6,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23824"></a>23824</td>
<td class="instruction">JR NZ,23819</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23826"></a>23826</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="2"><span class="register">DE</span>=9</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23827"></a>23827</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23828"></a>23828</td>
<td class="instruction">CALL 24046</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="24046"></a>
<div class="comments">
<div class="paragraph">
More misdirection.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24046"></a>24046</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23831</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24047"></a>24047</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23840</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24048"></a>24048</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24049"></a>24049</td>
<td class="instruction">LD DE,7</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24052"></a>24052</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23847</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24053"></a>24053</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Jump to 23840</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="23840"></a>
<div class="comments">
<div class="paragraph">
Undo some more code obfuscation before continuing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23840"></a>23840</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="6">Do some XORing and RLCing on the 217 bytes from 23847 to 24063</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23841"></a>23841</td>
<td class="instruction">XOR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23842"></a>23842</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23843"></a>23843</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23844"></a>23844</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23845"></a>23845</td>
<td class="instruction">JR NZ,23840</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="23847"></a>
<div class="comments">
<div class="paragraph">
After the XORing and RLCing:
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="23847"></a>23847</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=23808</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23848"></a>23848</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23849"></a>23849</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1"><span class="register">DE'</span>=23808</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23850"></a>23850</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">DE'</span>=32717</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23851"></a>23851</td>
<td class="instruction">LD BC,255</td>
<td class="comment-11" rowspan="2">Copy 255 bytes from 23808-24062 to 32717-32971</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23854"></a>23854</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23856"></a>23856</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E'</span>=47</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23857"></a>23857</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">HL'</span>=32815</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="23858"></a>23858</td>
<td class="instruction">JP (HL)</td>
<td class="comment-11" rowspan="1">Jump to <a class="link" href="32815.html">32815</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-0">Prev: <a class="link" href=""></a></span></td>
<td class="up">Up: <a class="link" href="load.html#23831">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="32768.html">32768</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>