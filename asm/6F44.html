<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 6F44</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F2C.html">6F2C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f44">Map</a></td>
<td class="next">
Next: <a href="6FA0.html">6FA0</a>
</td>
</tr>
</table>
<div class="description">6F44: 'Q' pressed - up</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this routine is found in the table of keypress handling routines at <a href="E550.html">E550</a>. It is called from the main loop at <a href="F6EA.html">F6EA</a> when 'Q' or '7' is pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f44"></span>6F44</td>
<td class="instruction">CALL <a href="6E50.html">$6E50</a></td>
<td class="comment-1" rowspan="1">Check whether ERIC is on a staircase</td>
</tr>
<tr>
<td class="address-1"><span id="6f47"></span>6F47</td>
<td class="instruction">LD L,$00</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0x00 of ERIC's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="6f49"></span>6F49</td>
<td class="instruction">JR C,$6F99</td>
<td class="comment-1" rowspan="1">Jump if ERIC's on a staircase</td>
</tr>
<tr>
<td class="address-1"><span id="6f4b"></span>6F4B</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Check the 'direction' bit of ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="6f4d"></span>6F4D</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f4e"></span>6F4E</td>
<td class="instruction">JR Z,$6F7C</td>
<td class="comment-1" rowspan="1">Jump if ERIC's facing left</td>
</tr>
<tr>
<td class="address-1"><span id="6f50"></span>6F50</td>
<td class="instruction">CP $0A</td>
<td class="comment-1" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="6f52"></span>6F52</td>
<td class="instruction">JR Z,$6F77</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="6f54"></span>6F54</td>
<td class="instruction">CP $0E</td>
<td class="comment-1" rowspan="1">Is ERIC on the assembly hall stage?</td>
</tr>
<tr>
<td class="address-1"><span id="6f56"></span>6F56</td>
<td class="instruction">JR Z,$6F72</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="6f58"></span>6F58</td>
<td class="instruction">CP $11</td>
<td class="comment-1" rowspan="1">Is ERIC on the bottom floor?</td>
</tr>
<tr>
<td class="address-2"><span id="6f5a"></span>6F5A</td>
<td class="instruction">JP NZ,<a href="6F14.html#6f21">$6F21</a></td>
<td class="comment-1" rowspan="1">Move ERIC one space to the right if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f5d"></span>6F5D</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f5e"></span>6F5E</td>
<td class="instruction">CP $B0</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the middle floor of the girls' skool</td>
</tr>
<tr>
<td class="address-2"><span id="6f60"></span>6F60</td>
<td class="instruction">JR NZ,$6F5A</td>
<td class="comment-1" rowspan="1">Jump if ERIC is not at that point</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f62"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="6E9B.html">6E9B</a>, <a href="6F14.html">6F14</a> and <a href="6F2C.html">6F2C</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f62"></span>6F62</td>
<td class="instruction">DEC D</td>
<td class="comment-1" rowspan="1">Up a stair</td>
</tr>
<tr>
<td class="address-1"><span id="6f63"></span>6F63</td>
<td class="instruction">LD B,D</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=ERIC's post-midstride y-coordinate</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f64"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6FA0.html">6FA0</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f64"></span>6F64</td>
<td class="instruction">LD A,($D200)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="6f67"></span>6F67</td>
<td class="instruction">LD C,E</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=ERIC's current x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f68"></span>6F68</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-1" rowspan="1">Is ERIC facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="6f6a"></span>6F6A</td>
<td class="instruction">JR Z,$6F6E</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="6f6c"></span>6F6C</td>
<td class="instruction">INC C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="6f6d"></span>6F6D</td>
<td class="instruction">INC C</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="6f6e"></span>6F6E</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=ERIC's post-midstride x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f6f"></span>6F6F</td>
<td class="instruction">JP <a href="6DD2.html">$6DD2</a></td>
<td class="comment-1" rowspan="1">Put ERIC midstride</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f72"></span>
<div class="comments">
<div class="paragraph">
ERIC is on the assembly hall stage, facing right.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f72"></span>6F72</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f73"></span>6F73</td>
<td class="instruction">CP $51</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up from the stage to the middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="6f75"></span>6F75</td>
<td class="instruction">JR $6F60</td>
<td class="comment-1" rowspan="1">Move ERIC up a stair if he's here</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f77"></span>
<div class="comments">
<div class="paragraph">
ERIC is on the middle floor, facing right.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f77"></span>6F77</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f78"></span>6F78</td>
<td class="instruction">CP $13</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the Revision Library</td>
</tr>
<tr>
<td class="address-1"><span id="6f7a"></span>6F7A</td>
<td class="instruction">JR $6F60</td>
<td class="comment-1" rowspan="1">Move ERIC up a stair if he's here</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f7c"></span>
<div class="comments">
<div class="paragraph">
ERIC is facing left.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f7c"></span>6F7C</td>
<td class="instruction">CP $0A</td>
<td class="comment-1" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="6f7e"></span>6F7E</td>
<td class="instruction">JR NZ,$6F8C</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f80"></span>6F80</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f81"></span>6F81</td>
<td class="instruction">CP $5B</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the head's study</td>
</tr>
<tr>
<td class="address-1"><span id="6f83"></span>6F83</td>
<td class="instruction">JR Z,$6F62</td>
<td class="comment-1" rowspan="1">Move ERIC up a stair if he's here</td>
</tr>
<tr>
<td class="address-1"><span id="6f85"></span>6F85</td>
<td class="instruction">CP $BA</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the top floor of the girls' skool</td>
</tr>
<tr>
<td class="address-2"><span id="6f87"></span>6F87</td>
<td class="instruction">JP NZ,<a href="6F2C.html#6f39">$6F39</a></td>
<td class="comment-1" rowspan="1">Move ERIC one space left if he's not here</td>
</tr>
<tr>
<td class="address-1"><span id="6f8a"></span>6F8A</td>
<td class="instruction">JR $6F62</td>
<td class="comment-1" rowspan="1">Otherwise move him up a stair</td>
</tr>
<tr>
<td class="address-2"><span id="6f8c"></span>6F8C</td>
<td class="instruction">CP $11</td>
<td class="comment-1" rowspan="1">Is ERIC on the bottom floor?</td>
</tr>
<tr>
<td class="address-1"><span id="6f8e"></span>6F8E</td>
<td class="instruction">JR NZ,$6F87</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="6f90"></span>6F90</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="6f91"></span>6F91</td>
<td class="instruction">CP $16</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the middle floor at the far left of the boys' skool</td>
</tr>
<tr>
<td class="address-1"><span id="6f93"></span>6F93</td>
<td class="instruction">JR Z,$6F62</td>
<td class="comment-1" rowspan="1">Move ERIC up a stair if he's here</td>
</tr>
<tr>
<td class="address-1"><span id="6f95"></span>6F95</td>
<td class="instruction">CP $53</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the bottom of the stairs leading up to the assembly hall stage</td>
</tr>
<tr>
<td class="address-1"><span id="6f97"></span>6F97</td>
<td class="instruction">JR $6F87</td>
<td class="comment-1" rowspan="1">Move ERIC up a stair if he's here</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6f99"></span>
<div class="comments">
<div class="paragraph">
ERIC is on a staircase.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="6f99"></span>6F99</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-1" rowspan="2">Set the carry flag if ERIC is facing the wrong way to ascend the stairs</td>
</tr>
<tr>
<td class="address-1"><span id="6f9a"></span>6F9A</td>
<td class="instruction">RLA</td>
</tr>
<tr>
<td class="address-1"><span id="6f9b"></span>6F9B</td>
<td class="instruction">JP C,<a href="6E38.html">$6E38</a></td>
<td class="comment-1" rowspan="1">Turn ERIC round if he's facing the wrong way</td>
</tr>
<tr>
<td class="address-1"><span id="6f9e"></span>6F9E</td>
<td class="instruction">JR $6F62</td>
<td class="comment-1" rowspan="1">Make ERIC go up a stair otherwise</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6F2C.html">6F2C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6f44">Map</a></td>
<td class="next">
Next: <a href="6FA0.html">6FA0</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20221122</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/28484.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>