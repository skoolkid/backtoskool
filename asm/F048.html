<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at F048</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F046.html">F046</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f048">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F05D.html">F05D</a></span></td>
</tr>
</table>
<div class="description">F048: Check whether ERIC and EINSTEIN are in class</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F100.html">F100</a>. If EINSTEIN is in class, this routine returns to the caller with the zero flag set if and only if ERIC is present too. If EINSTEIN is not yet sitting down in class, it makes the teacher wait until he shows up.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Teacher's character number (0xC9-0xCB)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f048"></span>F048</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,($D000)</td>
<td class="comment-11" rowspan="1">Pick up EINSTEIN's current animatory state in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f04b"></span>F04B</td>
<td class="bytes-0"></td>
<td class="instruction">CP $34</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#52">0x34</a>: Is EINSTEIN sitting down (i.e. in class)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f04d"></span>F04D</td>
<td class="bytes-0"></td>
<td class="instruction">JP Z,<a href="7D15.html">$7D15</a></td>
<td class="comment-11" rowspan="1">Check on ERIC if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f050"></span>F050</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,$FFFD</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=-3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f053"></span>F053</td>
<td class="bytes-0"></td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Drop the return address from the stack into <span class="register">BC</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f054"></span>F054</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="3">Set <span class="register">DE</span> to the address of the CALL <a href="F048.html">F048</a> instruction in the calling routine</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f055"></span>F055</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f056"></span>F056</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f057"></span>F057</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$03</td>
<td class="comment-11" rowspan="4">Place this address into bytes 0x03 and 0x04 of the teacher's buffer, so that we keep returning here (and the teacher stands still) until EINSTEIN arrives in class</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f059"></span>F059</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f05a"></span>F05A</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f05b"></span>F05B</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f05c"></span>F05C</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return to the character-moving routine at <a href="62D0.html">62D0</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F046.html">F046</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f048">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F05D.html">F05D</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20190617</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../dec/asm/61512.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>