<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at F818</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F80D.html">F80D</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f818">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F841.html">F841</a></span></td>
</tr>
</table>
<div class="description">F818: Scroll the display file left or right one column</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F849.html">F849</a>. Returns with the column of the play area that was at the far left of the screen before this routine was called in <span class="register">A</span>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">4000 or 401F</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f818"></span>F818</td>
<td class="instruction">LD B,$00</td>
<td class="comment-11" rowspan="1"><span class="register">BC</span> will be used as the counter for the LDIR/LDDR instruction at <a href="F818.html#f826">F826</a>; initialise the MSB to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f81a"></span>F81A</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f81b"></span>F81B</td>
<td class="instruction">LD C,$15</td>
<td class="comment-11" rowspan="1">There are 21 rows to scroll (the bottom 3 rows of the screen are fixed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f81d"></span>F81D</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="1">8 pixel lines per row of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f81f"></span>F81F</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f820"></span>F820</td>
<td class="instruction">LD H,D</td>
<td class="comment-11" rowspan="2">Copy the display file address from <span class="register">DE</span> to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f821"></span>F821</td>
<td class="instruction">LD L,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f822"></span>F822</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">This instruction is set to INC L if we're scrolling to the left, or DEC L if we're scrolling to the right (see <a href="F849.html">F849</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f823"></span>F823</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Save the LSB of the display file address in <span class="register">A</span> briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f824"></span>F824</td>
<td class="instruction">LD C,$1F</td>
<td class="comment-11" rowspan="1">31 bytes to shift per pixel line</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f826"></span>F826</td>
<td class="instruction">LDIR</td>
<td class="comment-11" rowspan="1">This instruction is set to LDIR if we're shifting to the left, or LDDR if we're shifting to the right (see <a href="F849.html">F849</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f828"></span>F828</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Restore the LSB of the display file address to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f829"></span>F829</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the first (or last) byte of the next pixel line in this row</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f82a"></span>F82A</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f82b"></span>F82B</td>
<td class="instruction">DJNZ $F81F</td>
<td class="comment-11" rowspan="1">Shift the remaining pixel lines in this row</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f82d"></span>F82D</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f82e"></span>F82E</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">Set <span class="register">E</span> to the LSB of the display file address for the first (or last) byte of the first pixel line in the next row down</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f82f"></span>F82F</td>
<td class="instruction">ADD A,$20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f831"></span>F831</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f832"></span>F832</td>
<td class="instruction">JR C,$F838</td>
<td class="comment-11" rowspan="1">Jump if we just finished shifting the eighth or sixteenth row</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f834"></span>F834</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="3">Adjust <span class="register">D</span> appropriately in the case where we haven't finished with the current 8-row third of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f835"></span>F835</td>
<td class="instruction">SUB $08</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f837"></span>F837</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f838"></span>F838</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f839"></span>F839</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Next row</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f83a"></span>F83A</td>
<td class="instruction">JR NZ,$F81D</td>
<td class="comment-11" rowspan="1">Jump back until all 21 rows have been shifted</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f83c"></span>F83C</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f83d"></span>F83D</td>
<td class="instruction">LD A,($7FFF)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=column of the play area (that was) at the far left of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f840"></span>F840</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F80D.html">F80D</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f818">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F841.html">F841</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20181019</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/back_to_skool/asm/63512.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>