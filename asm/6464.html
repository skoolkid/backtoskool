<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 6464</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="6463.html">6463</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6464">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="64D4.html">64D4</a></span></td>
</tr>
</table>
<div class="description">6464: Make a character go to a location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by command lists <a href="C93C.html">0</a>, <a href="CA3C.html">2</a>, <a href="CB3C.html">4</a>, <a href="CC3C.html">6</a>, <a href="CD3C.html">8</a>, <a href="CE3C.html">10</a>, <a href="CF3C.html">12</a>, <a href="D03C.html">14</a>, <a href="D13C.html">16</a>, <a href="E256.html">20</a>, <a href="E400.html">22</a>, <a href="E600.html">24</a>, <a href="E700.html">26</a>, <a href="E264.html">28</a>, <a href="E272.html">30</a>, <a href="E590.html">32</a>, <a href="E59B.html">34</a>, <a href="E5AE.html">36</a>, <a href="E5BD.html">38</a>, <a href="E70F.html">40</a>, <a href="E5DC.html">44</a>, <a href="E860.html">46</a>, <a href="E86B.html">48</a>, <a href="E87F.html">50</a>, <a href="E88A.html">52</a>, <a href="E89E.html">54</a>, <a href="E8C0.html">56</a>, <a href="E8DC.html">58</a>, <a href="E8ED.html">60</a>, <a href="E8FE.html">62</a>, <a href="E90F.html">64</a>, <a href="E919.html">66</a>, <a href="E921.html">70</a>, <a href="E933.html">72</a>, <a href="E943.html">74</a>, <a href="E94C.html">76</a>, <a href="E975.html">78</a>, <a href="E98C.html">80</a>, <a href="E999.html">82</a>, <a href="E9A4.html">84</a>, <a href="E9AF.html">86</a> and <a href="E5EE.html">88</a> to make a character go to a specified place.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (183-209)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6464"></span>6464</td>
<td class="instruction">LD L,$05</td>
<td class="comment-11" rowspan="2">Copy the destination coordinates from the command list into bytes 5 and 6 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6466"></span>6466</td>
<td class="instruction">CALL <a href="6264.html">$6264</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6469"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="64D7.html">64D7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6469"></span>6469</td>
<td class="instruction">LD L,$03</td>
<td class="comment-11" rowspan="2">Replace the address of this routine in bytes 3 and 4 of the character's buffer with <a href="6464.html#647e">647E</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="646b"></span>646B</td>
<td class="instruction">LD (HL),$7E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="646d"></span>646D</td>
<td class="instruction">LD L,$00</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="646f"></span>646F</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6470"></span>6470</td>
<td class="instruction">AND $07</td>
<td class="comment-11" rowspan="2">Is the character sitting on a chair (kids only)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6472"></span>6472</td>
<td class="instruction">CP $04</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6474"></span>6474</td>
<td class="instruction">JR NZ,$647E</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6476"></span>
<div class="comments">
<div class="paragraph">
The character is sitting on a chair. He'll have to stand up first.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6476"></span>6476</td>
<td class="instruction">CALL <a href="61B4.html">$61B4</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the character's current animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6479"></span>6479</td>
<td class="instruction">AND $F8</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of the character standing up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="647b"></span>647B</td>
<td class="instruction">JP <a href="6130.html">$6130</a></td>
<td class="comment-11" rowspan="1">Update the character's animatory state and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="647e"></span>
<div class="comments">
<div class="paragraph">
The second and subsequent calls to this routine (from <a href="62D0.html">62D0</a>) enter here:
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="647e"></span>647E</td>
<td class="instruction">LD L,$06</td>
<td class="comment-11" rowspan="4">Collect the destination coordinates into <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6480"></span>6480</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6481"></span>6481</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6482"></span>6482</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6483"></span>6483</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6485"></span>6485</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's current x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6486"></span>6486</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Compare it with the x-coordinate of the destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6487"></span>6487</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6488"></span>6488</td>
<td class="instruction">JR NZ,$648F</td>
<td class="comment-11" rowspan="1">Jump forward unless the character's current x-coordinate matches that of the destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="648a"></span>648A</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's current y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="648b"></span>648B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character already at his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="648c"></span>648C</td>
<td class="instruction">JP Z,<a href="638C.html">$638C</a></td>
<td class="comment-11" rowspan="1">Move to the next command in the command list if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="648f"></span>
<div class="comments">
<div class="paragraph">
The character hasn't reached his destination yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="648f"></span>648F</td>
<td class="instruction">CALL <a href="63D2.html">$63D2</a></td>
<td class="comment-11" rowspan="1">Get the region identifier for the character's destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6492"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">A</span> holds a region ID (189-196) corresponding to the character's destination:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">Region</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">Top floor, left of the left study door in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">190</td>
<td class="" colspan="1" rowspan="1">Middle floor, left of the far wall of the Science Lab storeroom</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">Bottom floor (anywhere)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">192</td>
<td class="" colspan="1" rowspan="1">Assembly hall stage</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">Near the middle-floor window in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">194</td>
<td class="" colspan="1" rowspan="1">Top floor, right of the left study door in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">Middle floor, girls' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">Top floor, girls' skool</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6492"></span>6492</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="3">Collect the character's current coordinates into <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6493"></span>6493</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6494"></span>6494</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6495"></span>6495</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=destination region ID (189-196)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6496"></span>6496</td>
<td class="instruction">CALL <a href="63D2.html">$63D2</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=region ID (189-196) for the character's current location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6499"></span>6499</td>
<td class="instruction">CP L</td>
<td class="comment-11" rowspan="1">Will the character have to negotiate any staircases in order to reach his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="649a"></span>649A</td>
<td class="instruction">JR Z,$64C8</td>
<td class="comment-11" rowspan="1">Jump if not (he's in the same region as his destination)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="649c"></span>649C</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=region ID of the character's current location (189-196)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="649d"></span>649D</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=destination region ID (189-196)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="649e"></span>649E</td>
<td class="instruction">SUB $81</td>
<td class="comment-11" rowspan="2"><span class="register">E</span>=destination region ID minus 129 (60-67)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a0"></span>64A0</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a1"></span>64A1</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Collect the appropriate staircase endpoint identifier</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="64a2"></span>
<div class="comments">
<div class="paragraph">
<span id="staircaseMatrix" /> The staircase endpoint identifiers are arranged in bytes 60-67 (corresponding to the destination) of pages 189-196 (corresponding to the current location) as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<td class="transparent" colspan="2" rowspan="1"></td>
<th colspan="1" rowspan="1">189</th>
<th colspan="1" rowspan="1">190</th>
<th colspan="1" rowspan="1">191</th>
<th colspan="1" rowspan="1">192</th>
<th colspan="1" rowspan="1">193</th>
<th colspan="1" rowspan="1">194</th>
<th colspan="1" rowspan="1">195</th>
<th colspan="1" rowspan="1">196</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="BD3C.html">BD3C</a></td>
<th colspan="1" rowspan="1">189</th>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="BE3C.html">BE3C</a></td>
<th colspan="1" rowspan="1">190</th>
<td class="" colspan="1" rowspan="1">190</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="BF3C.html">BF3C</a></td>
<th colspan="1" rowspan="1">191</th>
<td class="" colspan="1" rowspan="1">192</td>
<td class="" colspan="1" rowspan="1">192</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">194</td>
<td class="" colspan="1" rowspan="1">194</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="C03C.html">C03C</a></td>
<th colspan="1" rowspan="1">192</th>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="C13C.html">C13C</a></td>
<th colspan="1" rowspan="1">193</th>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">198</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="C23C.html">C23C</a></td>
<th colspan="1" rowspan="1">194</th>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="C33C.html">C33C</a></td>
<th colspan="1" rowspan="1">195</th>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">206</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="C43C.html">C43C</a></td>
<th colspan="1" rowspan="1">196</th>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="transparent" colspan="1" rowspan="1"></td>
</tr>
</table>
</div>
<div class="paragraph">
<span id="staircases" /> The staircase endpoint indentifier now in <span class="register">A</span> (189-200, 206 or 207) corresponds to the top or bottom of the first staircase the character will have to negotiate in order to reach his destination. The x-coordinate (x), direction indicator (d), appropriate routine address LSB (56 for <a href="6438.html">6438</a>, 77 for <a href="644D.html">644D</a>) and number of steps (n) for the staircase can be found in bytes 68-71 of pages 189-200 and 206-207, as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">x</th>
<th colspan="1" rowspan="1">d</th>
<th colspan="1" rowspan="1">LSB</th>
<th colspan="1" rowspan="1">n</th>
<th colspan="1" rowspan="1">Staircase endpoint</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="BD44.html">189</a></td>
<td class="centre" colspan="1" rowspan="1">26</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the Revision Library</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="BE44.html">190</a></td>
<td class="centre" colspan="1" rowspan="1">19</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the Revision Library</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="BF44.html">191</a></td>
<td class="centre" colspan="1" rowspan="1">15</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the bottom floor on the far left of the boys' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C044.html">192</a></td>
<td class="centre" colspan="1" rowspan="1">22</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the middle floor on the far left of the boys' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C144.html">193</a></td>
<td class="centre" colspan="1" rowspan="1">83</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C244.html">194</a></td>
<td class="centre" colspan="1" rowspan="1">176</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the middle floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C344.html">195</a></td>
<td class="centre" colspan="1" rowspan="1">80</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C444.html">196</a></td>
<td class="centre" colspan="1" rowspan="1">81</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up from the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C544.html">197</a></td>
<td class="centre" colspan="1" rowspan="1">85</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C644.html">198</a></td>
<td class="centre" colspan="1" rowspan="1">91</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the head's study</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C744.html">199</a></td>
<td class="centre" colspan="1" rowspan="1">84</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the head's study</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="C844.html">200</a></td>
<td class="centre" colspan="1" rowspan="1">183</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the bottom floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="CE44.html">206</a></td>
<td class="centre" colspan="1" rowspan="1">186</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the top floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="CF44.html">207</a></td>
<td class="centre" colspan="1" rowspan="1">179</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to middle floor in the girls' skool</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a2"></span>64A2</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Place the staircase endpoint identifier in <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a3"></span>64A3</td>
<td class="instruction">LD E,$44</td>
<td class="comment-11" rowspan="1">Byte 68 holds the x-coordinate of the top or bottom of the staircase identified by <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a5"></span>64A5</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="2">Point <span class="register">DE</span> at byte 1 of the character's buffer, and <span class="register">HL</span> at the staircase endpoint x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a7"></span>64A7</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a8"></span>64A8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's current x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64a9"></span>64A9</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character already at the top or bottom of the appropriate staircase?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64aa"></span>64AA</td>
<td class="instruction">JR NZ,$64C4</td>
<td class="comment-11" rowspan="1">Jump forward if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="64ac"></span>
<div class="comments">
<div class="paragraph">
At this stage the character is standing at the top or bottom of the first staircase he will have to negotiate in order to reach his destination.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ac"></span>64AC</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">(<span class="register">HL</span>)=0 if the character has to face left to ascend or descend the stairs, 128 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ad"></span>64AD</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ae"></span>64AE</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64af"></span>64AF</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-11" rowspan="2">Set the carry flag if the character has to turn round to negotiate the staircase</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b0"></span>64B0</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b1"></span>64B1</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> so that <span class="register">H</span> holds the character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b2"></span>64B2</td>
<td class="instruction">JP C,<a href="63ED.html#6430">$6430</a></td>
<td class="comment-11" rowspan="1">Turn the character round if he's facing the wrong way</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b5"></span>64B5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> back again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b6"></span>64B6</td>
<td class="instruction">LD E,$0B</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b8"></span>64B8</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=70</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64b9"></span>64B9</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="2"><span class="register">BC</span>=<a href="6438.html">6438</a> if the stairs are to be ascended, <a href="644D.html">644D</a> if descended</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ba"></span>64BA</td>
<td class="instruction">LD B,$64</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64bc"></span>64BC</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64bd"></span>64BD</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=71</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64be"></span>64BE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1 + number of steps in the staircase</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64bf"></span>64BF</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Place this number of steps in byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64c0"></span>64C0</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> so that <span class="register">H</span> holds the character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64c1"></span>64C1</td>
<td class="instruction">JP <a href="63B0.html">$63B0</a></td>
<td class="comment-11" rowspan="1">Copy the interruptible subcommand routine address from <span class="register">BC</span> into bytes 9 and 10 of the character's buffer and jump to it</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="64c4"></span>
<div class="comments">
<div class="paragraph">
The character is not yet at the top or bottom of the appropriate staircase.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="64c4"></span>64C4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the top or bottom of the staircase</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64c5"></span>64C5</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64c6"></span>64C6</td>
<td class="instruction">JR $64CB</td>
<td class="comment-11" rowspan="1">Send the character towards the staircase</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="64c8"></span>
<div class="comments">
<div class="paragraph">
The character can reach his destination without negotiating any staircases.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="64c8"></span>64C8</td>
<td class="instruction">LD L,$05</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 5 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ca"></span>64CA</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the character's destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="64cb"></span>64CB</td>
<td class="instruction">LD L,$0B</td>
<td class="comment-11" rowspan="2">Place the x-coordinate of the top or bottom of the staircase, or the destination, into byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64cd"></span>64CD</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64ce"></span>64CE</td>
<td class="instruction">LD BC,$63ED</td>
<td class="comment-11" rowspan="2">Place the address of the interruptible subcommand routine at <a href="63ED.html">63ED</a> into bytes 9 and 10 of the character's buffer and jump to it, thus guiding the character to this x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="64d1"></span>64D1</td>
<td class="instruction">JP <a href="63B0.html">$63B0</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="6463.html">6463</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6464">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="64D4.html">64D4</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20151012</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.1.</div>
</footer>
</body>
</html>