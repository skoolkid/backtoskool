<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 7CE1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7CD0.html">7CD0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7ce1">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7CFE.html">7CFE</a></span></td>
</tr>
</table>
<div class="description">7CE1: Make a character walk up and down a few times or until a certain time</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by command lists <a href="D23C.html">0x12</a>, <a href="E5CC.html">0x2A</a> and <a href="E5DC.html">0x2C</a> to make a character walk about a fixed location until a specified time, or until a certain number of walkabouts have been performed.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xB7-0xD1)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7ce1"></span>7CE1</td>
<td class="instruction">LD L,$06</td>
<td class="comment-11" rowspan="2">Collect the event ID (always 0, denoting the end of the lesson) and the maximum walkabout count from the command list and copy them into bytes 0x06 and 0x07 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ce3"></span>7CE3</td>
<td class="instruction">CALL <a href="6264.html">$6264</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7ce6"></span>7CE6</td>
<td class="instruction">LD L,$07</td>
<td class="comment-11" rowspan="2">Decrease the walkabout counter at byte 0x07 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ce8"></span>7CE8</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ce9"></span>7CE9</td>
<td class="instruction">JR NZ,$7CF9</td>
<td class="comment-11" rowspan="1">If the character has not yet performed the maximum number of walkabouts, check whether the specified time has arrived</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ceb"></span>7CEB</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Set the walkabout counter back to 1 to ensure that we return to this execution path next time (to check whether the character has returned to the walkabout origin)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7cec"></span>7CEC</td>
<td class="instruction">LD L,$05</td>
<td class="comment-11" rowspan="1">Byte 0x05 holds the x-coordinate of the walkabout origin</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7cee"></span>7CEE</td>
<td class="instruction">CALL <a href="7CAB.html#7cb4">$7CB4</a></td>
<td class="comment-11" rowspan="1">Reset the carry flag if the character is at the walkabout origin</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7cf1"></span>7CF1</td>
<td class="instruction">JP NC,<a href="638C.html">$638C</a></td>
<td class="comment-11" rowspan="1">Move to the next command in the command list if the specified time has arrived or the character has completed all his walkabouts</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7cf4"></span>7CF4</td>
<td class="instruction">CALL <a href="639F.html">$639F</a></td>
<td class="comment-11" rowspan="1">Otherwise send the character off to another walkabout destination via the routine at <a href="63ED.html">63ED</a>, and return to the instruction at <a href="7CE1.html#7cf7">7CF7</a> (below) when done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7cf7"></span>7CF7</td>
<td class="instruction">JR $7CE6</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7cf9"></span>7CF9</td>
<td class="instruction">CALL <a href="7CAB.html">$7CAB</a></td>
<td class="comment-11" rowspan="1">Reset the carry flag if the specified time has arrived and the character is at the walkabout origin</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7cfc"></span>7CFC</td>
<td class="instruction">JR $7CF1</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7CD0.html">7CD0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7ce1">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7CFE.html">7CFE</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20181019</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/back_to_skool/asm/31969.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>