<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 7EB1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7EB0.html">7EB0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7eb1">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7EEF.html">7EEF</a></span></td>
</tr>
</table>
<div class="description">7EB1: Print the lesson and ring the bell</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F74D.html">F74D</a>. Prints the lesson or 'DEMO.MODE' in the lesson box, and makes the bell sound effect.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7eb1"></span>7EB1</td>
<td class="instruction">LD HL,$7FDE</td>
<td class="comment-11" rowspan="1"><a href="7FDE.html">7FDE</a> holds the current game mode</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eb4"></span>7EB4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=255 if we're in demo mode, 0 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eb5"></span>7EB5</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Set the zero flag if we're in demo mode</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eb6"></span>7EB6</td>
<td class="instruction">LD A,$3F</td>
<td class="comment-11" rowspan="1">Message <a href="EA1C.html">63</a>: DEMO.MODE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eb8"></span>7EB8</td>
<td class="instruction">JR Z,$7EDE</td>
<td class="comment-11" rowspan="1">Jump if we're in demo mode</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7eba"></span>
<div class="comments">
<div class="paragraph">
A real game is in progress. First, figure out what to print in the bottom row of the lesson box (the room name, 'LIBRARY', 'PLAYTIME', 'ASSEMBLY' or 'DINNER').
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eba"></span>7EBA</td>
<td class="instruction">LD L,$E0</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FE0.html">7FE0</a> (lesson descriptor)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ebc"></span>7EBC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ebd"></span>7EBD</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">Keep only the room identifier bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ebf"></span>7EBF</td>
<td class="instruction">LD E,$20</td>
<td class="comment-11" rowspan="1">32 is the ASCII code for SPACE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ec1"></span>7EC1</td>
<td class="instruction">ADD A,$7E</td>
<td class="comment-11" rowspan="2"><span class="register">D</span>=message number for the text to go on the bottom row of the lesson box</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ec3"></span>7EC3</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ec4"></span>7EC4</td>
<td class="instruction">CP $83</td>
<td class="comment-11" rowspan="1">Is it PLAYTIME (<a href="EE57.html">128</a>), ASSEMBLY (<a href="EE60.html">129</a>) or DINNER (<a href="EE69.html">130</a>)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ec6"></span>7EC6</td>
<td class="instruction">JR C,$7ED6</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ec8"></span>7EC8</td>
<td class="instruction">LD E,$87</td>
<td class="comment-11" rowspan="1">Message <a href="EE9A.html">135</a>: REVISION</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eca"></span>7ECA</td>
<td class="instruction">JR Z,$7ED6</td>
<td class="comment-11" rowspan="1">Jump if it's REVISION LIBRARY (D=<a href="EE70.html">131</a>: LIBRARY)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7ecc"></span>
<div class="comments">
<div class="paragraph">
Next, figure out what to print (if anything) in the top row of the lesson box (the teacher's name, or 'REVISION').
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ecc"></span>7ECC</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=lesson descriptor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ecd"></span>7ECD</td>
<td class="instruction">AND $F0</td>
<td class="comment-11" rowspan="5">Keep only the teacher-identifying bits and push them into bits 0-3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ecf"></span>7ECF</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed0"></span>7ED0</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed1"></span>7ED1</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed2"></span>7ED2</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed3"></span>7ED3</td>
<td class="instruction">ADD A,$14</td>
<td class="comment-11" rowspan="2"><span class="register">E</span>=<a href="EF60.html">22</a>, <a href="EF6D.html">23</a> or <a href="EF7A.html">24</a> (teacher's name)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed5"></span>7ED5</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7ed6"></span>
<div class="comments">
<div class="paragraph">
Now we can construct message <a href="EA18.html">16</a> (teacher/room) ready for printing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7ed6"></span>7ED6</td>
<td class="instruction">LD L,$88</td>
<td class="comment-11" rowspan="2">Place the teacher message number (or ASCII code for SPACE) in <a href="7F88.html">7F88</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed8"></span>7ED8</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ed9"></span>7ED9</td>
<td class="instruction">LD L,$8A</td>
<td class="comment-11" rowspan="2">Place the room message number in <a href="7F8A.html">7F8A</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7edb"></span>7EDB</td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7edc"></span>7EDC</td>
<td class="instruction">LD A,$10</td>
<td class="comment-11" rowspan="1">Message <a href="EA18.html">16</a>: teacher/room</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7ede"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="5D63.html">5D63</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7ede"></span>7EDE</td>
<td class="instruction">LD DE,$5AB0</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=base display file address for the lesson box</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ee1"></span>7EE1</td>
<td class="instruction">LD C,$57</td>
<td class="comment-11" rowspan="1">INK 7: PAPER 2: BRIGHT 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ee3"></span>7EE3</td>
<td class="instruction">CALL <a href="6B46.html">$6B46</a></td>
<td class="comment-11" rowspan="1">Print the lesson</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ee6"></span>7EE6</td>
<td class="instruction">LD BC,$8010</td>
<td class="comment-11" rowspan="3">Set the parameters for the bell sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7ee9"></span>7EE9</td>
<td class="instruction">LD D,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eea"></span>7EEA</td>
<td class="instruction">LD A,$01</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7eec"></span>7EEC</td>
<td class="instruction">JP <a href="748C.html">$748C</a></td>
<td class="comment-11" rowspan="1">Ring the bell</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7EB0.html">7EB0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7eb1">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7EEF.html">7EEF</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20151012</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.1.</div>
</footer>
</body>
</html>