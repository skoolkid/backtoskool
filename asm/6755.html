<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 6755</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="670C.html">670C</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6755">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="6780.html">6780</a></span></td>
</tr>
</table>
<div class="description">6755: Get the identifier and coordinates of the blackboard close to a character</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="5E45.html">5E45</a>, <a href="6791.html">6791</a>, <a href="6880.html">6880</a>, <a href="6FF2.html">6FF2</a> and <a href="F100.html">F100</a>. If the character is not standing at a blackboard, the routine returns with the carry flag set. Otherwise the routine returns with the carry flag reset, <span class="register">B</span> holding the blackboard identifier (the LSB of <a href="7F54.html">7F54</a>, <a href="7F5A.html">7F5A</a>, <a href="7F60.html">7F60</a>, <a href="7F66.html">7F66</a> or <a href="7F6C.html">7F6C</a>), and <span class="register">DE</span> holding the coordinates of the top left-hand square of the board.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xC8-0xCC, 0xCE)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6755"></span>6755</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,$03</td>
<td class="comment-11" rowspan="1">There are three blackboards on the top floors</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6757"></span>6757</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,$D337</td>
<td class="comment-11" rowspan="1">The table at <a href="D337.html">D337</a> contains the x-coordinates of the left edges of the blackboards</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="675a"></span>675A</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="1">Byte 0x02 of the character's buffer holds his y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="675c"></span>675C</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="675d"></span>675D</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0x01</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="675e"></span>675E</td>
<td class="bytes-0"></td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Is the character on the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="675f"></span>675F</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,$6768</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6761"></span>6761</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,$3A</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=<a href="D337.html#d33a">D33A</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6763"></span>6763</td>
<td class="bytes-0"></td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=2 (two blackboards on the middle floors)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6764"></span>6764</td>
<td class="bytes-0"></td>
<td class="instruction">CP $0A</td>
<td class="comment-11" rowspan="1">Is the character on the middle floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6766"></span>6766</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,$6774</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6768"></span>6768</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the left edge of a blackboard</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6769"></span>6769</td>
<td class="bytes-0"></td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character to the left of this blackboard?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="676a"></span>676A</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,$6774</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="676c"></span>676C</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,$04</td>
<td class="comment-11" rowspan="2">Is the character no more than 4 (or 12, if coming from <a href="6FF2.html">6FF2</a>) spaces to the right of the left edge of this blackboard?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="676e"></span>676E</td>
<td class="bytes-0"></td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="676f"></span>676F</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,$6776</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6771"></span>6771</td>
<td class="bytes-0"></td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Next blackboard</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6772"></span>6772</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ $6768</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6774"></span>6774</td>
<td class="bytes-0"></td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1">Signal: the character is not standing at a blackboard</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6775"></span>6775</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6776"></span>
<div class="comments">
<div class="paragraph">
The character is standing close enough to the blackboard (to either write on it or start wiping it).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6776"></span>6776</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Now <span class="register">HL</span> points to the blackboard info table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6777"></span>6777</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the left edge of the blackboard (from the table at <a href="D337.html">D337</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6778"></span>6778</td>
<td class="bytes-0"></td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6779"></span>6779</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=blackboard identifier (from the table at <a href="D437.html">D437</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677a"></span>677A</td>
<td class="bytes-0"></td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677b"></span>677B</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=y-coordinate of the top row of the blackboard (from the table at <a href="D537.html">D537</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677c"></span>677C</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">Pass the x-coordinate to <span class="register">L</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677d"></span>677D</td>
<td class="bytes-0"></td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Clear the carry flag to indicate success</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677e"></span>677E</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=coordinates of the top-left corner of the blackboard</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="677f"></span>677F</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">

<div class="comments">
<div class="paragraph">
The contents of the blackboard info tables are as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">x</th>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">y</th>
<th colspan="1" rowspan="1">Room</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="D337.html">3</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D437.html">0x54</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D537.html">3</a></td>
<td class="" colspan="1" rowspan="1">Blue Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="D337.html#d338">41</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D437.html#d438">0x5A</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D537.html#d538">3</a></td>
<td class="" colspan="1" rowspan="1">Yellow Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="D337.html#d339">161</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D437.html#d439">0x60</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D537.html#d539">3</a></td>
<td class="" colspan="1" rowspan="1">Top-floor room in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="D337.html#d33a">32</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D437.html#d43a">0x66</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D537.html#d53a">9</a></td>
<td class="" colspan="1" rowspan="1">Science Lab</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="D337.html#d33b">161</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D437.html#d43b">0x6C</a></td>
<td class="centre" colspan="1" rowspan="1"><a href="D537.html#d53b">9</a></td>
<td class="" colspan="1" rowspan="1">Middle-floor room in the girls' skool</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="670C.html">670C</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6755">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="6780.html">6780</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20190617</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../dec/asm/26453.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>