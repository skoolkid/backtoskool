<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 63586</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="63576.html">63576</a></span></td>
<td class="up">Up: <a href="../maps/all.html#63586">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="63743.html">63743</a></span></td>
</tr>
</table>
<div class="description">63586: Deal with a stinkbomb when dropped</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this routine is placed into <a href="32727.html">32727</a> by the routine at <a href="28992.html">28992</a> when ERIC drops a stinkbomb. It creates a stinkbomb cloud and deals with it until it has dissipated, which includes checking whether MR WACKER and a closed window are nearby, and making the former set off for the latter if so.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63586"></span>63586</td>
<td class="instruction">LD HL,32747</td>
<td class="comment-11" rowspan="1"><a href="32747.html">32747</a> holds the inventory flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63589"></span>63589</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick these up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63590"></span>63590</td>
<td class="instruction">AND 224</td>
<td class="comment-11" rowspan="1">Keep only the stinkbomb bits (bits 5-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63592"></span>63592</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1">Shift these bits left, losing the leftmost bit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63593"></span>63593</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Store the new stinkbomb bits in <span class="register">C</span> briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63594"></span>63594</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the inventory flags in <span class="register">A</span> again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63595"></span>63595</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Discard the old stinkbomb bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63597"></span>63597</td>
<td class="instruction">OR C</td>
<td class="comment-11" rowspan="1">Superimpose the new stinkbomb bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63598"></span>63598</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Restore the inventory flags, minus one stinkbomb</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63599"></span>63599</td>
<td class="instruction">CALL <a href="31746.html">31746</a></td>
<td class="comment-11" rowspan="1">Print the inventory</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63602"></span>63602</td>
<td class="instruction">CALL <a href="57910.html">57910</a></td>
<td class="comment-11" rowspan="1">Prepare buffer 213 for the stinkbomb cloud (or return to the main loop if the buffer is already in use by a stinkbomb cloud)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63605"></span>63605</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of ERIC's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63607"></span>63607</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63608"></span>63608</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63609"></span>63609</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4">Set <span class="register">A</span> to -1 if ERIC is facing left, 1 if he's facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63610"></span>63610</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63611"></span>63611</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63612"></span>63612</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63613"></span>63613</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-11" rowspan="1">Add ERIC's x-coordinate to get the x-coordinate for the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63614"></span>63614</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63615"></span>63615</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63616"></span>63616</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=ERIC's y-coordinate, which will also be the y-coordinate for the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63617"></span>63617</td>
<td class="instruction">LD HL,54547</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 19 of the stinkbomb cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63620"></span>63620</td>
<td class="instruction">LD (HL),29</td>
<td class="comment-11" rowspan="1">Initialise the counter that determines when the cloud will disappear</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63622"></span>63622</td>
<td class="instruction">LD A,71</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#71">71</a>: stinkbomb cloud (phase 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63624"></span>63624</td>
<td class="instruction">CALL <a href="30534.html">30534</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the stinkbomb cloud's appearance and place address <a href="63586.html#63627">63627</a> (below) into bytes 17 and 18 of the cloud's buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63627"></span>
<div class="comments">
<div class="paragraph">
The address of the entry point below is placed into bytes 17 and 18 of the cloud's buffer by the instruction above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63627"></span>63627</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="1">Byte 19 of the cloud's buffer holds the counter that determines how much longer the cloud will stick around (which starts off at 29)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63629"></span>63629</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time for the cloud to disappear?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63630"></span>63630</td>
<td class="instruction">JP Z,<a href="29896.html#29903">29903</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63633"></span>63633</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the counter's value in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63634"></span>63634</td>
<td class="instruction">CP 28</td>
<td class="comment-11" rowspan="1">Is it time for a teacher to give lines?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63636"></span>63636</td>
<td class="instruction">JR NZ,63646</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63638"></span>63638</td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="1">Message <a href="64564.html">1</a>: NO STINKBOMBS</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63640"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="24175.html">24175</a>, <a href="24263.html">24263</a>, <a href="24296.html">24296</a> and <a href="63915.html">63915</a> with <span class="register">A</span> holding a reprimand message number.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63640"></span>63640</td>
<td class="instruction">SUB 62</td>
<td class="comment-11" rowspan="1">Subtract 62 now (it's added back later on)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63642"></span>63642</td>
<td class="instruction">CP A</td>
<td class="comment-11" rowspan="1">Set the zero flag to indicate that any teacher may give ERIC lines (including the one who last gave him lines)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63643"></span>63643</td>
<td class="instruction">JP <a href="32062.html#32282">32282</a></td>
<td class="comment-11" rowspan="1">Make any teacher within range give ERIC lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63646"></span>
<div class="comments">
<div class="paragraph">
Now deal with animating the stinkbomb cloud and checking whether it's near a window.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63646"></span>63646</td>
<td class="instruction">CALL <a href="25581.html#25648">25648</a></td>
<td class="comment-11" rowspan="1">Toggle between cloud animation phases 1 (<a href="../graphics/as.html#71">71</a>) and 2 (<a href="../graphics/as.html#199">199</a>) and update the SRB accordingly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63649"></span>63649</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63651"></span>63651</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="2">Bit 0 of the cloud's animatory state (<a href="../graphics/as.html#71">71 or 199</a>) is always set, so this RET never happens</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63653"></span>63653</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63654"></span>63654</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63655"></span>63655</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=stinkbomb cloud's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63656"></span>63656</td>
<td class="instruction">CP 84</td>
<td class="comment-11" rowspan="1">The head's right study door is at x-coordinate 84</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63658"></span>63658</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if the cloud is to the left of this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63659"></span>63659</td>
<td class="instruction">CP 96</td>
<td class="comment-11" rowspan="1">The boys' skool door is at x-coordinate 96</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63661"></span>63661</td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if the cloud is to the right of this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63662"></span>63662</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63663"></span>63663</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=stinkbomb cloud's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63664"></span>63664</td>
<td class="instruction">CP 17</td>
<td class="comment-11" rowspan="1">Is the cloud on the bottom floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63666"></span>63666</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63667"></span>
<div class="comments">
<div class="paragraph">
The stinkbomb cloud is on the top floor or middle floor, somewhere between the head's right study door and the boys' skool door. Check the windows.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63667"></span>63667</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at byte 2 of the cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63668"></span>63668</td>
<td class="instruction">LD HL,32756</td>
<td class="comment-11" rowspan="1"><a href="32756.html">32756</a> holds the door/window status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63671"></span>63671</td>
<td class="instruction">CP 3</td>
<td class="comment-11" rowspan="1">Is the cloud on the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63673"></span>63673</td>
<td class="instruction">JR Z,63683</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63675"></span>63675</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the middle-floor window already open?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63677"></span>63677</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63678"></span>63678</td>
<td class="instruction">LD BC,32861</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=128 (middle floor window), <span class="register">C</span>=93 (x-coordinate)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63681"></span>63681</td>
<td class="instruction">JR 63689</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63683"></span>63683</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Is the top-floor window already open?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63685"></span>63685</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63686"></span>63686</td>
<td class="instruction">LD BC,16475</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=64 (top-floor window), <span class="register">C</span>=91 (x-coordinate)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63689"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">B</span> holds the identifier of a closed window on the same floor as the stinkbomb cloud, and <span class="register">C</span> holds its x-coordinate. Is MR WACKER in the vicinity?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="63689"></span>63689</td>
<td class="instruction">LD HL,51202</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of MR WACKER's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63692"></span>63692</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is MR WACKER on the same floor as the stinkbomb cloud?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63693"></span>63693</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63694"></span>63694</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63695"></span>63695</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63696"></span>63696</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63697"></span>63697</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="3">Return if MR WACKER is more than 2 spaces to the left of the cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63699"></span>63699</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63700"></span>63700</td>
<td class="instruction">RET NC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63701"></span>63701</td>
<td class="instruction">ADD A,5</td>
<td class="comment-11" rowspan="3">Return if MR WACKER is more than 2 spaces to the right of the cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63703"></span>63703</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63704"></span>63704</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63705"></span>
<div class="comments">
<div class="paragraph">
MR WACKER is close enough to the stinkbomb cloud to be affected by its stench. Check whether he's available for a spot of window-opening.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63705"></span>63705</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=MR WACKER's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63706"></span>63706</td>
<td class="instruction">LD L,18</td>
<td class="comment-11" rowspan="3">Is there an uninterruptible subcommand routine address in bytes 17 and 18 of MR WACKER's buffer (meaning he is otherwise occupied at the moment)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63708"></span>63708</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63709"></span>63709</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63710"></span>63710</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63711"></span>63711</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63712"></span>63712</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=MR WACKER's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63713"></span>63713</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">Is MR WACKER midstride?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63714"></span>63714</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63715"></span>63715</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=MR WACKER's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63716"></span>63716</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="4">Store MR WACKER's current x-coordinate and animatory state in bytes 19 and 20 of his buffer for later retrieval</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63718"></span>63718</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63719"></span>63719</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63720"></span>63720</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63721"></span>63721</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Store the x-coordinate of the window in byte 21</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63722"></span>63722</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63723"></span>63723</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Byte 22 holds 128 (middle-floor window) or 64 (top-floor window)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63724"></span>63724</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63725"></span>63725</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-11" rowspan="1">Update the SRB for MR WACKER's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63728"></span>63728</td>
<td class="instruction">SET 7,A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of MR WACKER facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63730"></span>63730</td>
<td class="instruction">CALL <a href="30534.html">30534</a></td>
<td class="comment-11" rowspan="1">Place address <a href="63586.html#63733">63733</a> (below) into bytes 17 and 18 of MR WACKER's buffer and update his animatory state</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="63733"></span>
<div class="comments">
<div class="paragraph">
The address of the entry point below is placed into bytes 17 and 18 of MR WACKER's buffer by the instruction above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63733"></span>63733</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of MR WACKER's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63735"></span>63735</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Is MR WACKER midstride?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63737"></span>63737</td>
<td class="instruction">JP NZ,<a href="25581.html#25597">25597</a></td>
<td class="comment-11" rowspan="1">Finish his stride if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="63740"></span>63740</td>
<td class="instruction">JP <a href="63801.html">63801</a></td>
<td class="comment-11" rowspan="1">Otherwise set MR WACKER off on his journey to the window</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="63576.html">63576</a></span></td>
<td class="up">Up: <a href="../maps/all.html#63586">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="63743.html">63743</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20151012</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.0.</div>
</footer>
</body>
</html>