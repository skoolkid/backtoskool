<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 639F</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="638C.html">638C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#639f">Map</a></td>
<td class="next">
Next: <a href="63B0.html">63B0</a>
</td>
</tr>
</table>
<div class="description">639F: Call an interruptible subcommand</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="6D00.html">6D00</a>, <a href="7CD0.html">7CD0</a>, <a href="7CE1.html">7CE1</a>, <a href="7EF1.html">7EF1</a>, <a href="F000.html">F000</a>, <a href="F05D.html">F05D</a>, <a href="F073.html">F073</a>, <a href="F0BF.html">F0BF</a>, <a href="F100.html">F100</a>, <a href="F250.html">F250</a> and <a href="F55F.html">F55F</a>. Drops the return address from the stack and copies it into bytes 0x03 and 0x04 of the character's buffer (where the address of the primary command routine is held), copies the address of the interruptible subcommand routine from <span class="register">BC</span> into bytes 0x09 and 0x0A of the character's buffer, and then jumps to that routine.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">BC</td>
<td class="register-desc">Interruptible subcommand routine address</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xB7-0xD6)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="639f"></span>639F</td>
<td class="instruction">LD L,$09</td>
<td class="comment-1" rowspan="4">Copy the routine address from <span class="register">BC</span> into bytes 0x09 and 0x0A of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="63a1"></span>63A1</td>
<td class="instruction">LD (HL),C</td>
</tr>
<tr>
<td class="address-1"><span id="63a2"></span>63A2</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="63a3"></span>63A3</td>
<td class="instruction">LD (HL),B</td>
</tr>
<tr>
<td class="address-1"><span id="63a4"></span>63A4</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="63a5"></span>63A5</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Drop the return address from the stack into <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="63a6"></span>63A6</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Push the routine address in <span class="register">BC</span> onto the stack</td>
</tr>
<tr>
<td class="address-1"><span id="63a7"></span>63A7</td>
<td class="instruction">LD C,L</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="63a8"></span>63A8</td>
<td class="instruction">LD L,$03</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63aa"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the (unused) routine at <a href="63B5.html">63B5</a> with <span class="register">L</span>=0x09.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63aa"></span>63AA</td>
<td class="instruction">LD B,H</td>
<td class="comment-1" rowspan="1">Now <span class="register">BC</span>=address of the instruction after the CALL that got us here</td>
</tr>
<tr>
<td class="address-1"><span id="63ab"></span>63AB</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=character number</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63ac"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="63B0.html">63B0</a> with <span class="register">L</span>=0x09 and <span class="register">BC</span>=<a href="63ED.html">63ED</a>, <a href="6438.html">6438</a>, <a href="644D.html">644D</a> or <a href="F54A.html">F54A</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63ac"></span>63AC</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-1" rowspan="3">Copy the routine address in <span class="register">BC</span> into bytes 0x03 and 0x04 (or 0x09 and 0x0A) of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="63ad"></span>63AD</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="63ae"></span>63AE</td>
<td class="instruction">LD (HL),B</td>
</tr>
<tr>
<td class="address-1"><span id="63af"></span>63AF</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Make an indirect jump to the interruptible subcommand routine</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="638C.html">638C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#639f">Map</a></td>
<td class="next">
Next: <a href="63B0.html">63B0</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20200811</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/25503.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>