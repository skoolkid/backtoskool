<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 79AE</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="79AC.html">79AC</a></span></td>
<td class="up">Up: <a href="../maps/all.html#79ae">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7A14.html">7A14</a></span></td>
</tr>
</table>
<div class="description">79AE: Make any female characters near a mouse start or continue jumping</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="7A16.html">7A16</a>. Does nothing if the mouse is off-screen. Otherwise, for each female character that is facing the mouse and within five spaces to the left or right of it, either (a) makes her stand on a chair or start jumping if she isn't already, or (b) makes her stay on the chair or keep jumping for a little longer.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Mouse's character number (198, 199, 206-208, 212)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="79ae"></span>79AE</td>
<td class="instruction">LD A,($7FFF)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=leftmost column of the play area on screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b1"></span>79B1</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b2"></span>79B2</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the mouse's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b4"></span>79B4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mouse's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b5"></span>79B5</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b6"></span>79B6</td>
<td class="instruction">SUB B</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b7"></span>79B7</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79b8"></span>79B8</td>
<td class="instruction">CP $20</td>
<td class="comment-11" rowspan="1">Is this mouse off-screen?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79ba"></span>79BA</td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79bb"></span>79BB</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79bc"></span>79BC</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=mouse's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79bd"></span>79BD</td>
<td class="instruction">LD H,$B7</td>
<td class="comment-11" rowspan="1">183=little girl no. 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79bf"></span>79BF</td>
<td class="instruction">LD B,$07</td>
<td class="comment-11" rowspan="1">There are 7 little girls to check</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79c1"></span>79C1</td>
<td class="instruction">CALL $79CD</td>
<td class="comment-11" rowspan="1">Make them start jumping if necessary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79c4"></span>79C4</td>
<td class="instruction">LD H,$CC</td>
<td class="comment-11" rowspan="1">204=MISS TAKE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79c6"></span>79C6</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="1">B=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79c7"></span>79C7</td>
<td class="instruction">CALL $79CD</td>
<td class="comment-11" rowspan="1">Make MISS TAKE start jumping if necessary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79ca"></span>79CA</td>
<td class="instruction">LD H,$D1</td>
<td class="comment-11" rowspan="1">209=HAYLEY</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79cc"></span>79CC</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="1">B=1</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="79cd"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">H</span> holds the number of the first female character to check, and <span class="register">B</span> the number of characters to check (for proximity to a mouse).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="79cd"></span>79CD</td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of the female character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79cf"></span>79CF</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mouse's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d0"></span>79D0</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract that of the female character under consideration</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d1"></span>79D1</td>
<td class="instruction">JR Z,$79DD</td>
<td class="comment-11" rowspan="1">Jump if the female character is standing on the same floor as the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d3"></span>79D3</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Is the female character one level above the mouse?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d4"></span>79D4</td>
<td class="instruction">JR NZ,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d6"></span>79D6</td>
<td class="instruction">LD L,$12</td>
<td class="comment-11" rowspan="2">Pick up the MSB of any uninterruptible subcommand routine address in bytes 17 and 18 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d8"></span>79D8</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79d9"></span>79D9</td>
<td class="instruction">CP $79</td>
<td class="comment-11" rowspan="1">Is this character jumping (121=MSB of <a href="7966.html">7966</a> or <a href="7974.html">7974</a>)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79db"></span>79DB</td>
<td class="instruction">JR NZ,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="79dd"></span>79DD</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79df"></span>79DF</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=female character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e0"></span>79E0</td>
<td class="instruction">SUB E</td>
<td class="comment-11" rowspan="1">Subtract that of the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e1"></span>79E1</td>
<td class="instruction">LD L,$00</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e3"></span>79E3</td>
<td class="instruction">JR Z,$79F9</td>
<td class="comment-11" rowspan="1">Jump if the girl is standing right where the mouse is</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e5"></span>79E5</td>
<td class="instruction">JR NC,$79F1</td>
<td class="comment-11" rowspan="1">Jump if the girl is standing to the right of the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e7"></span>79E7</td>
<td class="instruction">CP $FB</td>
<td class="comment-11" rowspan="1">Is the girl within 5 spaces to the left of the mouse?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79e9"></span>79E9</td>
<td class="instruction">JR C,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79eb"></span>79EB</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the female character facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79ed"></span>79ED</td>
<td class="instruction">JR Z,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79ef"></span>79EF</td>
<td class="instruction">JR $79F9</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="79f1"></span>79F1</td>
<td class="instruction">CP $06</td>
<td class="comment-11" rowspan="1">Is the girl within 5 spaces to the right of the mouse?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79f3"></span>79F3</td>
<td class="instruction">JR NC,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79f5"></span>79F5</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the female character facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79f7"></span>79F7</td>
<td class="instruction">JR NZ,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="79f9"></span>
<div class="comments">
<div class="paragraph">
The female character is located within 5 spaces of the mouse, and is facing it. Figure out whether she's already jumping, or can start jumping.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="79f9"></span>79F9</td>
<td class="instruction">LD L,$12</td>
<td class="comment-11" rowspan="2">Pick up the MSB of any uninterruptible subcommand routine address in bytes 17 and 18 of the female character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79fb"></span>79FB</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79fc"></span>79FC</td>
<td class="instruction">CP $79</td>
<td class="comment-11" rowspan="1">Set the zero flag if the routine address is <a href="7966.html">7966</a> or <a href="7974.html">7974</a> (i.e. the character is already jumping)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79fe"></span>79FE</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 19 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="79ff"></span>79FF</td>
<td class="instruction">JR NZ,$7A05</td>
<td class="comment-11" rowspan="1">Jump if the character is not jumping</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a01"></span>7A01</td>
<td class="instruction">SET 4,(HL)</td>
<td class="comment-11" rowspan="1">Otherwise ensure this character continues jumping for a little longer by setting the counter in byte 19 to at least 16</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a03"></span>7A03</td>
<td class="instruction">JR $7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7a05"></span>7A05</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is there an uninterruptible subcommand routine address other than <a href="7966.html">7966</a> or <a href="7974.html">7974</a> in bytes 17 and 18 of the character's buffer (meaning she is otherwise occupied)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a06"></span>7A06</td>
<td class="instruction">JR NZ,$7A10</td>
<td class="comment-11" rowspan="1">Jump ahead to consider the next character if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7a08"></span>
<div class="comments">
<div class="paragraph">
The female character is not jumping at the moment. Make her start.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a08"></span>7A08</td>
<td class="instruction">LD (HL),$15</td>
<td class="comment-11" rowspan="2">Set the delay parameter at byte 19 determining how long the female character will jump up and down</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a0a"></span>7A0A</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a0b"></span>7A0B</td>
<td class="instruction">LD (HL),$79</td>
<td class="comment-11" rowspan="3">Place the address of the uninterruptible subcommand routine at <a href="7974.html">7974</a> into bytes 17 and 18 of the female character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a0d"></span>7A0D</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a0e"></span>7A0E</td>
<td class="instruction">LD (HL),$74</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7a10"></span>7A10</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Next female character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a11"></span>7A11</td>
<td class="instruction">DJNZ $79CD</td>
<td class="comment-11" rowspan="1">Jump back until all the characters have been checked</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7a13"></span>7A13</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="79AC.html">79AC</a></span></td>
<td class="up">Up: <a href="../maps/all.html#79ae">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="7A14.html">7A14</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20151012</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.1.</div>
</footer>
</body>
</html>