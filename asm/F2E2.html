<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at F2E2</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F2DF.html">F2DF</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f2e2">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F3D4.html">F3D4</a></span></td>
</tr>
</table>
<div class="description">F2E2: Deal with ERIC when he's sitting or lying down</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F7AD.html">F7AD</a> when bit 2 at <a href="7FFB.html">7FFB</a> is set (by the routine at <a href="F28E.html">F28E</a>, <a href="F3D7.html">F3D7</a> or <a href="FBCC.html">FBCC</a>). Makes ERIC stand up if 'S' is pressed, or open a desk (and collect any contents) if 'O' is pressed.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f2e2"></span>F2E2</td>
<td class="instruction">LD HL,$7FF3</td>
<td class="comment-11" rowspan="1"><a href="7FF3.html">7FF3</a> holds ERIC's main action timer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2e5"></span>F2E5</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time to deal with ERIC yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2e6"></span>F2E6</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2e7"></span>F2E7</td>
<td class="instruction">LD A,($7FDE)</td>
<td class="comment-11" rowspan="1"><a href="7FDE.html">7FDE</a> holds 0xFF if we're in demo mode, 0x00 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2ea"></span>F2EA</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Are we in demo mode?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2eb"></span>F2EB</td>
<td class="instruction">JR NZ,$F320</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f2ed"></span>
<div class="comments">
<div class="paragraph">
We're in demo mode. Figure out ERIC's next move depending on what little boy no. 10 is doing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2ed"></span>F2ED</td>
<td class="instruction">CALL <a href="F6BE.html">$F6BE</a></td>
<td class="comment-11" rowspan="1">Exit demo mode and start a new game if a key was pressed; otherwise return here with ERIC's animatory state in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2f0"></span>F2F0</td>
<td class="instruction">LD HL,$C700</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0x00 of little boy no. 10's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2f3"></span>F2F3</td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#4">0x04</a>: Is ERIC sitting in a chair?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2f5"></span>F2F5</td>
<td class="instruction">JR Z,$F2FB</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2f7"></span>F2F7</td>
<td class="instruction">CP $85</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#133">0x85</a>: Is ERIC sitting on the floor facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2f9"></span>F2F9</td>
<td class="instruction">JR NZ,$F308</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f2fb"></span>F2FB</td>
<td class="instruction">ADD A,$40</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a href="../graphics/as.html#68">0x44</a> (little boy sitting on a chair) or <a href="../graphics/as.html#197">0xC5</a> (little boy sitting on the floor facing right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2fd"></span>F2FD</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Compare ERIC's animatory state with that of little boy no. 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f2fe"></span>F2FE</td>
<td class="instruction">LD HL,$7FDC</td>
<td class="comment-11" rowspan="1"><a href="7FDC.html">7FDC</a> holds the counter that determines the delay between little boy no. 10 standing up and ERIC standing up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f301"></span>F301</td>
<td class="instruction">JR NZ,$F306</td>
<td class="comment-11" rowspan="1">Jump if ERIC's not doing what little boy no. 10 is doing</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f303"></span>F303</td>
<td class="instruction">LD (HL),$2D</td>
<td class="comment-11" rowspan="1">Initialise the stand-up delay counter at <a href="7FDC.html">7FDC</a> to 45</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f305"></span>F305</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f306"></span>F306</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement the stand-up delay counter at <a href="7FDC.html">7FDC</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f307"></span>F307</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if it's not time for ERIC to stand up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f308"></span>F308</td>
<td class="instruction">LD HL,$7FFB</td>
<td class="comment-11" rowspan="1"><a href="7FFB.html">7FFB</a> holds ERIC's status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f30b"></span>F30B</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="1">Clear all of them (ERIC is no longer sitting or lying down)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f30d"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="5E6F.html">5E6F</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f30d"></span>F30D</td>
<td class="instruction">CALL <a href="7154.html">$7154</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f310"></span>F310</td>
<td class="instruction">LD H,$D2</td>
<td class="comment-11" rowspan="1">0xD2=ERIC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f312"></span>F312</td>
<td class="instruction">CALL <a href="61B4.html">$61B4</a></td>
<td class="comment-11" rowspan="1">Update the SRB for ERIC's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f315"></span>F315</td>
<td class="instruction">AND $80</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a href="../graphics/as.html#0">0x00/0x80</a>: ERIC standing up</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f317"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="5D63.html">5D63</a>, <a href="5E45.html">5E45</a>, <a href="FAF2.html">FAF2</a> and <a href="FBA0.html">FBA0</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f317"></span>F317</td>
<td class="instruction">CALL <a href="6130.html">$6130</a></td>
<td class="comment-11" rowspan="1">Update ERIC's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f31a"></span>F31A</td>
<td class="instruction">LD A,$06</td>
<td class="comment-11" rowspan="2">Set ERIC's main action timer (at <a href="7FF3.html">7FF3</a>) to 6</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f31c"></span>F31C</td>
<td class="instruction">LD ($7FF3),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f31f"></span>F31F</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f320"></span>
<div class="comments">
<div class="paragraph">
We're not in demo mode.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f320"></span>F320</td>
<td class="instruction">CALL <a href="71BE.html">$71BE</a></td>
<td class="comment-11" rowspan="1">Collect the code of the last key pressed in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f323"></span>F323</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if no keys were pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f324"></span>F324</td>
<td class="instruction">RES 5,A</td>
<td class="comment-11" rowspan="1">Normalise the code to upper case</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f326"></span>F326</td>
<td class="instruction">CP $53</td>
<td class="comment-11" rowspan="1">Was 'S' pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f328"></span>F328</td>
<td class="instruction">JR Z,$F308</td>
<td class="comment-11" rowspan="1">Make ERIC stand up if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f32a"></span>F32A</td>
<td class="instruction">CP $4F</td>
<td class="comment-11" rowspan="1">Was 'O' pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f32c"></span>F32C</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f32d"></span>F32D</td>
<td class="instruction">LD A,($D200)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f330"></span>F330</td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#4">0x04</a>: Is ERIC sitting in a chair?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f332"></span>F332</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f333"></span>
<div class="comments">
<div class="paragraph">
ERIC is sitting in a chair and 'O' (open desk) was pressed. Compute the ID of the desk ERIC is sitting at so we can determine whether he's found the water pistol or the stinkbombs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f333"></span>F333</td>
<td class="instruction">LD A,($D601)</td>
<td class="comment-11" rowspan="1">Pick up the x-coordinate of whatever object is using buffer 0xD6</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f336"></span>F336</td>
<td class="instruction">CP $C0</td>
<td class="comment-11" rowspan="1">Is this buffer being used at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f338"></span>F338</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f339"></span>F339</td>
<td class="instruction">LD DE,($D201)</td>
<td class="comment-11" rowspan="1">Pick up ERIC's coordinates in <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f33d"></span>F33D</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f33e"></span>F33E</td>
<td class="instruction">CP $0A</td>
<td class="comment-11" rowspan="1">Is ERIC on the middle floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f340"></span>F340</td>
<td class="instruction">JR Z,$F356</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f342"></span>F342</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Is ERIC on the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f344"></span>F344</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f345"></span>F345</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f346"></span>F346</td>
<td class="instruction">CP $16</td>
<td class="comment-11" rowspan="1">Is ERIC in the Blue Room?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f348"></span>F348</td>
<td class="instruction">JR C,$F352</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f34a"></span>F34A</td>
<td class="instruction">SUB $1B</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f34c"></span>F34C</td>
<td class="instruction">CP $22</td>
<td class="comment-11" rowspan="1">Is ERIC in the Yellow Room?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f34e"></span>F34E</td>
<td class="instruction">JR C,$F352</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f350"></span>F350</td>
<td class="instruction">SUB $6A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f352"></span>F352</td>
<td class="instruction">SUB $09</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f354"></span>F354</td>
<td class="instruction">JR $F35F</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f356"></span>F356</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f357"></span>F357</td>
<td class="instruction">CP $35</td>
<td class="comment-11" rowspan="1">Is ERIC in the Science lab?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f359"></span>F359</td>
<td class="instruction">JR C,$F35D</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f35b"></span>F35B</td>
<td class="instruction">SUB $71</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f35d"></span>F35D</td>
<td class="instruction">SUB $02</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f35f"></span>F35F</td>
<td class="instruction">RRA</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f360"></span>F360</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f361"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">B</span> holds the identifier of the desk that ERIC's sitting at.
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Desk IDs</th>
<th colspan="1" rowspan="1">Room</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0x01-0x06</td>
<td class="" colspan="1" rowspan="1">Blue Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0x07-0x0C</td>
<td class="" colspan="1" rowspan="1">Yellow Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0x0D-0x12</td>
<td class="" colspan="1" rowspan="1">Top-floor room in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0x13-0x19</td>
<td class="" colspan="1" rowspan="1">Science Lab</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0x1A-0x1F</td>
<td class="" colspan="1" rowspan="1">Middle-floor room in the girls' skool</td>
</tr>
</table>
</div>
<div class="paragraph">
Now we check whether the water pistol has been placed in a desk yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f361"></span>F361</td>
<td class="instruction">LD HL,$7FDA</td>
<td class="comment-11" rowspan="1"><a href="7FDA.html">7FDA</a> holds the ID of the desk containing the water pistol</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f364"></span>F364</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">Has the water pistol been placed in a desk yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f365"></span>F365</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f366"></span>F366</td>
<td class="instruction">JR NZ,$F376</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f368"></span>
<div class="comments">
<div class="paragraph">
The water pistol hasn't been placed in a desk yet. Pick one at random that doesn't match the desk containing the stinkbombs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f368"></span>F368</td>
<td class="instruction">CALL <a href="6291.html">$6291</a></td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=random desk ID from 0x01 to 0x1F</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f36b"></span>F36B</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f36d"></span>F36D</td>
<td class="instruction">JR Z,$F368</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f36f"></span>F36F</td>
<td class="instruction">LD L,$DB</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FDB.html">7FDB</a> (which holds the ID of the desk containing the stinkbombs)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f371"></span>F371</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is this the desk containing the stinkbombs?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f372"></span>F372</td>
<td class="instruction">JR Z,$F368</td>
<td class="comment-11" rowspan="1">Get another random desk ID if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f374"></span>F374</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Otherwise place the newly determined ID of the desk containing the water pistol into <a href="7FDA.html">7FDA</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f375"></span>F375</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f376"></span>
<div class="comments">
<div class="paragraph">
Check whether ERIC has found the water pistol.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f376"></span>F376</td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Is ERIC sitting at the desk that contains the water pistol?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f377"></span>F377</td>
<td class="instruction">JR NZ,$F389</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f379"></span>F379</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="1">Set <a href="7FDA.html">7FDA</a> to 0 (the water pistol is not in any desk now)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f37b"></span>F37B</td>
<td class="instruction">LD L,$EB</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FEB.html">7FEB</a> (inventory flags)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f37d"></span>F37D</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick these up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f37e"></span>F37E</td>
<td class="instruction">AND $18</td>
<td class="comment-11" rowspan="1">Keep only bits 3 and 4 (the pistol bits)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f380"></span>F380</td>
<td class="instruction">LD A,$2C</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#44">0x2C</a>: animatory state of a desk lid</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f382"></span>F382</td>
<td class="instruction">JR NZ,$F3A9</td>
<td class="comment-11" rowspan="1">Jump if ERIC already has a water pistol</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f384"></span>F384</td>
<td class="instruction">SET 3,(HL)</td>
<td class="comment-11" rowspan="1">Give ERIC a water pistol (full of water)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f386"></span>F386</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#45">0x2D</a>: animatory state of a desk lid with a water pistol</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f387"></span>F387</td>
<td class="instruction">JR $F3A9</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f389"></span>
<div class="comments">
<div class="paragraph">
There was no water pistol in the desk. Check whether there are stinkbombs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f389"></span>F389</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FDB.html">7FDB</a> (which holds the ID of the desk containing the stinkbombs)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f38a"></span>F38A</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">Have the stinkbombs been placed in a desk yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f38b"></span>F38B</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f38c"></span>F38C</td>
<td class="instruction">JR NZ,$F39C</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f38e"></span>
<div class="comments">
<div class="paragraph">
The stinkbombs haven't been placed in a desk yet. Pick one at random that doesn't match the desk containing the water pistol.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f38e"></span>F38E</td>
<td class="instruction">CALL <a href="6291.html">$6291</a></td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=random desk ID from 0x01 to 0x1F</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f391"></span>F391</td>
<td class="instruction">AND $1F</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f393"></span>F393</td>
<td class="instruction">JR Z,$F38E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f395"></span>F395</td>
<td class="instruction">LD L,$DA</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FDA.html">7FDA</a> (which holds the ID of the desk containing the water pistol)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f397"></span>F397</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is this the desk containing the water pistol?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f398"></span>F398</td>
<td class="instruction">JR Z,$F38E</td>
<td class="comment-11" rowspan="1">Get another random desk ID if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f39a"></span>F39A</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Otherwise place the newly determined ID of the desk containing the stinkbombs into <a href="7FDB.html">7FDB</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f39b"></span>F39B</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f39c"></span>
<div class="comments">
<div class="paragraph">
Check whether ERIC has found the stinkbombs.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f39c"></span>F39C</td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Compare the ID of the desk ERIC's sitting at (<span class="register">A</span>) with the ID of the desk containing the stinkbombs (<span class="register">B</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f39d"></span>F39D</td>
<td class="instruction">LD A,$2C</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#44">0x2C</a>: animatory state of a desk lid</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f39f"></span>F39F</td>
<td class="instruction">JR NZ,$F3A9</td>
<td class="comment-11" rowspan="1">Jump if ERIC isn't sitting at the desk that contains the stinkbombs</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3a1"></span>F3A1</td>
<td class="instruction">LD L,$EB</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FEB.html">7FEB</a> (inventory flags)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3a3"></span>F3A3</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Set bits 5-7, giving ERIC three stinkbombs</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3a4"></span>F3A4</td>
<td class="instruction">OR $E0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3a6"></span>F3A6</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3a7"></span>F3A7</td>
<td class="instruction">LD A,$2E</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#46">0x2E</a>: animatory state of a desk lid with stinkbombs</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f3a9"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">A</span> holds the animatory state of the desk lid: <a href="../graphics/as.html#44">0x2C</a> (empty desk), <a href="../graphics/as.html#45">0x2D</a> (with pistol), or <a href="../graphics/as.html#46">0x2E</a> (with stinkbombs).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f3a9"></span>F3A9</td>
<td class="instruction">LD HL,$D613</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0x13 of the desk lid's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3ac"></span>F3AC</td>
<td class="instruction">LD (HL),$08</td>
<td class="comment-11" rowspan="1">Initialise the counter determining how long the desk lid stays up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3ae"></span>F3AE</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=x-coordinate of the desk lid in front of ERIC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3af"></span>F3AF</td>
<td class="instruction">CALL <a href="7746.html">$7746</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the desk lid's appearance and place address <a href="F2E2.html#f3b2">F3B2</a> (below) into bytes 0x11 and 0x12 of its buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f3b2"></span>
<div class="comments">
<div class="paragraph">
The address of this entry point is placed into bytes 0x11 and 0x12 of the desk lid's buffer by the instruction above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f3b2"></span>F3B2</td>
<td class="instruction">LD L,$13</td>
<td class="comment-11" rowspan="1">Byte 0x13 of the desk lid's buffer holds the delay counter that determines when the desk lid will shut</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3b4"></span>F3B4</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement this counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3b5"></span>F3B5</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Copy its current value to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3b6"></span>F3B6</td>
<td class="instruction">JP Z,<a href="74C8.html#74cf">$74CF</a></td>
<td class="comment-11" rowspan="1">Jump if it's time for the desk lid to close</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3b9"></span>F3B9</td>
<td class="instruction">SUB $06</td>
<td class="comment-11" rowspan="1">Is it time for ERIC to collect the contents of the desk?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3bb"></span>F3BB</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3bc"></span>F3BC</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0x00</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3bd"></span>F3BD</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of a desk lid (with contents, if any)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3be"></span>F3BE</td>
<td class="instruction">CP $2C</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#44">0x2C</a>: Is the desk empty?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3c0"></span>F3C0</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f3c1"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="5DDC.html">5DDC</a>, <a href="7316.html">7316</a> and <a href="7380.html">7380</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f3c1"></span>F3C1</td>
<td class="instruction">CALL <a href="7C02.html">$7C02</a></td>
<td class="comment-11" rowspan="1">Print the inventory</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f3c4"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="5F1C.html">5F1C</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f3c4"></span>F3C4</td>
<td class="instruction">LD C,$05</td>
<td class="comment-11" rowspan="8">Make a celebratory sound effect (ERIC has achieved something rather handy)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f3c6"></span>F3C6</td>
<td class="instruction">LD B,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3c8"></span>F3C8</td>
<td class="instruction">LD HL,$FF17</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3cb"></span>F3CB</td>
<td class="instruction">LD D,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3cc"></span>F3CC</td>
<td class="instruction">LD E,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3cd"></span>F3CD</td>
<td class="instruction">CALL <a href="F28E.html#f2cb">$F2CB</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3d0"></span>F3D0</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3d1"></span>F3D1</td>
<td class="instruction">JR NZ,$F3C6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f3d3"></span>F3D3</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F2DF.html">F2DF</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f2e2">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F3D4.html">F3D4</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20181019</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/back_to_skool/asm/62178.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>