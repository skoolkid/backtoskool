<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 31254</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31252.html">31252</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31254">Map</a></td>
<td class="next">
Next: <a href="31462.html">31462</a>
</td>
</tr>
</table>
<div class="description">31254: Control a mouse</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this uninterruptible subcommand routine is placed into bytes 17 and 18 of a mouse's buffer by the routine at <a href="31502.html">31502</a> (if the mouse was released by ERIC) or by the routine at <a href="62910.html">62910</a> (when preparing for a new game). Bytes 16 and 19-22 of the mouse's buffer are used to store the following values that control its movement:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Byte</th>
<th colspan="1" rowspan="1">Contents</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">16</td>
<td class="" colspan="1" rowspan="1">Counter decremented each time the mouse hides (if the mouse was released by ERIC); when it reaches 0, the mouse dies (returns control to the character whose buffer it borrowed)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">19</td>
<td class="" colspan="1" rowspan="1">Direction of travel, and the distance remaining to travel before hiding or considering a change of direction: it is positive (bit 7 reset) if the mouse is travelling right, and decremented on each pass; it is negative (bit 7 set) if the mouse is travelling left, and incremented on each pass; while the mouse is hiding, it is 0</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">20</td>
<td class="" colspan="1" rowspan="1">Counter decremented on each change of direction or distance to travel; when it reaches 0, the mouse hides</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">21</td>
<td class="" colspan="1" rowspan="1">Counter determining how much longer the mouse has left to hide</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">22</td>
<td class="" colspan="1" rowspan="1">x-coordinate of the mouse when it last hid</td>
</tr>
</table>
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Mouse's character number (198, 199, 206-208, 212)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="31254"></span>31254</td>
<td class="instruction">LD L,19</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=remaining distance to travel</td>
</tr>
<tr>
<td class="address-1"><span id="31256"></span>31256</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31257"></span>31257</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is this mouse (a) hiding, (b) about to hide, or (c) about to consider a change of direction and distance to travel?</td>
</tr>
<tr>
<td class="address-1"><span id="31258"></span>31258</td>
<td class="instruction">JR Z,31330</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-2"><span id="31260"></span>31260</td>
<td class="instruction">LD A,(32756)</td>
<td class="comment-1" rowspan="1"><a href="32756.html">32756</a> holds the door/window status flags</td>
</tr>
<tr>
<td class="address-1"><span id="31263"></span>31263</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Save these flags</td>
</tr>
<tr>
<td class="address-1"><span id="31264"></span>31264</td>
<td class="instruction">AND 63</td>
<td class="comment-1" rowspan="2">Reset bits 6 and 7 of the door/window status flags (i.e. pretend that the windows are closed)</td>
</tr>
<tr>
<td class="address-1"><span id="31266"></span>31266</td>
<td class="instruction">LD (32756),A</td>
</tr>
<tr>
<td class="address-2"><span id="31269"></span>31269</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Set the zero flag if the mouse is travelling right</td>
</tr>
<tr>
<td class="address-1"><span id="31271"></span>31271</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="2">Collect the mouse's x-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="31273"></span>31273</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31274"></span>31274</td>
<td class="instruction">JR Z,31278</td>
<td class="comment-1" rowspan="1">Jump if the mouse is travelling right</td>
</tr>
<tr>
<td class="address-1"><span id="31276"></span>31276</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="31277"></span>31277</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="31278"></span>31278</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=x-coordinate of the spot in front of the mouse</td>
</tr>
<tr>
<td class="address-1"><span id="31279"></span>31279</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="address-1"><span id="31280"></span>31280</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=mouse's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31281"></span>31281</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1">Copy this to <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="31282"></span>31282</td>
<td class="instruction">CP 10</td>
<td class="comment-1" rowspan="1">Is the mouse on the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="31284"></span>31284</td>
<td class="instruction">JR NZ,31291</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31286"></span>31286</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of the spot in front of the mouse</td>
</tr>
<tr>
<td class="address-1"><span id="31287"></span>31287</td>
<td class="instruction">CP 84</td>
<td class="comment-1" rowspan="1">Is the mouse at the top of the stairs leading down to the stage?</td>
</tr>
<tr>
<td class="address-1"><span id="31289"></span>31289</td>
<td class="instruction">JR Z,31296</td>
<td class="comment-1" rowspan="1">Turn the mouse round if so</td>
</tr>
<tr>
<td class="address-2"><span id="31291"></span>31291</td>
<td class="instruction">CALL <a href="30292.html">30292</a></td>
<td class="comment-1" rowspan="1">Check for walls and closed doors in the mouse's path</td>
</tr>
<tr>
<td class="address-1"><span id="31294"></span>31294</td>
<td class="instruction">JR NC,31304</td>
<td class="comment-1" rowspan="1">Jump if there are none</td>
</tr>
<tr>
<td class="address-2"><span id="31296"></span>31296</td>
<td class="instruction">LD L,19</td>
<td class="comment-1" rowspan="4">Turn the mouse round without changing the distance remaining to travel</td>
</tr>
<tr>
<td class="address-1"><span id="31298"></span>31298</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31299"></span>31299</td>
<td class="instruction">NEG</td>
</tr>
<tr>
<td class="address-1"><span id="31301"></span>31301</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31302"></span>31302</td>
<td class="instruction">JR 31269</td>
<td class="comment-1" rowspan="1">See what's in front of the mouse in this direction</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31304"></span>
<div class="comments">
<div class="paragraph">
There are no walls or closed doors in the mouse's path.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31304"></span>31304</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="2">Restore the door/window status flags</td>
</tr>
<tr>
<td class="address-1"><span id="31305"></span>31305</td>
<td class="instruction">LD (32756),A</td>
</tr>
<tr>
<td class="address-1"><span id="31308"></span>31308</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the mouse's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="31311"></span>31311</td>
<td class="instruction">LD L,19</td>
<td class="comment-1" rowspan="2">Is the mouse travelling right?</td>
</tr>
<tr>
<td class="address-1"><span id="31313"></span>31313</td>
<td class="instruction">BIT 7,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31315"></span>31315</td>
<td class="instruction">JR Z,31323</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31317"></span>31317</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Decrease the distance left to travel</td>
</tr>
<tr>
<td class="address-1"><span id="31318"></span>31318</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1">Move the mouse one space left</td>
</tr>
<tr>
<td class="address-1"><span id="31319"></span>31319</td>
<td class="instruction">LD A,47</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#47">47</a>: animatory state of a mouse travelling left</td>
</tr>
<tr>
<td class="address-1"><span id="31321"></span>31321</td>
<td class="instruction">JR 31327</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="31323"></span>31323</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Decrease the distance left to travel</td>
</tr>
<tr>
<td class="address-1"><span id="31324"></span>31324</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Move the mouse one space right</td>
</tr>
<tr>
<td class="address-2"><span id="31325"></span>31325</td>
<td class="instruction">LD A,175</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#175">175</a>: animatory state of a mouse travelling right</td>
</tr>
<tr>
<td class="address-2"><span id="31327"></span>31327</td>
<td class="instruction">JP <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the mouse's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31330"></span>
<div class="comments">
<div class="paragraph">
Byte 19 holds 0, which means (a) the mouse is hiding at the moment, or (b) it's time for the mouse to consider a change of direction and distance to travel, or (c) it's time to hide for a bit.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31330"></span>31330</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Pick up byte 20 in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="31331"></span>31331</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31332"></span>31332</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is the mouse already hiding?</td>
</tr>
<tr>
<td class="address-1"><span id="31333"></span>31333</td>
<td class="instruction">JR Z,31372</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31335"></span>31335</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Is it time for the mouse to hide temporarily?</td>
</tr>
<tr>
<td class="address-1"><span id="31336"></span>31336</td>
<td class="instruction">JR NZ,31347</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31338"></span>31338</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of the mouse's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31340"></span>31340</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=mouse's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31341"></span>31341</td>
<td class="instruction">LD L,22</td>
<td class="comment-1" rowspan="2">Store this in byte 22 of the mouse's buffer for later retrieval</td>
</tr>
<tr>
<td class="address-1"><span id="31343"></span>31343</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31344"></span>31344</td>
<td class="instruction">JP <a href="29896.html#29907">29907</a></td>
<td class="comment-1" rowspan="1">Make the mouse hide</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31347"></span>
<div class="comments">
<div class="paragraph">
It's time for the mouse to consider a change of direction and distance to travel.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31347"></span>31347</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="31348"></span>31348</td>
<td class="instruction">CALL <a href="31150.html">31150</a></td>
<td class="comment-1" rowspan="1">Make any girls near this mouse start jumping</td>
</tr>
<tr>
<td class="address-1"><span id="31351"></span>31351</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="31352"></span>31352</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="31355"></span>31355</td>
<td class="instruction">AND 131</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=2-5 (bit 7 reset) or 130-133 (bit 7 set)</td>
</tr>
<tr>
<td class="address-1"><span id="31357"></span>31357</td>
<td class="instruction">ADD A,2</td>
</tr>
<tr>
<td class="address-1"><span id="31359"></span>31359</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=2-5 (bit 7 reset), with the carry flag holding the previous contents of bit 7</td>
</tr>
<tr>
<td class="address-1"><span id="31360"></span>31360</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="31361"></span>31361</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="address-1"><span id="31362"></span>31362</td>
<td class="instruction">JR C,31366</td>
<td class="comment-1" rowspan="1">Jump if bit 7 was set (the new direction is right)</td>
</tr>
<tr>
<td class="address-1"><span id="31364"></span>31364</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1">The new direction is left</td>
</tr>
<tr>
<td class="address-2"><span id="31366"></span>31366</td>
<td class="instruction">LD L,19</td>
<td class="comment-1" rowspan="2">Set the new direction and distance to travel</td>
</tr>
<tr>
<td class="address-1"><span id="31368"></span>31368</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31369"></span>31369</td>
<td class="instruction">JP 31260</td>
<td class="comment-1" rowspan="1">Start moving</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31372"></span>
<div class="comments">
<div class="paragraph">
The mouse is currently hiding. Check whether it should transform into a frog before reappearing (in case ERIC obtained the Science Lab storeroom key in the meantime).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31372"></span>31372</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=21</td>
</tr>
<tr>
<td class="address-1"><span id="31373"></span>31373</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Is it time for the mouse to come out of hiding?</td>
</tr>
<tr>
<td class="address-1"><span id="31374"></span>31374</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="31375"></span>31375</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=mouse's character number</td>
</tr>
<tr>
<td class="address-1"><span id="31376"></span>31376</td>
<td class="instruction">CP 212</td>
<td class="comment-1" rowspan="1">Was this mouse released by ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="31378"></span>31378</td>
<td class="instruction">JR NZ,31424</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="31380"></span>31380</td>
<td class="instruction">LD A,(32747)</td>
<td class="comment-1" rowspan="1"><a href="32747.html">32747</a> holds the inventory flags</td>
</tr>
<tr>
<td class="address-1"><span id="31383"></span>31383</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-1" rowspan="1">Has ERIC got the Science Lab storeroom key?</td>
</tr>
<tr>
<td class="address-1"><span id="31385"></span>31385</td>
<td class="instruction">JR Z,31398</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31387"></span>31387</td>
<td class="instruction">LD A,29</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#29">29</a>: animatory state of the frog</td>
</tr>
<tr>
<td class="address-1"><span id="31389"></span>31389</td>
<td class="instruction">LD DE,2619</td>
<td class="comment-1" rowspan="1">(<span class="register">E</span>,<span class="register">D</span>)=(59,10) (location where the frog enters the game)</td>
</tr>
<tr>
<td class="address-1"><span id="31392"></span>31392</td>
<td class="instruction">CALL <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the frog's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="address-1"><span id="31395"></span>31395</td>
<td class="instruction">JP <a href="30906.html#31061">31061</a></td>
<td class="comment-1" rowspan="1">Bring the frog into the game</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31398"></span>
<div class="comments">
<div class="paragraph">
It's time for this mouse to come out of hiding.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31398"></span>31398</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=random number between 5 and 20; this determines how long the mouse will hide next time</td>
</tr>
<tr>
<td class="address-1"><span id="31401"></span>31401</td>
<td class="instruction">AND 15</td>
</tr>
<tr>
<td class="address-1"><span id="31403"></span>31403</td>
<td class="instruction">ADD A,5</td>
</tr>
<tr>
<td class="address-1"><span id="31405"></span>31405</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store this in byte 21 of the mouse's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31406"></span>31406</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=random number between 2 and 5; this determines how many changes of direction and distance to travel the mouse will make before hiding again</td>
</tr>
<tr>
<td class="address-1"><span id="31409"></span>31409</td>
<td class="instruction">AND 3</td>
</tr>
<tr>
<td class="address-1"><span id="31411"></span>31411</td>
<td class="instruction">ADD A,2</td>
</tr>
<tr>
<td class="address-1"><span id="31413"></span>31413</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="2">Store this in byte 20 of the mouse's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31414"></span>31414</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31415"></span>31415</td>
<td class="instruction">LD L,22</td>
<td class="comment-1" rowspan="2"><span class="register">E</span>=x-coordinate of the mouse before it hid</td>
</tr>
<tr>
<td class="address-1"><span id="31417"></span>31417</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31418"></span>31418</td>
<td class="instruction">LD L,2</td>
<td class="comment-1" rowspan="2"><span class="register">D</span>=y-coordinate of the mouse</td>
</tr>
<tr>
<td class="address-1"><span id="31420"></span>31420</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31421"></span>31421</td>
<td class="instruction">JP 31325</td>
<td class="comment-1" rowspan="1">Unhide the mouse</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31424"></span>
<div class="comments">
<div class="paragraph">
This mouse was released by ERIC and is currently hiding. It's due to come out of hiding, or die.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31424"></span>31424</td>
<td class="instruction">LD L,16</td>
<td class="comment-1" rowspan="1">Byte 16 holds the mouse's lifespan counter</td>
</tr>
<tr>
<td class="address-1"><span id="31426"></span>31426</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Is it time for this mouse to disappear for ever?</td>
</tr>
<tr>
<td class="address-1"><span id="31427"></span>31427</td>
<td class="instruction">JR NZ,31451</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31429"></span>
<div class="comments">
<div class="paragraph">
This mouse must die, and return control of the buffer it hijacked (198, 199, 206-208) to its original owner (little boy no. 9 or 10, BOY WANDER, ANGELFACE or EINSTEIN).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31429"></span>31429</td>
<td class="instruction">LD L,29</td>
<td class="comment-1" rowspan="2">Set bits 0 and 7 at byte 29: restart the command list and make the character run</td>
</tr>
<tr>
<td class="address-1"><span id="31431"></span>31431</td>
<td class="instruction">LD (HL),129</td>
</tr>
<tr>
<td class="address-1"><span id="31433"></span>31433</td>
<td class="instruction">LD L,10</td>
<td class="comment-1" rowspan="2">Remove any interruptible subcommand routine address that may have been in the character's buffer before it was hijacked</td>
</tr>
<tr>
<td class="address-1"><span id="31435"></span>31435</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="address-1"><span id="31437"></span>31437</td>
<td class="instruction">LD L,15</td>
<td class="comment-1" rowspan="2">Pick up from byte 15 the animatory state of the character whose buffer the mouse borrowed</td>
</tr>
<tr>
<td class="address-1"><span id="31439"></span>31439</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31440"></span>31440</td>
<td class="instruction">AND 240</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's base animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31442"></span>31442</td>
<td class="instruction">LD L,0</td>
<td class="comment-1" rowspan="2">Restore this character's animatory state to its base value</td>
</tr>
<tr>
<td class="address-1"><span id="31444"></span>31444</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31445"></span>31445</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Make the character reappear at x-coordinate 32 (which should be off-screen because ERIC cannot release mice in the boys' skool)</td>
</tr>
<tr>
<td class="address-1"><span id="31446"></span>31446</td>
<td class="instruction">LD (HL),32</td>
</tr>
<tr>
<td class="address-1"><span id="31448"></span>31448</td>
<td class="instruction">JP <a href="25484.html#25492">25492</a></td>
<td class="comment-1" rowspan="1">Terminate this uninterruptible subcommand, thus returning control to the character who normally owns the buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31451"></span>
<div class="comments">
<div class="paragraph">
This mouse (released by ERIC) is about to come out of hiding.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31451"></span>31451</td>
<td class="instruction">LD A,(32767)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=leftmost column of the play area on screen</td>
</tr>
<tr>
<td class="address-1"><span id="31454"></span>31454</td>
<td class="instruction">CP 144</td>
<td class="comment-1" rowspan="1">Is at least half of the girls' skool on-screen?</td>
</tr>
<tr>
<td class="address-1"><span id="31456"></span>31456</td>
<td class="instruction">JR C,31429</td>
<td class="comment-1" rowspan="1">Terminate the mouse if not</td>
</tr>
<tr>
<td class="address-1"><span id="31458"></span>31458</td>
<td class="instruction">LD L,21</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="31460"></span>31460</td>
<td class="instruction">JR 31398</td>
<td class="comment-1" rowspan="1">Otherwise make the mouse reappear</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31252.html">31252</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31254">Map</a></td>
<td class="next">
Next: <a href="31462.html">31462</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20191115</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/7A16.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>