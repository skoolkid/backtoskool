<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 25815</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25812.html">25812</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25815">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25843.html">25843</a></span></td>
</tr>
</table>
<div class="description">25815: Make a character go to a random location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by command lists <a href="53820.html">18</a>, <a href="57942.html">20</a>, <a href="57956.html">28</a>, <a href="59151.html">40</a>, <a href="58828.html">42</a>, <a href="59673.html">66</a>, <a href="59677.html">68</a>, <a href="59765.html">78</a> and <a href="58862.html">88</a> to make a character go to a place at random. The random locations are arranged in eight groups of four. The group of locations that is suitable for a particular character to choose from is determined by byte 36 of the character's buffer.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (183-209)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25815"></span>25815</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,36</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 36 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25817"></span>25817</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the contents in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25818"></span>25818</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25819"></span>25819</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25822"></span>25822</td>
<td class="bytes-0"></td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=211, 212, 213 or 214</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25824"></span>25824</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,211</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25826"></span>25826</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at an entry in the table of random locations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25827"></span>25827</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,1</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25829"></span>25829</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25830"></span>25830</td>
<td class="bytes-0"></td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character already at this x-coordinate?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25831"></span>25831</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,25819</td>
<td class="comment-11" rowspan="1">Get another random location if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25833"></span>25833</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,5</td>
<td class="comment-11" rowspan="3">Copy the random location's coordinates into bytes 5 and 6 of the character's buffer, thus making it his next destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25835"></span>25835</td>
<td class="bytes-0"></td>
<td class="instruction">LDI</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25837"></span>25837</td>
<td class="bytes-0"></td>
<td class="instruction">LDI</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25839"></span>25839</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Transfer the character number back to <span class="register">H</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25840"></span>25840</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="25700.html#25705">25705</a></td>
<td class="comment-11" rowspan="1">Send the character on his way</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">

<div class="comments">
<div class="paragraph">
The contents of byte 36 of each character's buffer are as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">H</span></th>
<th colspan="1" rowspan="1">Character</th>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Byte</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">183</td>
<td class="" colspan="1" rowspan="1">Little girl no. 1</td>
<td class="centre" colspan="1" rowspan="1"><a href="46848.html#46884">46884</a></td>
<td class="centre" colspan="1" rowspan="1">36</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">184</td>
<td class="" colspan="1" rowspan="1">Little girl no. 2</td>
<td class="centre" colspan="1" rowspan="1"><a href="47104.html#47140">47140</a></td>
<td class="centre" colspan="1" rowspan="1">36</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">185</td>
<td class="" colspan="1" rowspan="1">Little girl no. 3</td>
<td class="centre" colspan="1" rowspan="1"><a href="47360.html#47396">47396</a></td>
<td class="centre" colspan="1" rowspan="1">36</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">186</td>
<td class="" colspan="1" rowspan="1">Little girl no. 4</td>
<td class="centre" colspan="1" rowspan="1"><a href="47616.html#47652">47652</a></td>
<td class="centre" colspan="1" rowspan="1">38</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">187</td>
<td class="" colspan="1" rowspan="1">Little girl no. 5</td>
<td class="centre" colspan="1" rowspan="1"><a href="47872.html#47908">47908</a></td>
<td class="centre" colspan="1" rowspan="1">38</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">188</td>
<td class="" colspan="1" rowspan="1">Little girl no. 6</td>
<td class="centre" colspan="1" rowspan="1"><a href="48128.html#48164">48164</a></td>
<td class="centre" colspan="1" rowspan="1">38</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">Little girl no. 7</td>
<td class="centre" colspan="1" rowspan="1"><a href="48384.html#48420">48420</a></td>
<td class="centre" colspan="1" rowspan="1">38</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">190</td>
<td class="" colspan="1" rowspan="1">Little boy no. 1</td>
<td class="centre" colspan="1" rowspan="1"><a href="48640.html#48676">48676</a></td>
<td class="centre" colspan="1" rowspan="1">40</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">Little boy no. 2</td>
<td class="centre" colspan="1" rowspan="1"><a href="48896.html#48932">48932</a></td>
<td class="centre" colspan="1" rowspan="1">40</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">192</td>
<td class="" colspan="1" rowspan="1">Little boy no. 3</td>
<td class="centre" colspan="1" rowspan="1"><a href="49152.html#49188">49188</a></td>
<td class="centre" colspan="1" rowspan="1">40</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">Little boy no. 4</td>
<td class="centre" colspan="1" rowspan="1"><a href="49408.html#49444">49444</a></td>
<td class="centre" colspan="1" rowspan="1">42</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">194</td>
<td class="" colspan="1" rowspan="1">Little boy no. 5</td>
<td class="centre" colspan="1" rowspan="1"><a href="49664.html#49700">49700</a></td>
<td class="centre" colspan="1" rowspan="1">42</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">Little boy no. 6</td>
<td class="centre" colspan="1" rowspan="1"><a href="49920.html#49956">49956</a></td>
<td class="centre" colspan="1" rowspan="1">42</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">Little boy no. 7</td>
<td class="centre" colspan="1" rowspan="1"><a href="50176.html#50212">50212</a></td>
<td class="centre" colspan="1" rowspan="1">42</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">Little boy no. 8</td>
<td class="centre" colspan="1" rowspan="1"><a href="50432.html#50468">50468</a></td>
<td class="centre" colspan="1" rowspan="1">42</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">198</td>
<td class="" colspan="1" rowspan="1">Little boy no. 9</td>
<td class="centre" colspan="1" rowspan="1"><a href="50688.html#50724">50724</a></td>
<td class="centre" colspan="1" rowspan="1">44</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">Little boy no. 10</td>
<td class="centre" colspan="1" rowspan="1"><a href="50944.html#50980">50980</a></td>
<td class="centre" colspan="1" rowspan="1">44</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">MR WACKER</td>
<td class="centre" colspan="1" rowspan="1"><a href="51200.html#51236">51236</a></td>
<td class="centre" colspan="1" rowspan="1">48</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">201</td>
<td class="" colspan="1" rowspan="1">MR WITHIT</td>
<td class="centre" colspan="1" rowspan="1"><a href="51456.html#51492">51492</a></td>
<td class="centre" colspan="1" rowspan="1">48</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">202</td>
<td class="" colspan="1" rowspan="1">MR ROCKITT</td>
<td class="centre" colspan="1" rowspan="1"><a href="51712.html#51748">51748</a></td>
<td class="centre" colspan="1" rowspan="1">68</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">203</td>
<td class="" colspan="1" rowspan="1">MR CREAK</td>
<td class="centre" colspan="1" rowspan="1"><a href="51968.html#52004">52004</a></td>
<td class="centre" colspan="1" rowspan="1">68</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">204</td>
<td class="" colspan="1" rowspan="1">MISS TAKE</td>
<td class="centre" colspan="1" rowspan="1"><a href="52224.html#52260">52260</a></td>
<td class="centre" colspan="1" rowspan="1">38</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">205</td>
<td class="" colspan="1" rowspan="1">ALBERT</td>
<td class="centre" colspan="1" rowspan="1"><a href="52480.html#52516">52516</a></td>
<td class="centre" colspan="1" rowspan="1">44</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">206</td>
<td class="" colspan="1" rowspan="1">BOY WANDER</td>
<td class="centre" colspan="1" rowspan="1"><a href="52736.html#52772">52772</a></td>
<td class="centre" colspan="1" rowspan="1">46</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">ANGELFACE</td>
<td class="centre" colspan="1" rowspan="1"><a href="52992.html#53028">53028</a></td>
<td class="centre" colspan="1" rowspan="1">46</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">208</td>
<td class="" colspan="1" rowspan="1">EINSTEIN</td>
<td class="centre" colspan="1" rowspan="1"><a href="53248.html#53284">53284</a></td>
<td class="centre" colspan="1" rowspan="1">44</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">209</td>
<td class="" colspan="1" rowspan="1">HAYLEY</td>
<td class="centre" colspan="1" rowspan="1"><a href="53504.html#53540">53540</a></td>
<td class="centre" colspan="1" rowspan="1">36</td>
</tr>
</table>
</div>
<div class="paragraph">
The eight groups of random locations used by this routine are:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">E</span></th>
<th colspan="1" rowspan="1"><span class="register">D</span>=211</th>
<th colspan="1" rowspan="1"><span class="register">D</span>=212</th>
<th colspan="1" rowspan="1"><span class="register">D</span>=213</th>
<th colspan="1" rowspan="1"><span class="register">D</span>=214</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">36</td>
<td class="" colspan="1" rowspan="1">129,17</td>
<td class="" colspan="1" rowspan="1">144,17</td>
<td class="" colspan="1" rowspan="1">136,17</td>
<td class="" colspan="1" rowspan="1">189,17</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">38</td>
<td class="" colspan="1" rowspan="1">189,17</td>
<td class="" colspan="1" rowspan="1">189,10</td>
<td class="" colspan="1" rowspan="1">170,17</td>
<td class="" colspan="1" rowspan="1">182,3</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">40</td>
<td class="" colspan="1" rowspan="1">38,3</td>
<td class="" colspan="1" rowspan="1">10,10</td>
<td class="" colspan="1" rowspan="1">10,17</td>
<td class="" colspan="1" rowspan="1">66,17</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">42</td>
<td class="" colspan="1" rowspan="1">38,3</td>
<td class="" colspan="1" rowspan="1">10,17</td>
<td class="" colspan="1" rowspan="1">109,17</td>
<td class="" colspan="1" rowspan="1">75,17</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">44</td>
<td class="" colspan="1" rowspan="1">112,17</td>
<td class="" colspan="1" rowspan="1">145,17</td>
<td class="" colspan="1" rowspan="1">158,17</td>
<td class="" colspan="1" rowspan="1">37,3</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">46</td>
<td class="" colspan="1" rowspan="1">189,10</td>
<td class="" colspan="1" rowspan="1">183,17</td>
<td class="" colspan="1" rowspan="1">137,17</td>
<td class="" colspan="1" rowspan="1">72,17</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">48</td>
<td class="" colspan="1" rowspan="1">157,17</td>
<td class="" colspan="1" rowspan="1">38,3</td>
<td class="" colspan="1" rowspan="1">10,17</td>
<td class="" colspan="1" rowspan="1">92,17</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">68</td>
<td class="" colspan="1" rowspan="1">38,3</td>
<td class="" colspan="1" rowspan="1">90,3</td>
<td class="" colspan="1" rowspan="1">10,17</td>
<td class="" colspan="1" rowspan="1">90,17</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25812.html">25812</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25815">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25843.html">25843</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20190617</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/64D7.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>