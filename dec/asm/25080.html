<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 25080</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25026.html">25026</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25080">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25186.html">25186</a></span></td>
</tr>
</table>
<div class="description">25080: Scroll the screen right 8 columns</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="28160.html">28160</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25080"></span>25080</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,8</td>
<td class="comment-11" rowspan="1">8 columns will be scrolled on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25082"></span>25082</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the column counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25083"></span>25083</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,23198</td>
<td class="comment-11" rowspan="4">First shift the attributes one place to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25086"></span>25086</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,23199</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25089"></span>25089</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,671</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25092"></span>25092</td>
<td class="bytes-0"></td>
<td class="instruction">LDDR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25094"></span>25094</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="63561.html">63561</a></td>
<td class="comment-11" rowspan="1">Scroll the display file one character square to the right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25097"></span>25097</td>
<td class="bytes-0"></td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Adjust the leftmost column of the play area now on screen (held at <a href="32767.html">32767</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25098"></span>25098</td>
<td class="bytes-0"></td>
<td class="instruction">LD (32767),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25101"></span>25101</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,5120</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=20 (bottom row of the screen), <span class="register">L</span>=0 (column at the far left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25104"></span>25104</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25105"></span>25105</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="24684.html">24684</a></td>
<td class="comment-11" rowspan="1">Print the play area character square at row <span class="register">H</span>, column <span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25108"></span>25108</td>
<td class="bytes-0"></td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25109"></span>25109</td>
<td class="bytes-0"></td>
<td class="instruction">DEC H</td>
<td class="comment-11" rowspan="1">Next row up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25110"></span>25110</td>
<td class="bytes-0"></td>
<td class="instruction">JP P,25104</td>
<td class="comment-11" rowspan="1">Jump back until all 21 squares in the column have been printed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25113"></span>25113</td>
<td class="bytes-0"></td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the column counter to <span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25114"></span>25114</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ 25082</td>
<td class="comment-11" rowspan="1">Jump back until 8 columns have been scrolled on</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25116"></span>
<div class="comments">
<div class="paragraph">
The screen has been scrolled right 8 columns. Check whether any of the minor characters may be teleported without us noticing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25116"></span>25116</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32767)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=leftmost column of the play area now on screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25119"></span>25119</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,4</td>
<td class="comment-11" rowspan="2">4 little girls, starting with 186=little girl no. 4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25121"></span>25121</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,186</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25123"></span>25123</td>
<td class="bytes-0"></td>
<td class="instruction">CP 112</td>
<td class="comment-11" rowspan="1">Was the skool gate in the middle of the screen before scrolling?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25125"></span>25125</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,25134</td>
<td class="comment-11" rowspan="1">Jump if so (to consider teleporting little girls 4-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25127"></span>25127</td>
<td class="bytes-0"></td>
<td class="instruction">CP 72</td>
<td class="comment-11" rowspan="1">Was the boys' skool door in the middle of the screen before scrolling?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25129"></span>25129</td>
<td class="bytes-0"></td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25130"></span>25130</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,183</td>
<td class="comment-11" rowspan="1">183=little girl no. 1</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25132"></span>
<div class="comments">
<div class="paragraph">
The next section of code moves certain off-screen minor characters straight to their destination. Sneaky! This entry point is used by the routine at <a href="25026.html">25026</a> with <span class="register">H</span>=190 (little boy no. 1).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25132"></span>25132</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,3</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25134"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="25026.html">25026</a> (with <span class="register">H</span>=193, <span class="register">B</span>=5) and <a href="63309.html">63309</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25134"></span>25134</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,29</td>
<td class="comment-11" rowspan="2">Bit 3 of byte 29 is set if the character should be moved immediately to the next destination in his command list</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25136"></span>25136</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 3,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25138"></span>25138</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,25182</td>
<td class="comment-11" rowspan="1">Jump if this character should not be 'teleported'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25140"></span>25140</td>
<td class="bytes-0"></td>
<td class="instruction">RES 3,(HL)</td>
<td class="comment-11" rowspan="1">Reset bit 3 now, so that this character is not considered for teleportation again during this lesson</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25142"></span>25142</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=28</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25143"></span>25143</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="3">Collect the address reached in the command list into <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25144"></span>25144</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25145"></span>25145</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25146"></span>25146</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=LSB of this address</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25147"></span>25147</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 100</td>
<td class="comment-11" rowspan="1">Is this the address of the routine at <a href="25700.html">25700</a>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25149"></span>25149</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,25182</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25151"></span>25151</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=26</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25152"></span>25152</td>
<td class="bytes-0"></td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="2">Point <span class="register">DE</span> at the location coordinates (the parameters of <a href="25700.html">25700</a> in the command list)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25153"></span>25153</td>
<td class="bytes-0"></td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25154"></span>25154</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),D</td>
<td class="comment-11" rowspan="3">Store this address in bytes 25 and 26 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25155"></span>25155</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25156"></span>25156</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25157"></span>25157</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=24</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25158"></span>25158</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="3">Fill bytes 1-24 of the character's buffer with zeroes</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25159"></span>25159</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25160"></span>25160</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,25158</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25162"></span>25162</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Set the character's animatory state to its base value (cancelling any midstride or knockout)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25163"></span>25163</td>
<td class="bytes-0"></td>
<td class="instruction">AND 248</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25165"></span>25165</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25166"></span>25166</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25167"></span>25167</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="25188.html">25188</a></td>
<td class="comment-11" rowspan="1">Bring the location coordinates from the command list into bytes 1 and 2 of the buffer, effecting the teleportation</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25170"></span>25170</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="3">Collect the character's new coordinates into <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25171"></span>25171</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25172"></span>25172</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25173"></span>25173</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,5</td>
<td class="comment-11" rowspan="4">Copy these coordinates into bytes 5 and 6 of the buffer, which normally hold the character's destination; this is to let the routine at <a href="25700.html">25700</a> know it has nothing left to do</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25175"></span>25175</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25176"></span>25176</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25177"></span>25177</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25178"></span>25178</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,29</td>
<td class="comment-11" rowspan="2">Reset bit 0 of byte 29, cancelling any pending request to restart the command list</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25180"></span>25180</td>
<td class="bytes-0"></td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25182"></span>25182</td>
<td class="bytes-0"></td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Next character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25183"></span>25183</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ 25134</td>
<td class="comment-11" rowspan="1">Jump back until all characters have been done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25185"></span>25185</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="25026.html">25026</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25080">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25186.html">25186</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20190617</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/61F8.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>