<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 25296</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25248.html">25248</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25296">Map</a></td>
<td class="next">
Next: <a href="25484.html">25484</a>
</td>
</tr>
</table>
<div class="description">25296: Move the characters</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="63156.html">63156</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25296"></span>25296</td>
<td class="instruction">CALL 25302</td>
<td class="comment-1" rowspan="1">Move one character</td>
</tr>
<tr>
<td class="address-1"><span id="25299"></span>25299</td>
<td class="instruction">CALL 25302</td>
<td class="comment-1" rowspan="1">Move the next character</td>
</tr>
<tr>
<td class="address-2"><span id="25302"></span>25302</td>
<td class="instruction">LD HL,32764</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="25305"></span>25305</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=number of the character last moved (183-209, 211-214)</td>
</tr>
<tr>
<td class="address-2"><span id="25306"></span>25306</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=number of the next character to move</td>
</tr>
<tr>
<td class="address-1"><span id="25307"></span>25307</td>
<td class="instruction">CP 210</td>
<td class="comment-1" rowspan="1">Is it ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="25309"></span>25309</td>
<td class="instruction">JR Z,25306</td>
<td class="comment-1" rowspan="1">Jump if so (we don't want to move ERIC!)</td>
</tr>
<tr>
<td class="address-1"><span id="25311"></span>25311</td>
<td class="instruction">CP 215</td>
<td class="comment-1" rowspan="1">Have we completed an entire cast movement cycle?</td>
</tr>
<tr>
<td class="address-1"><span id="25313"></span>25313</td>
<td class="instruction">JR C,25317</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="25315"></span>25315</td>
<td class="instruction">LD A,183</td>
<td class="comment-1" rowspan="1">Back to 183 (little girl no. 1) if so</td>
</tr>
<tr>
<td class="address-2"><span id="25317"></span>25317</td>
<td class="instruction">CP 198</td>
<td class="comment-1" rowspan="1">Are we dealing with little girls 1-7 or little boys 1-8?</td>
</tr>
<tr>
<td class="address-1"><span id="25319"></span>25319</td>
<td class="instruction">JR NC,25360</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25321"></span>
<div class="comments">
<div class="paragraph">
It's the turn of one of the little girls (183-189), or one of the first 8 little boys (190-197). But if the part of the play area currently on-screen is somewhere this character never ventures into, we skip ahead to the next suitable candidate. Specifically, the following characters are skipped depending on the value of X (the leftmost column of the skool on-screen):
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">X</th>
<th colspan="1" rowspan="1">Skip</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">X&lt;=72</td>
<td class="" colspan="1" rowspan="1">girls 1-7 (183-189)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">80&lt;=X&lt;=112</td>
<td class="" colspan="1" rowspan="1">girls 4-7 and boys 1-3 (187-192)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">X&gt;=120</td>
<td class="" colspan="1" rowspan="1">boys 1-8 (190-197)</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25321"></span>25321</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=character number (183-197)</td>
</tr>
<tr>
<td class="address-1"><span id="25322"></span>25322</td>
<td class="instruction">LD D,190</td>
<td class="comment-1" rowspan="1">190=little boy no. 1</td>
</tr>
<tr>
<td class="address-1"><span id="25324"></span>25324</td>
<td class="instruction">LD A,(32767)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=leftmost column of the play area on screen</td>
</tr>
<tr>
<td class="address-1"><span id="25327"></span>25327</td>
<td class="instruction">CP 80</td>
<td class="comment-1" rowspan="1">This is the x-coordinate of the middle of the assembly hall stage</td>
</tr>
<tr>
<td class="address-1"><span id="25329"></span>25329</td>
<td class="instruction">JR NC,25338</td>
<td class="comment-1" rowspan="1">Jump if we can't see to the left of this</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25331"></span>
<div class="comments">
<div class="paragraph">
We are deep into the boys' skool, where no girls ever set foot.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25331"></span>25331</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character number (183-197)</td>
</tr>
<tr>
<td class="address-1"><span id="25332"></span>25332</td>
<td class="instruction">CP D</td>
<td class="comment-1" rowspan="1">Is this a little boy?</td>
</tr>
<tr>
<td class="address-1"><span id="25333"></span>25333</td>
<td class="instruction">JR NC,25360</td>
<td class="comment-1" rowspan="1">Move him if so</td>
</tr>
<tr>
<td class="address-1"><span id="25335"></span>25335</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="2">Otherwise bypass the little girls and skip ahead to little boy no. 1 (190)</td>
</tr>
<tr>
<td class="address-1"><span id="25336"></span>25336</td>
<td class="instruction">JR 25360</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25338"></span>
<div class="comments">
<div class="paragraph">
The leftmost column of the play area on screen is at least 80.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25338"></span>25338</td>
<td class="instruction">CP 120</td>
<td class="comment-1" rowspan="1">This x-coordinate is about halfway between the tree and the gate</td>
</tr>
<tr>
<td class="address-1"><span id="25340"></span>25340</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character number (183-197)</td>
</tr>
<tr>
<td class="address-1"><span id="25341"></span>25341</td>
<td class="instruction">JR C,25350</td>
<td class="comment-1" rowspan="1">Jump if we can't see the first half of the girls' playground</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25343"></span>
<div class="comments">
<div class="paragraph">
The leftmost column of the play area on screen is at least 120. Little boys 1-8 never set foot here.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25343"></span>25343</td>
<td class="instruction">CP D</td>
<td class="comment-1" rowspan="1">Is this a little girl?</td>
</tr>
<tr>
<td class="address-1"><span id="25344"></span>25344</td>
<td class="instruction">JR C,25360</td>
<td class="comment-1" rowspan="1">Move her if so</td>
</tr>
<tr>
<td class="address-1"><span id="25346"></span>25346</td>
<td class="instruction">LD A,198</td>
<td class="comment-1" rowspan="2">Otherwise bypass little boys 1-8 and skip ahead to little boy no. 9 (198)</td>
</tr>
<tr>
<td class="address-1"><span id="25348"></span>25348</td>
<td class="instruction">JR 25360</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25350"></span>
<div class="comments">
<div class="paragraph">
The leftmost column of the play area on screen is between 80 and 112. Little girls 4-7 and little boys 1-3 never visit these parts.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25350"></span>25350</td>
<td class="instruction">CP 186</td>
<td class="comment-1" rowspan="1">Is this little girl no. 1-3?</td>
</tr>
<tr>
<td class="address-1"><span id="25352"></span>25352</td>
<td class="instruction">JR C,25360</td>
<td class="comment-1" rowspan="1">Move her if so</td>
</tr>
<tr>
<td class="address-1"><span id="25354"></span>25354</td>
<td class="instruction">CP 193</td>
<td class="comment-1" rowspan="1">Is this little boy no. 4-8?</td>
</tr>
<tr>
<td class="address-1"><span id="25356"></span>25356</td>
<td class="instruction">JR NC,25360</td>
<td class="comment-1" rowspan="1">Move him if so</td>
</tr>
<tr>
<td class="address-1"><span id="25358"></span>25358</td>
<td class="instruction">LD A,193</td>
<td class="comment-1" rowspan="1">Otherwise bypass little girls 4-7 and little boys 1-3 and skip ahead to little boy no. 4 (193)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25360"></span>
<div class="comments">
<div class="paragraph">
We've now determined which character to move next. His character number is in <span class="register">A</span>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25360"></span>25360</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store the number of the character to be moved next in <a href="32764.html">32764</a></td>
</tr>
<tr>
<td class="address-1"><span id="25361"></span>25361</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at byte 30 of this character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25362"></span>25362</td>
<td class="instruction">LD L,30</td>
</tr>
<tr>
<td class="address-1"><span id="25364"></span>25364</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Is it time to consider a change in walking speed?</td>
</tr>
<tr>
<td class="address-1"><span id="25365"></span>25365</td>
<td class="instruction">JR NZ,25401</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25367"></span>
<div class="comments">
<div class="paragraph">
It's time to consider a change in walking speed. If the character is a boy or girl, decide whether they will walk or run for the next little while.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25367"></span>25367</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="25370"></span>25370</td>
<td class="instruction">AND 31</td>
<td class="comment-1" rowspan="1">0&lt;=<span class="register">A</span>&lt;=31</td>
</tr>
<tr>
<td class="address-1"><span id="25372"></span>25372</td>
<td class="instruction">ADD A,32</td>
<td class="comment-1" rowspan="1">32&lt;=<span class="register">A</span>&lt;=63</td>
</tr>
<tr>
<td class="address-1"><span id="25374"></span>25374</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1">16&lt;=<span class="register">A</span>&lt;=31 (and the carry flag is set if the random number was odd)</td>
</tr>
<tr>
<td class="address-1"><span id="25375"></span>25375</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Place this number into byte 30 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25376"></span>25376</td>
<td class="instruction">SBC A,A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0 if the random number was even, 255 otherwise</td>
</tr>
<tr>
<td class="address-1"><span id="25377"></span>25377</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=29</td>
</tr>
<tr>
<td class="address-1"><span id="25378"></span>25378</td>
<td class="instruction">AND 128</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0 (character will walk) or 128 (character will run if he's a kid)</td>
</tr>
<tr>
<td class="address-1"><span id="25380"></span>25380</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Superimpose the current contents of byte 29</td>
</tr>
<tr>
<td class="address-1"><span id="25381"></span>25381</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-1" rowspan="1">Is this a human character (183&lt;=<span class="register">H</span>&lt;=209)?</td>
</tr>
<tr>
<td class="address-1"><span id="25383"></span>25383</td>
<td class="instruction">JR NZ,25389</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25385"></span>
<div class="comments">
<div class="paragraph">
We're dealing with a human character. Bit 4 of byte 29 of the character's buffer is never set, but if it were, it would make the character run until the current command list routine has finished. Check bit 4 of byte 29 now.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25385"></span>25385</td>
<td class="instruction">BIT 4,(HL)</td>
<td class="comment-1" rowspan="1">Bit 4 of byte 29 is unused and always reset</td>
</tr>
<tr>
<td class="address-1"><span id="25387"></span>25387</td>
<td class="instruction">JR Z,25393</td>
<td class="comment-1" rowspan="1">Always make this jump</td>
</tr>
<tr>
<td class="address-2"><span id="25389"></span>25389</td>
<td class="instruction">OR 128</td>
<td class="comment-1" rowspan="1">Ensure that bit 7 of byte 29 is set for non-human characters</td>
</tr>
<tr>
<td class="address-1"><span id="25391"></span>25391</td>
<td class="instruction">JR 25399</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="25393"></span>25393</td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-1" rowspan="1">Is this an adult character (200&lt;=<span class="register">H</span>&lt;=205)?</td>
</tr>
<tr>
<td class="address-1"><span id="25395"></span>25395</td>
<td class="instruction">JR Z,25399</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="25397"></span>25397</td>
<td class="instruction">AND 127</td>
<td class="comment-1" rowspan="1">Ensure that bit 7 of byte 29 is reset for adult characters (to make them walk)</td>
</tr>
<tr>
<td class="address-2"><span id="25399"></span>25399</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Restore byte 29 with bit 7 set (run) or reset (walk) as appropriate</td>
</tr>
<tr>
<td class="address-1"><span id="25400"></span>25400</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=30</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25401"></span>
<div class="comments">
<div class="paragraph">
Now to determine whether to move the character this time round. The answer will be yes if byte 30 (which is decremented on each pass through this routine) is even, or bit 7 of byte 29 is set (indicating that the character is either running or non-human).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25401"></span>25401</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is the counter at byte 30 currently even?</td>
</tr>
<tr>
<td class="address-1"><span id="25403"></span>25403</td>
<td class="instruction">JR Z,25409</td>
<td class="comment-1" rowspan="1">Jump if so (half the time)</td>
</tr>
<tr>
<td class="address-1"><span id="25405"></span>25405</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=29</td>
</tr>
<tr>
<td class="address-1"><span id="25406"></span>25406</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the character both human and not running?</td>
</tr>
<tr>
<td class="address-1"><span id="25408"></span>25408</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25409"></span>
<div class="comments">
<div class="paragraph">
The character shall be moved. From this point, the following steps are taken:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Step</th>
<th colspan="1" rowspan="1">Action</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">If there is an uninterruptible subcommand routine address in bytes 17 and 18 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">If there is a continual subcommand routine address in bytes 23 and 24 of the character's buffer, call it (and then return to step 3)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">If there is an interruptible subcommand routine address in bytes 9 and 10 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Restart the command list if bit 0 of byte 29 of the character's buffer is set (and carry on to step 5)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">If there is a primary command routine address in bytes 3 and 4 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Remove any continual subcommand routine address from bytes 23 and 24 of the character's buffer</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">Collect the next primary command routine address from the command list, place it into bytes 3 and 4 of the character's buffer, and jump to it</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following uninterruptible subcommand routines (or an entry point thereof) may be present in bytes 17 and 18 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Description</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="24328.html">24328</a></td>
<td class="" colspan="1" rowspan="1">Make HAYLEY hit ERIC</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26224.html">26224</a></td>
<td class="" colspan="1" rowspan="1">Deal with a character who's been dethroned (1)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26239.html">26239</a></td>
<td class="" colspan="1" rowspan="1">Deal with a character who's been dethroned (2)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26263.html">26263</a></td>
<td class="" colspan="1" rowspan="1">Deal with a character who is looking for a seat</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="27904.html#27941">27941</a></td>
<td class="" colspan="1" rowspan="1">Make a boy sit still until assembly is finished</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="28855.html">28855</a></td>
<td class="" colspan="1" rowspan="1">Make a character open or close a door</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="29194.html">29194</a></td>
<td class="" colspan="1" rowspan="1">Control the bike when ERIC's not sitting on the saddle</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="29896.html">29896</a></td>
<td class="" colspan="1" rowspan="1">Control the descent of the water, sherry or conker</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30102.html">30102</a></td>
<td class="" colspan="1" rowspan="1">Deal with a character who has been knocked over</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30380.html">30380</a></td>
<td class="" colspan="1" rowspan="1">Control the flight of a catapult pellet</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30643.html">30643</a></td>
<td class="" colspan="1" rowspan="1">Deal with BOY WANDER when he is firing</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30739.html">30739</a></td>
<td class="" colspan="1" rowspan="1">Deal with ANGELFACE when he is hitting</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30804.html">30804</a></td>
<td class="" colspan="1" rowspan="1">Deal with the frog when it has been knocked out of a cup</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30906.html">30906</a></td>
<td class="" colspan="1" rowspan="1">Control the frog</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="31078.html">31078</a></td>
<td class="" colspan="1" rowspan="1">Control a female character while she's standing on a chair or jumping (1)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="31092.html">31092</a></td>
<td class="" colspan="1" rowspan="1">Make a female character stand on a chair or start jumping</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="31254.html">31254</a></td>
<td class="" colspan="1" rowspan="1">Control a mouse</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="53796.html">53796</a></td>
<td class="" colspan="1" rowspan="1">Make a character do nothing</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62178.html#62386">62386</a></td>
<td class="" colspan="1" rowspan="1">Control an open desk lid</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63586.html#63627">63627</a></td>
<td class="" colspan="1" rowspan="1">Control a stinkbomb cloud</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63586.html#63733">63733</a></td>
<td class="" colspan="1" rowspan="1">Make MR WACKER find a window to open after smelling a stinkbomb</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63915.html#63960">63960</a></td>
<td class="" colspan="1" rowspan="1">Control water fired from the pistol</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="64077.html#64175">64175</a></td>
<td class="" colspan="1" rowspan="1">Control a watered plant</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following continual subcommand routines (or an entry point thereof) may be present in bytes 23 and 24 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Description</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="30555.html">30555</a></td>
<td class="" colspan="1" rowspan="1">Make BOY WANDER fire his catapult now and then</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62668.html">62668</a></td>
<td class="" colspan="1" rowspan="1">Make ALBERT keep an eye out for ERIC during lessons</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63455.html">63455</a></td>
<td class="" colspan="1" rowspan="1">Make ANGELFACE stalk HAYLEY</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63492.html">63492</a></td>
<td class="" colspan="1" rowspan="1">Make ANGELFACE or BOY WANDER hit or fire now and then</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following interruptible subcommand routines (or an entry point thereof) may be present in bytes 9 and 10 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Description</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="25581.html">25581</a></td>
<td class="" colspan="1" rowspan="1">Guide a character to an intermediate destination</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="25656.html">25656</a></td>
<td class="" colspan="1" rowspan="1">Guide a character up a staircase</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="25677.html">25677</a></td>
<td class="" colspan="1" rowspan="1">Guide a character down a staircase</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26639.html">26639</a></td>
<td class="" colspan="1" rowspan="1">Make a teacher wipe a blackboard</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26752.html">26752</a></td>
<td class="" colspan="1" rowspan="1">Make a character write on a blackboard</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="27144.html">27144</a></td>
<td class="" colspan="1" rowspan="1">Make a character speak</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="32379.html">32379</a></td>
<td class="" colspan="1" rowspan="1">Make MISS TAKE chase ERIC (2)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61463.html">61463</a></td>
<td class="" colspan="1" rowspan="1">Make EINSTEIN speak</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61595.html">61595</a></td>
<td class="" colspan="1" rowspan="1">Make a teacher find the truant ERIC</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62794.html">62794</a></td>
<td class="" colspan="1" rowspan="1">Make MR WACKER find the truant ERIC</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following primary command routines (or an entry point thereof) may be present in bytes 3 and 4 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Description</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="25700.html">25700</a></td>
<td class="" colspan="1" rowspan="1">Make a character go to a location</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="25815.html">25815</a></td>
<td class="" colspan="1" rowspan="1">Make a character go to a random location</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="26304.html">26304</a></td>
<td class="" colspan="1" rowspan="1">Make a character find a seat</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="27904.html">27904</a></td>
<td class="" colspan="1" rowspan="1">Control a boy during assembly</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="29052.html">29052</a></td>
<td class="" colspan="1" rowspan="1">Make a character open or close a door</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="31952.html">31952</a></td>
<td class="" colspan="1" rowspan="1">Make a character walk up and down until a certain time</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="31969.html">31969</a></td>
<td class="" colspan="1" rowspan="1">Make a character walk up and down a few times or until a certain time</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="32497.html">32497</a></td>
<td class="" colspan="1" rowspan="1">Make BOY WANDER write on a blackboard</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="53796.html">53796</a></td>
<td class="" colspan="1" rowspan="1">Make a character do nothing</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61440.html">61440</a></td>
<td class="" colspan="1" rowspan="1">Control EINSTEIN during class</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61555.html">61555</a></td>
<td class="" colspan="1" rowspan="1">Restart the command list or make a teacher tell the kids to sit down</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61624.html">61624</a></td>
<td class="" colspan="1" rowspan="1">Restart the command list</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61631.html">61631</a></td>
<td class="" colspan="1" rowspan="1">Make a teacher find ERIC if he's absent during dinner</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61658.html">61658</a></td>
<td class="" colspan="1" rowspan="1">Control a teacher during assembly</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61696.html">61696</a></td>
<td class="" colspan="1" rowspan="1">Make a teacher conduct a class</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62032.html">62032</a></td>
<td class="" colspan="1" rowspan="1">Make MR WACKER put the kids in detention</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62560.html">62560</a></td>
<td class="" colspan="1" rowspan="1">Make the next command be the start of the command list</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62572.html">62572</a></td>
<td class="" colspan="1" rowspan="1">Restart the command list unless the boys' skool door is closed</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62599.html">62599</a></td>
<td class="" colspan="1" rowspan="1">Jump forward in the command list if the boys' skool door or the gate is closed</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62620.html">62620</a></td>
<td class="" colspan="1" rowspan="1">Wait till everyone has gone past the gate or the boys' skool door</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63447.html">63447</a></td>
<td class="" colspan="1" rowspan="1">Place a continual subcommand routine address into a character's buffer</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63501.html">63501</a></td>
<td class="" colspan="1" rowspan="1">Restart the command list unless it's time for assembly</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25409"></span>25409</td>
<td class="instruction">LD L,18</td>
<td class="comment-1" rowspan="4">Jump if there is an uninterruptible subcommand routine address in bytes 17 and 18 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25411"></span>25411</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25412"></span>25412</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="25413"></span>25413</td>
<td class="instruction">JR NZ,25479</td>
</tr>
<tr>
<td class="address-1"><span id="25415"></span>25415</td>
<td class="instruction">LD L,24</td>
<td class="comment-1" rowspan="4">Jump if there is no continual subcommand routine address in bytes 23 and 24 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25417"></span>25417</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25418"></span>25418</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="25419"></span>25419</td>
<td class="instruction">JR Z,25432</td>
</tr>
<tr>
<td class="address-1"><span id="25421"></span>25421</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the character number</td>
</tr>
<tr>
<td class="address-1"><span id="25422"></span>25422</td>
<td class="instruction">LD BC,25431</td>
<td class="comment-1" rowspan="2">Push <a href="25296.html#25431">25431</a> (the address of the entry point to return to) onto the stack</td>
</tr>
<tr>
<td class="address-1"><span id="25425"></span>25425</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address-1"><span id="25426"></span>25426</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="4">Collect the address of the continual subcommand routine from bytes 23 and 24 of the character's buffer into <span class="register">BC</span> and push it onto the stack</td>
</tr>
<tr>
<td class="address-1"><span id="25427"></span>25427</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="25428"></span>25428</td>
<td class="instruction">LD C,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25429"></span>25429</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="address-1"><span id="25430"></span>25430</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">JP (BC) and then return to <a href="25296.html#25431">25431</a> below</td>
</tr>
<tr>
<td class="address-2"><span id="25431"></span>25431</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the character number to <span class="register">H</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25432"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="25484.html#25492">25492</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25432"></span>25432</td>
<td class="instruction">LD L,10</td>
<td class="comment-1" rowspan="4">Jump if there is an interruptible subcommand routine address in bytes 9 and 10 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25434"></span>25434</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25435"></span>25435</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="25436"></span>25436</td>
<td class="instruction">JR NZ,25479</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25438"></span>
<div class="comments">
<div class="paragraph">
If we get here, that means there's no uninterruptible subcommand routine address in bytes 17 and 18 and no interruptible subcommand routine address in bytes 9 and 10 of the character's buffer at the moment. We take this opportunity to check whether a command list restart has been requested, by inspecting bit 0 of byte 29. This bit is set in the following routines on particular occasions:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Routine</th>
<th colspan="1" rowspan="1">Occasion</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="32062.html">32062</a></td>
<td class="" colspan="1" rowspan="1">MISS TAKE needs to chase ERIC out of the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="61595.html">61595</a></td>
<td class="" colspan="1" rowspan="1">A teacher must find the absent ERIC during class, dinner or assembly</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62668.html">62668</a></td>
<td class="" colspan="1" rowspan="1">MR WACKER must find the truant ERIC</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="62770.html">62770</a></td>
<td class="" colspan="1" rowspan="1">MR WACKER must find and expel ERIC</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="63309.html">63309</a></td>
<td class="" colspan="1" rowspan="1">Lesson has ended</td>
</tr>
</table>
</div>
<div class="paragraph">
In addition, a command in the command list may have requested a restart (see <a href="61555.html">61555</a>, <a href="61624.html">61624</a>, <a href="62572.html">62572</a> and <a href="63501.html">63501</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25438"></span>25438</td>
<td class="instruction">LD L,29</td>
<td class="comment-1" rowspan="2">Check bit 0 of byte 29: do we need to restart the command list?</td>
</tr>
<tr>
<td class="address-1"><span id="25440"></span>25440</td>
<td class="instruction">BIT 0,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25442"></span>25442</td>
<td class="instruction">JR Z,25457</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="25444"></span>25444</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 0 of byte 29 now that we are going to restart</td>
</tr>
<tr>
<td class="address-1"><span id="25446"></span>25446</td>
<td class="instruction">LD D,H</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="25447"></span>25447</td>
<td class="instruction">LD L,27</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at where the address of the character's current command list is held</td>
</tr>
<tr>
<td class="address-1"><span id="25449"></span>25449</td>
<td class="instruction">LD E,25</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at where the address of the place reached in the character's current command list is held</td>
</tr>
<tr>
<td class="address-1"><span id="25451"></span>25451</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="2">Copy the former into the latter (thus returning to the start of the command list)</td>
</tr>
<tr>
<td class="address-1"><span id="25453"></span>25453</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="address-1"><span id="25455"></span>25455</td>
<td class="instruction">JR 25467</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="25457"></span>25457</td>
<td class="instruction">LD L,4</td>
<td class="comment-1" rowspan="4">Jump if there is a primary command routine address in bytes 3 and 4 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25459"></span>25459</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25460"></span>25460</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="address-1"><span id="25461"></span>25461</td>
<td class="instruction">JR NZ,25479</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25463"></span>
<div class="comments">
<div class="paragraph">
There is no primary command routine address in bytes 3 and 4 of the character's buffer, which means it's time to move to the next command in the list.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25463"></span>25463</td>
<td class="instruction">LD L,29</td>
<td class="comment-1" rowspan="2">Reset bit 3 of byte 29, indicating that this character may not be considered for teleportation for the remainder of this lesson (see <a href="25026.html">25026</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="25465"></span>25465</td>
<td class="instruction">RES 3,(HL)</td>
</tr>
<tr>
<td class="address-2"><span id="25467"></span>25467</td>
<td class="instruction">RES 4,(HL)</td>
<td class="comment-1" rowspan="1">Reset bit 4 of byte 29, indicating that the character should no longer run if he was doing so (though this bit is unused and always reset)</td>
</tr>
<tr>
<td class="address-1"><span id="25469"></span>25469</td>
<td class="instruction">LD L,24</td>
<td class="comment-1" rowspan="2">Remove the address of any continual subcommand routine from bytes 23 and 24 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25471"></span>25471</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25473"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="63447.html">63447</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25473"></span>25473</td>
<td class="instruction">LD L,3</td>
<td class="comment-1" rowspan="2">Collect the routine address of the next command in the character's current command list and place it into bytes 3 and 4 of the buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25475"></span>25475</td>
<td class="instruction">CALL <a href="25188.html">25188</a></td>
</tr>
<tr>
<td class="address-1"><span id="25478"></span>25478</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=4</td>
</tr>
<tr>
<td class="address-2"><span id="25479"></span>25479</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="3">Collect the command routine address from bytes 3 and 4, bytes 9 and 10, or bytes 17 and 18 of the character's buffer into <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="25480"></span>25480</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="25481"></span>25481</td>
<td class="instruction">LD C,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25482"></span>25482</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Make an indirect jump to this address</td>
</tr>
<tr>
<td class="address-1"><span id="25483"></span>25483</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25248.html">25248</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25296">Map</a></td>
<td class="next">
Next: <a href="25484.html">25484</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20221122</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/62D0.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>