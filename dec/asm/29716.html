<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 29716</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29696.html">29696</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29716">Map</a></td>
<td class="next">
Next: <a href="29834.html">29834</a>
</td>
</tr>
</table>
<div class="description">29716: Make a teacher give lines</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="30102.html">30102</a>, <a href="32062.html">32062</a> and <a href="61487.html">61487</a>. Prints the lines message (e.g. '100 LINES ERIC') in a message box above the teacher's head, and shortly afterwards prints the reprimand message (e.g. 'NO CATAPULTS') in the same box.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Lines recipient's character number (206-210)</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Reprimand message number</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Teacher's character number (200-204)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="29716"></span>29716</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Save the lines recipient's character number briefly</td>
</tr>
<tr>
<td class="address-1"><span id="29717"></span>29717</td>
<td class="instruction">CALL <a href="29696.html">29696</a></td>
<td class="comment-1" rowspan="1">Collect in <span class="register">DE</span> the coordinates of the teacher's head</td>
</tr>
<tr>
<td class="address-1"><span id="29720"></span>29720</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the lines recipient's character number to <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="29721"></span>29721</td>
<td class="instruction">ADD A,77</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="61345.html">27</a>, <a href="61358.html">28</a>, <a href="61371.html">29</a>, <a href="61384.html">30</a> or <a href="61397.html">31</a> (message number for the lines recipient's name)</td>
</tr>
<tr>
<td class="address-1"><span id="29723"></span>29723</td>
<td class="instruction">LD (32650),A</td>
<td class="comment-1" rowspan="1">Place it into <a href="32650.html">32650</a> (the first byte of message <a href="32650.html">5</a>, which is used as a submessage of message <a href="59886.html">13</a>: '[12]0 LINES^[5]')</td>
</tr>
<tr>
<td class="address-1"><span id="29726"></span>29726</td>
<td class="instruction">SUB 22</td>
<td class="comment-1" rowspan="6">Compute the attribute byte to be used for the lines message: 15 (blue background) for BOY WANDER; 23 (red background) for ANGELFACE or EINSTEIN; 31 (magenta background) for HAYLEY or ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="29728"></span>29728</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="address-1"><span id="29729"></span>29729</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29730"></span>29730</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29731"></span>29731</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29732"></span>29732</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="address-1"><span id="29733"></span>29733</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy the lines message attribute byte to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="29734"></span>29734</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29735"></span>29735</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29736"></span>29736</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29737"></span>29737</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29738"></span>29738</td>
<td class="instruction">CALL <a href="27276.html">27276</a></td>
<td class="comment-1" rowspan="1">Save the area of screen that will be overwritten by the lines message</td>
</tr>
<tr>
<td class="address-1"><span id="29741"></span>29741</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29742"></span>29742</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return if the teacher giving lines is off-screen</td>
</tr>
<tr>
<td class="address-1"><span id="29743"></span>29743</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="address-1"><span id="29746"></span>29746</td>
<td class="instruction">AND 14</td>
<td class="comment-1" rowspan="7">Set <span class="register">L</span>=10, 20, 30, 40, 50, 60, 70 or 80 (number of lines divided by 10)</td>
</tr>
<tr>
<td class="address-1"><span id="29748"></span>29748</td>
<td class="instruction">ADD A,2</td>
</tr>
<tr>
<td class="address-1"><span id="29750"></span>29750</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="29751"></span>29751</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29752"></span>29752</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="29753"></span>29753</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="address-1"><span id="29754"></span>29754</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="29755"></span>29755</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=attribute byte for the lines message</td>
</tr>
<tr>
<td class="address-1"><span id="29756"></span>29756</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29757"></span>29757</td>
<td class="instruction">CP 15</td>
<td class="comment-1" rowspan="1">Is the teacher giving lines to BOY WANDER?</td>
</tr>
<tr>
<td class="address-1"><span id="29759"></span>29759</td>
<td class="instruction">JR Z,29774</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29761"></span>29761</td>
<td class="instruction">CP 31</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29763"></span>29763</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=number of lines divided by 10</td>
</tr>
<tr>
<td class="address-1"><span id="29764"></span>29764</td>
<td class="instruction">JR Z,29771</td>
<td class="comment-1" rowspan="1">Jump if the teacher is giving lines to ERIC or HAYLEY</td>
</tr>
<tr>
<td class="address-1"><span id="29766"></span>29766</td>
<td class="instruction">CALL <a href="29621.html">29621</a></td>
<td class="comment-1" rowspan="2">Add EINSTEIN's or ANGELFACE's lines to the score and print the score</td>
</tr>
<tr>
<td class="address-1"><span id="29769"></span>29769</td>
<td class="instruction">JR 29774</td>
</tr>
<tr>
<td class="address-2"><span id="29771"></span>29771</td>
<td class="instruction">CALL <a href="29643.html">29643</a></td>
<td class="comment-1" rowspan="1">Add lines and print the new lines total</td>
</tr>
<tr>
<td class="address-2"><span id="29774"></span>29774</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29775"></span>29775</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29776"></span>29776</td>
<td class="instruction">LD D,0</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=number of lines divided by 10</td>
</tr>
<tr>
<td class="address-1"><span id="29778"></span>29778</td>
<td class="instruction">CALL <a href="27572.html">27572</a></td>
<td class="comment-1" rowspan="1">Generate the ASCII codes for the decimal digits of the number in <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="29781"></span>29781</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the attribute file address for the top left corner of the lines message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="29782"></span>29782</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the lines reprimand number to <span class="register">B</span>. and the attribute byte for the lines message to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="29783"></span>29783</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save them again</td>
</tr>
<tr>
<td class="address-1"><span id="29784"></span>29784</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29785"></span>29785</td>
<td class="instruction">LD A,13</td>
<td class="comment-1" rowspan="1">Message <a href="59886.html">13</a>: '[12]0 LINES^[5]'</td>
</tr>
<tr>
<td class="address-1"><span id="29787"></span>29787</td>
<td class="instruction">CALL <a href="27462.html">27462</a></td>
<td class="comment-1" rowspan="1">Print the lines message</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29790"></span>
<div class="comments">
<div class="paragraph">
The lines message (e.g. '100 LINES ERIC') has been printed. Now for the accompanying sound effect.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="29790"></span>29790</td>
<td class="instruction">LD A,(58408)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=attribute byte for the lines message</td>
</tr>
<tr>
<td class="address-1"><span id="29793"></span>29793</td>
<td class="instruction">LD DE,10240</td>
<td class="comment-1" rowspan="1">Set the duration parameter for the beep</td>
</tr>
<tr>
<td class="address-1"><span id="29796"></span>29796</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="4">The border colour for the beep will be the same as the PAPER colour of the lines message box</td>
</tr>
<tr>
<td class="address-1"><span id="29797"></span>29797</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="29798"></span>29798</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="29799"></span>29799</td>
<td class="instruction">AND 7</td>
</tr>
<tr>
<td class="address-1"><span id="29801"></span>29801</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29802"></span>29802</td>
<td class="instruction">LD BC,5136</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=20 (pitch), <span class="register">C</span>=16 (no alternating colours)</td>
</tr>
<tr>
<td class="address-1"><span id="29805"></span>29805</td>
<td class="instruction">CALL <a href="29836.html">29836</a></td>
<td class="comment-1" rowspan="1">Beep</td>
</tr>
<tr>
<td class="address-1"><span id="29808"></span>29808</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=PAPER colour of the lines message</td>
</tr>
<tr>
<td class="address-1"><span id="29809"></span>29809</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the attribute file address for the top left corner of the lines message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="29810"></span>29810</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the lines reprimand number to <span class="register">B</span>. and the attribute byte for the lines message to <span class="register">C</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29811"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="29896.html">29896</a> (with <span class="register">A</span>=6, <span class="register">B</span>=<a href="59897.html">14</a>, <span class="register">C</span>=70) and <a href="62668.html">62668</a> (with <span class="register">A</span>=2, <span class="register">B</span>=<a href="60937.html">98</a>, <span class="register">C</span>=50).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29811"></span>29811</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29812"></span>29812</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29813"></span>29813</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="59897.html">14</a>, <a href="60937.html">98</a>, or a reprimand message number</td>
</tr>
<tr>
<td class="address-1"><span id="29814"></span>29814</td>
<td class="instruction">CALL <a href="27462.html">27462</a></td>
<td class="comment-1" rowspan="1">Print the message</td>
</tr>
<tr>
<td class="address-1"><span id="29817"></span>29817</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=border colour to use during the beep</td>
</tr>
<tr>
<td class="address-1"><span id="29818"></span>29818</td>
<td class="instruction">LD DE,5120</td>
<td class="comment-1" rowspan="1">Set the duration parameter for the beep</td>
</tr>
<tr>
<td class="address-1"><span id="29821"></span>29821</td>
<td class="instruction">LD BC,12816</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=50 (pitch), <span class="register">C</span>=16 (no alternating colours)</td>
</tr>
<tr>
<td class="address-1"><span id="29824"></span>29824</td>
<td class="instruction">CALL <a href="29836.html">29836</a></td>
<td class="comment-1" rowspan="1">Beep</td>
</tr>
<tr>
<td class="address-1"><span id="29827"></span>29827</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the attribute file address for the top left corner of the message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="29828"></span>29828</td>
<td class="instruction">LD HL,58152</td>
<td class="comment-1" rowspan="1">The part of the screen overwritten by the message box was stored in the buffer at <a href="58152.html">58152</a></td>
</tr>
<tr>
<td class="address-1"><span id="29831"></span>29831</td>
<td class="instruction">JP <a href="27364.html">27364</a></td>
<td class="comment-1" rowspan="1">Restore the area of the screen overwritten by the message box</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29696.html">29696</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29716">Map</a></td>
<td class="next">
Next: <a href="29834.html">29834</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20200811</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/7414.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>