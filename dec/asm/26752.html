<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 26752</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26750.html">26750</a>
</td>
<td class="up">Up: <a href="../maps/all.html#26752">Map</a></td>
<td class="next">
Next: <a href="26845.html">26845</a>
</td>
</tr>
</table>
<div class="description">26752: Make a character write on a blackboard</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this interruptible subcommand routine is placed into bytes 9 and 10 of the character's buffer by the routines at <a href="32497.html">32497</a> and <a href="61696.html">61696</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (201-204, 206)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="26752"></span>26752</td>
<td class="instruction">CALL <a href="26453.html">26453</a></td>
<td class="comment-1" rowspan="1">Collect information about the board</td>
</tr>
<tr>
<td class="address-1"><span id="26755"></span>26755</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="3">Point <span class="register">BC</span> at the second byte of the board's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="26756"></span>26756</td>
<td class="instruction">LD C,B</td>
</tr>
<tr>
<td class="address-1"><span id="26757"></span>26757</td>
<td class="instruction">LD B,127</td>
</tr>
<tr>
<td class="address-1"><span id="26759"></span>26759</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="26760"></span>26760</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Has the board been written on already?</td>
</tr>
<tr>
<td class="address-1"><span id="26761"></span>26761</td>
<td class="instruction">JP NZ,<a href="25484.html#25488">25488</a></td>
<td class="comment-1" rowspan="1">Terminate this interruptible subcommand if so</td>
</tr>
<tr>
<td class="address-1"><span id="26764"></span>26764</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's number</td>
</tr>
<tr>
<td class="address-1"><span id="26765"></span>26765</td>
<td class="instruction">LD (BC),A</td>
<td class="comment-1" rowspan="1">Signal: this character wrote on the board</td>
</tr>
<tr>
<td class="address-1"><span id="26766"></span>26766</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="3">Point <span class="register">BC</span> at the first byte of the board's buffer (<a href="32596.html">32596</a>, <a href="32602.html">32602</a>, <a href="32608.html">32608</a>, <a href="32614.html">32614</a> or <a href="32620.html">32620</a>) and initialise the pixel column to 1</td>
</tr>
<tr>
<td class="address-1"><span id="26767"></span>26767</td>
<td class="instruction">LD A,1</td>
</tr>
<tr>
<td class="address-1"><span id="26769"></span>26769</td>
<td class="instruction">LD (BC),A</td>
</tr>
<tr>
<td class="address-1"><span id="26770"></span>26770</td>
<td class="instruction">LD L,16</td>
<td class="comment-1" rowspan="4">Make sure there are no (sub)submessage addresses lying around in bytes 13-16 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="26772"></span>26772</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="address-1"><span id="26774"></span>26774</td>
<td class="instruction">LD L,14</td>
</tr>
<tr>
<td class="address-1"><span id="26776"></span>26776</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="address-1"><span id="26778"></span>26778</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's number (201-204, 206)</td>
</tr>
<tr>
<td class="address-1"><span id="26779"></span>26779</td>
<td class="instruction">CP 206</td>
<td class="comment-1" rowspan="7">Set <span class="register">E</span> as follows: 32=MR WITHIT, 38=MR ROCKITT, 44=MR CREAK, 50=MISS TAKE, 56=BOY WANDER</td>
</tr>
<tr>
<td class="address-1"><span id="26781"></span>26781</td>
<td class="instruction">ADC A,59</td>
</tr>
<tr>
<td class="address-1"><span id="26783"></span>26783</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="26784"></span>26784</td>
<td class="instruction">ADC A,A</td>
</tr>
<tr>
<td class="address-1"><span id="26785"></span>26785</td>
<td class="instruction">ADD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="26786"></span>26786</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="26787"></span>26787</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-2"><span id="26788"></span>26788</td>
<td class="instruction">CALL <a href="25233.html">25233</a></td>
<td class="comment-1" rowspan="4">Collect a random number between 0 and 5 in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="26791"></span>26791</td>
<td class="instruction">AND 7</td>
</tr>
<tr>
<td class="address-1"><span id="26793"></span>26793</td>
<td class="instruction">CP 6</td>
</tr>
<tr>
<td class="address-1"><span id="26795"></span>26795</td>
<td class="instruction">JR NC,26788</td>
</tr>
<tr>
<td class="address-1"><span id="26797"></span>26797</td>
<td class="instruction">ADD A,E</td>
<td class="comment-1" rowspan="2">Now <span class="register">E</span>=blackboard message number</td>
</tr>
<tr>
<td class="address-1"><span id="26798"></span>26798</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="26799"></span>26799</td>
<td class="instruction">LD D,254</td>
<td class="comment-1" rowspan="8">Pick up the address of the message and place it into bytes 11 and 12 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="26801"></span>26801</td>
<td class="instruction">LD L,11</td>
</tr>
<tr>
<td class="address-1"><span id="26803"></span>26803</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address-1"><span id="26804"></span>26804</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="26805"></span>26805</td>
<td class="instruction">INC D</td>
</tr>
<tr>
<td class="address-1"><span id="26806"></span>26806</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="26807"></span>26807</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address-1"><span id="26808"></span>26808</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="26809"></span>26809</td>
<td class="instruction">LD L,9</td>
<td class="comment-1" rowspan="2">Replace the address of this routine in bytes 9 and 10 of the character's buffer with <a href="26752.html#26813">26813</a> (below)</td>
</tr>
<tr>
<td class="address-1"><span id="26811"></span>26811</td>
<td class="instruction">LD (HL),189</td>
</tr>
<tr>
<td class="address-1"><span id="26813"></span>26813</td>
<td class="instruction">CALL <a href="26513.html">26513</a></td>
<td class="comment-1" rowspan="1">Write one letter on the board</td>
</tr>
<tr>
<td class="address-1"><span id="26816"></span>26816</td>
<td class="instruction">JR NZ,26829</td>
<td class="comment-1" rowspan="1">Jump unless the character has finished writing</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="26818"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="27904.html">27904</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="26818"></span>26818</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the character's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="26821"></span>26821</td>
<td class="instruction">AND 248</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=base animatory state of the character (arm down)</td>
</tr>
<tr>
<td class="address-1"><span id="26823"></span>26823</td>
<td class="instruction">CALL <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the character's animatory state and update the SRB</td>
</tr>
<tr>
<td class="address-1"><span id="26826"></span>26826</td>
<td class="instruction">JP <a href="25484.html#25488">25488</a></td>
<td class="comment-1" rowspan="1">Terminate this interruptible subcommand</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="26829"></span>
<div class="comments">
<div class="paragraph">
The character hasn't finished writing yet. Figure out his next arm movement (up or down).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="26829"></span>26829</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the character's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="26832"></span>26832</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="2">Set the carry flag if the character's arm is raised</td>
</tr>
<tr>
<td class="address-1"><span id="26833"></span>26833</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="26834"></span>26834</td>
<td class="instruction">JR C,26841</td>
<td class="comment-1" rowspan="1">Jump if the character's arm is raised</td>
</tr>
<tr>
<td class="address-1"><span id="26836"></span>26836</td>
<td class="instruction">OR 7</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=animatory state of the character with his arm up</td>
</tr>
<tr>
<td class="address-2"><span id="26838"></span>26838</td>
<td class="instruction">JP <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the character's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="address-2"><span id="26841"></span>26841</td>
<td class="instruction">AND 248</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=base animatory state of character (arm down)</td>
</tr>
<tr>
<td class="address-1"><span id="26843"></span>26843</td>
<td class="instruction">JR 26838</td>
<td class="comment-1" rowspan="1">Jump back to update the SRB</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="26750.html">26750</a>
</td>
<td class="up">Up: <a href="../maps/all.html#26752">Map</a></td>
<td class="next">
Next: <a href="26845.html">26845</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20191115</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/6880.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>