<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 32433</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32432.html">32432</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32433">Map</a></td>
<td class="next">
Next: <a href="32495.html">32495</a>
</td>
</tr>
</table>
<div class="description">32433: Print the lesson and ring the bell</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="63309.html">63309</a>. Prints the lesson or 'DEMO.MODE' in the lesson box, and makes the bell sound effect.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32433"></span>32433</td>
<td class="instruction">LD HL,32734</td>
<td class="comment-1" rowspan="1"><a href="32734.html">32734</a> holds the current game mode</td>
</tr>
<tr>
<td class="address-1"><span id="32436"></span>32436</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=255 if we're in demo mode, 0 otherwise</td>
</tr>
<tr>
<td class="address-1"><span id="32437"></span>32437</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Set the zero flag if we're in demo mode</td>
</tr>
<tr>
<td class="address-1"><span id="32438"></span>32438</td>
<td class="instruction">LD A,63</td>
<td class="comment-1" rowspan="1">Message <a href="59932.html">63</a>: DEMO.MODE</td>
</tr>
<tr>
<td class="address-1"><span id="32440"></span>32440</td>
<td class="instruction">JR Z,32478</td>
<td class="comment-1" rowspan="1">Jump if we're in demo mode</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32442"></span>
<div class="comments">
<div class="paragraph">
A real game is in progress. First, figure out what to print in the bottom row of the lesson box (the room name, 'LIBRARY', 'PLAYTIME', 'ASSEMBLY' or 'DINNER').
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32442"></span>32442</td>
<td class="instruction">LD L,224</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32736.html">32736</a> (lesson descriptor)</td>
</tr>
<tr>
<td class="address-1"><span id="32444"></span>32444</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="32445"></span>32445</td>
<td class="instruction">AND 15</td>
<td class="comment-1" rowspan="1">Keep only the room identifier bits</td>
</tr>
<tr>
<td class="address-1"><span id="32447"></span>32447</td>
<td class="instruction">LD E,32</td>
<td class="comment-1" rowspan="1">32 is the ASCII code for SPACE</td>
</tr>
<tr>
<td class="address-1"><span id="32449"></span>32449</td>
<td class="instruction">ADD A,126</td>
<td class="comment-1" rowspan="2"><span class="register">D</span>=message number for the text to go on the bottom row of the lesson box</td>
</tr>
<tr>
<td class="address-1"><span id="32451"></span>32451</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="32452"></span>32452</td>
<td class="instruction">CP 131</td>
<td class="comment-1" rowspan="1">Is it PLAYTIME (<a href="61015.html">128</a>), ASSEMBLY (<a href="61024.html">129</a>) or DINNER (<a href="61033.html">130</a>)?</td>
</tr>
<tr>
<td class="address-1"><span id="32454"></span>32454</td>
<td class="instruction">JR C,32470</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32456"></span>32456</td>
<td class="instruction">LD E,135</td>
<td class="comment-1" rowspan="1">Message <a href="61082.html">135</a>: REVISION</td>
</tr>
<tr>
<td class="address-1"><span id="32458"></span>32458</td>
<td class="instruction">JR Z,32470</td>
<td class="comment-1" rowspan="1">Jump if it's REVISION LIBRARY (D=<a href="61040.html">131</a>: LIBRARY)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32460"></span>
<div class="comments">
<div class="paragraph">
Next, figure out what to print (if anything) in the top row of the lesson box (the teacher's name, or 'REVISION').
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32460"></span>32460</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=lesson descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="32461"></span>32461</td>
<td class="instruction">AND 240</td>
<td class="comment-1" rowspan="5">Keep only the teacher-identifying bits and push them into bits 0-3</td>
</tr>
<tr>
<td class="address-1"><span id="32463"></span>32463</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32464"></span>32464</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32465"></span>32465</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32466"></span>32466</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32467"></span>32467</td>
<td class="instruction">ADD A,20</td>
<td class="comment-1" rowspan="2"><span class="register">E</span>=<a href="61280.html">22</a>, <a href="61293.html">23</a> or <a href="61306.html">24</a> (teacher's name)</td>
</tr>
<tr>
<td class="address-1"><span id="32469"></span>32469</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32470"></span>
<div class="comments">
<div class="paragraph">
Now we can construct message <a href="59928.html">16</a> (teacher/room) ready for printing.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32470"></span>32470</td>
<td class="instruction">LD L,136</td>
<td class="comment-1" rowspan="2">Place the teacher message number (or ASCII code for SPACE) in <a href="32648.html">32648</a></td>
</tr>
<tr>
<td class="address-1"><span id="32472"></span>32472</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="32473"></span>32473</td>
<td class="instruction">LD L,138</td>
<td class="comment-1" rowspan="2">Place the room message number in <a href="32650.html">32650</a></td>
</tr>
<tr>
<td class="address-1"><span id="32475"></span>32475</td>
<td class="instruction">LD (HL),D</td>
</tr>
<tr>
<td class="address-1"><span id="32476"></span>32476</td>
<td class="instruction">LD A,16</td>
<td class="comment-1" rowspan="1">Message <a href="59928.html">16</a>: teacher/room</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32478"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="23907.html">23907</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32478"></span>32478</td>
<td class="instruction">LD DE,23216</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=base display file address for the lesson box</td>
</tr>
<tr>
<td class="address-1"><span id="32481"></span>32481</td>
<td class="instruction">LD C,87</td>
<td class="comment-1" rowspan="1">INK 7: PAPER 2: BRIGHT 1</td>
</tr>
<tr>
<td class="address-1"><span id="32483"></span>32483</td>
<td class="instruction">CALL <a href="27462.html">27462</a></td>
<td class="comment-1" rowspan="1">Print the lesson</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32486"></span>
<div class="comments">
<div class="paragraph">
And finally, ring the bell.
</div>
<div class="paragraph">
<audio controls="" src="../../audio/bell.ogg">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../../audio/bell.ogg">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32486"></span>32486</td>
<td class="instruction">LD BC,32784</td>
<td class="comment-1" rowspan="3">Set the parameters for the bell sound effect</td>
</tr>
<tr>
<td class="address-1"><span id="32489"></span>32489</td>
<td class="instruction">LD D,C</td>
</tr>
<tr>
<td class="address-1"><span id="32490"></span>32490</td>
<td class="instruction">LD A,1</td>
</tr>
<tr>
<td class="address-1"><span id="32492"></span>32492</td>
<td class="instruction">JP <a href="29836.html">29836</a></td>
<td class="comment-1" rowspan="1">Ring the bell</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32432.html">32432</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32433">Map</a></td>
<td class="next">
Next: <a href="32495.html">32495</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20221122</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/7EB1.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>