<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 32062</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32060.html">32060</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32062">Map</a></td>
<td class="next">
Next: <a href="32371.html">32371</a>
</td>
</tr>
</table>
<div class="description">32062: Make any nearby teacher give ERIC lines if necessary (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="32032.html">32032</a>. On entry, <span class="register">A</span> contains a location identifier for ERIC:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">Region</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="" colspan="1" rowspan="1">None of the places below (ERIC is never allowed here)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">Playground</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">Various places in the boys' skool outside classrooms</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">Assembly hall</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Dining hall</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Revision Library, just outside the Yellow Room door</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Science Lab</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">Blue Room</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Yellow Room</td>
</tr>
</table>
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Location identifier for ERIC (0-8)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="32062"></span>32062</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is ERIC in a forbidden zone?</td>
</tr>
<tr>
<td class="address-1"><span id="32063"></span>32063</td>
<td class="instruction">JP Z,32232</td>
<td class="comment-1" rowspan="1">Jump with <span class="register">A</span>=0 (0+62=<a href="60455.html">62</a>: YOU ARE NOT ALLOWED HERE) if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32066"></span>
<div class="comments">
<div class="paragraph">
ERIC's not in a forbidden zone. Check whether he's standing on a plant, or riding the bike in the boys' skool.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32066"></span>32066</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=ERIC's location identifier (1-8)</td>
</tr>
<tr>
<td class="address-1"><span id="32067"></span>32067</td>
<td class="instruction">LD L,251</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32763.html">32763</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32069"></span>32069</td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC on the bike, on a plant, or falling?</td>
</tr>
<tr>
<td class="address-1"><span id="32071"></span>32071</td>
<td class="instruction">JR Z,32091</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32073"></span>
<div class="comments">
<div class="paragraph">
ERIC is on the bike, on a plant, or falling.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32073"></span>32073</td>
<td class="instruction">LD L,237</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32749.html">32749</a> (ERIC's other status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32075"></span>32075</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick these up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="32076"></span>32076</td>
<td class="instruction">AND 131</td>
<td class="comment-1" rowspan="1">Check bits 0, 1 and 7</td>
</tr>
<tr>
<td class="address-1"><span id="32078"></span>32078</td>
<td class="instruction">JR Z,32091</td>
<td class="comment-1" rowspan="1">Jump if ERIC's falling</td>
</tr>
<tr>
<td class="address-1"><span id="32080"></span>32080</td>
<td class="instruction">AND 2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2 (2+62=<a href="60493.html">64</a>: GET OFF THE PLANTS) if ERIC's standing on a plant or plant pot</td>
</tr>
<tr>
<td class="address-2"><span id="32082"></span>32082</td>
<td class="instruction">JP NZ,32232</td>
<td class="comment-1" rowspan="1">Jump if ERIC is (a) standing on a plant or plant pot, or (b) riding or standing on the saddle of the bike inside the boys' skool</td>
</tr>
<tr>
<td class="address-1"><span id="32085"></span>32085</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=0 now if ERIC's in the playground</td>
</tr>
<tr>
<td class="address-1"><span id="32086"></span>32086</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="1">3+62=<a href="60506.html">65</a>: DON'T RIDE BIKES IN HERE</td>
</tr>
<tr>
<td class="address-1"><span id="32088"></span>32088</td>
<td class="instruction">JR NZ,32082</td>
<td class="comment-1" rowspan="1">Jump if ERIC's riding the bike in the boys' skool</td>
</tr>
<tr>
<td class="address-1"><span id="32090"></span>32090</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=ERIC's location identifier (1-8)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32091"></span>
<div class="comments">
<div class="paragraph">
Now to check whether ERIC's in the room or area he's supposed to be in this period.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32091"></span>32091</td>
<td class="instruction">LD L,224</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32736.html">32736</a> (lesson descriptor)</td>
</tr>
<tr>
<td class="address-1"><span id="32093"></span>32093</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="32094"></span>32094</td>
<td class="instruction">AND 15</td>
<td class="comment-1" rowspan="1">Keep only the 'room' bits (bits 0-3)</td>
</tr>
<tr>
<td class="address-1"><span id="32096"></span>32096</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy the room bits to <span class="register">C</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32097"></span>
<div class="comments">
<div class="paragraph">
Now the value in <span class="register">C</span> indicates where this lesson takes place:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">C</span></th>
<th colspan="1" rowspan="1">Lesson/location</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">Playtime</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">Assembly</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Dinner</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Revision Library</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Science Lab</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">Blue Room</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Yellow Room</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32097"></span>32097</td>
<td class="instruction">LD L,128</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32640.html">32640</a> (various game status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32099"></span>32099</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-1" rowspan="1">Should ERIC be in class, assembly or the dinner hall by now?</td>
</tr>
<tr>
<td class="address-1"><span id="32101"></span>32101</td>
<td class="instruction">JR NZ,32167</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32103"></span>32103</td>
<td class="instruction">LD L,228</td>
<td class="comment-1" rowspan="2">Pick up the MSB of the lesson clock</td>
</tr>
<tr>
<td class="address-1"><span id="32105"></span>32105</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32106"></span>32106</td>
<td class="instruction">CP 12</td>
<td class="comment-1" rowspan="1">Should ERIC by now have left the classroom he was in last period?</td>
</tr>
<tr>
<td class="address-1"><span id="32108"></span>32108</td>
<td class="instruction">JR C,32134</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32110"></span>
<div class="comments">
<div class="paragraph">
It's too soon to be telling ERIC to GET ALONG NOW. Check whether he's sitting on the floor anywhere outside the assembly hall.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32110"></span>32110</td>
<td class="instruction">LD L,251</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32763.html">32763</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32112"></span>32112</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC sitting or lying down?</td>
</tr>
<tr>
<td class="address-1"><span id="32114"></span>32114</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="32115"></span>32115</td>
<td class="instruction">LD A,(53760)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="32118"></span>32118</td>
<td class="instruction">CP 4</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#4">4</a>: Is ERIC sitting in a chair?</td>
</tr>
<tr>
<td class="address-1"><span id="32120"></span>32120</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="32121"></span>32121</td>
<td class="instruction">CP 133</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#133">133</a>: ERIC sitting on the floor facing right</td>
</tr>
<tr>
<td class="address-2"><span id="32123"></span>32123</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1">4+62=<a href="60526.html">66</a>: GET OFF THE FLOOR</td>
</tr>
<tr>
<td class="address-1"><span id="32125"></span>32125</td>
<td class="instruction">JP NZ,32232</td>
<td class="comment-1" rowspan="1">Give lines if ERIC's sitting on the floor facing left, or lying down</td>
</tr>
<tr>
<td class="address-1"><span id="32128"></span>32128</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's location identifier (1-8)</td>
</tr>
<tr>
<td class="address-1"><span id="32129"></span>32129</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1">ERIC is sitting on the floor facing right; is he in the assembly hall?</td>
</tr>
<tr>
<td class="address-1"><span id="32131"></span>32131</td>
<td class="instruction">JR NZ,32123</td>
<td class="comment-1" rowspan="1">Give lines if not</td>
</tr>
<tr>
<td class="address-1"><span id="32133"></span>32133</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32134"></span>
<div class="comments">
<div class="paragraph">
By now, ERIC should have left the classroom he was in last period.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32134"></span>32134</td>
<td class="instruction">LD A,5</td>
<td class="comment-1" rowspan="1">Location IDs 6-8 correspond to the boys' skool classrooms</td>
</tr>
<tr>
<td class="address-1"><span id="32136"></span>32136</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1">Is ERIC in the Blue Room, Yellow Room or Science Lab?</td>
</tr>
<tr>
<td class="address-1"><span id="32137"></span>32137</td>
<td class="instruction">JR C,32167</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32139"></span>32139</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="2">Is it PLAYTIME?</td>
</tr>
<tr>
<td class="address-1"><span id="32141"></span>32141</td>
<td class="instruction">CP C</td>
</tr>
<tr>
<td class="address-1"><span id="32142"></span>32142</td>
<td class="instruction">JR Z,32158</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32144"></span>32144</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=1</td>
</tr>
<tr>
<td class="address-1"><span id="32145"></span>32145</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=1 if ERIC's in the playground</td>
</tr>
<tr>
<td class="address-1"><span id="32146"></span>32146</td>
<td class="instruction">LD A,5</td>
<td class="comment-1" rowspan="1">5+62=<a href="60538.html">67</a>: GET BACK TO SCHOOL</td>
</tr>
<tr>
<td class="address-1"><span id="32148"></span>32148</td>
<td class="instruction">JR Z,32232</td>
<td class="comment-1" rowspan="1">Give lines if ERIC is in the playground</td>
</tr>
<tr>
<td class="address-1"><span id="32150"></span>32150</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Is it ASSEMBLY?</td>
</tr>
<tr>
<td class="address-1"><span id="32151"></span>32151</td>
<td class="instruction">CP 3</td>
</tr>
<tr>
<td class="address-1"><span id="32153"></span>32153</td>
<td class="instruction">JR NZ,32158</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32155"></span>32155</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1">Is ERIC in the assembly hall?</td>
</tr>
<tr>
<td class="address-1"><span id="32156"></span>32156</td>
<td class="instruction">JR Z,32182</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-2"><span id="32158"></span>32158</td>
<td class="instruction">LD L,251</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32763.html">32763</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32160"></span>32160</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC sitting or lying down?</td>
</tr>
<tr>
<td class="address-1"><span id="32162"></span>32162</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="32163"></span>32163</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1">4+62=<a href="60526.html">66</a>: GET OFF THE FLOOR</td>
</tr>
<tr>
<td class="address-1"><span id="32165"></span>32165</td>
<td class="instruction">JR 32232</td>
<td class="comment-1" rowspan="1">Give lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32167"></span>
<div class="comments">
<div class="paragraph">
ERIC should be in class, assembly or the dinner hall by now.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32167"></span>32167</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's location identifier (1-8)</td>
</tr>
<tr>
<td class="address-1"><span id="32168"></span>32168</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="1">Compare that with where he should be</td>
</tr>
<tr>
<td class="address-1"><span id="32169"></span>32169</td>
<td class="instruction">LD A,6</td>
<td class="comment-1" rowspan="1">6+62=<a href="60554.html">68</a>: GET ALONG NOW</td>
</tr>
<tr>
<td class="address-1"><span id="32171"></span>32171</td>
<td class="instruction">JR NZ,32232</td>
<td class="comment-1" rowspan="1">Give lines if ERIC's not where he should be</td>
</tr>
<tr>
<td class="address-1"><span id="32173"></span>32173</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=5</td>
</tr>
<tr>
<td class="address-1"><span id="32174"></span>32174</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="1"><span class="register">C</span> &gt; 5 if this lesson is in a classroom</td>
</tr>
<tr>
<td class="address-1"><span id="32175"></span>32175</td>
<td class="instruction">JR C,32209</td>
<td class="comment-1" rowspan="1">Jump if this lesson is in a classroom</td>
</tr>
<tr>
<td class="address-1"><span id="32177"></span>32177</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Is it ASSEMBLY?</td>
</tr>
<tr>
<td class="address-1"><span id="32178"></span>32178</td>
<td class="instruction">CP 3</td>
</tr>
<tr>
<td class="address-1"><span id="32180"></span>32180</td>
<td class="instruction">JR NZ,32158</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-2"><span id="32182"></span>32182</td>
<td class="instruction">LD L,128</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32640.html">32640</a> (various game status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32184"></span>32184</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Bit 7 is set if ERIC should be sitting down now</td>
</tr>
<tr>
<td class="address-1"><span id="32186"></span>32186</td>
<td class="instruction">LD A,(53760)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="32189"></span>32189</td>
<td class="instruction">JR NZ,32196</td>
<td class="comment-1" rowspan="1">Jump if ERIC should be sitting facing the stage now</td>
</tr>
<tr>
<td class="address-1"><span id="32191"></span>32191</td>
<td class="instruction">CP 133</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#133">133</a>: Is ERIC sitting on the floor facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="32193"></span>32193</td>
<td class="instruction">JR NZ,32158</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32195"></span>32195</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32196"></span>
<div class="comments">
<div class="paragraph">
It's assembly, ERIC is in the assembly hall, and he should be sitting down facing the stage now. Check whether he is.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32196"></span>32196</td>
<td class="instruction">CP 133</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#133">133</a>: Is ERIC sitting on the floor facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="32198"></span>32198</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="32199"></span>32199</td>
<td class="instruction">LD L,251</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32763.html">32763</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32201"></span>32201</td>
<td class="instruction">LD A,7</td>
<td class="comment-1" rowspan="1">7+62=<a href="60565.html">69</a>: SIT FACING THE STAGE</td>
</tr>
<tr>
<td class="address-1"><span id="32203"></span>32203</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC sitting (facing left) or lying down?</td>
</tr>
<tr>
<td class="address-1"><span id="32205"></span>32205</td>
<td class="instruction">JR Z,32232</td>
<td class="comment-1" rowspan="1">Tell ERIC to sit facing the stage if not (this is a <a href="../reference/bugs.html#assemblySit">bug</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="32207"></span>32207</td>
<td class="instruction">JR 32228</td>
<td class="comment-1" rowspan="1">Otherwise tell ERIC to sit down</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32209"></span>
<div class="comments">
<div class="paragraph">
This lesson takes place in a classroom, and ERIC is present. Check whether ERIC is sitting in a chair.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32209"></span>32209</td>
<td class="instruction">LD A,(53760)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="32212"></span>32212</td>
<td class="instruction">CP 4</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#4">4</a>: Is ERIC sitting in a chair?</td>
</tr>
<tr>
<td class="address-1"><span id="32214"></span>32214</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="32215"></span>32215</td>
<td class="instruction">LD L,251</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32763.html">32763</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32217"></span>32217</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Bit 2 is set if ERIC's sitting or lying on the floor</td>
</tr>
<tr>
<td class="address-1"><span id="32219"></span>32219</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1">4+62=<a href="60526.html">66</a>: GET OFF THE FLOOR</td>
</tr>
<tr>
<td class="address-1"><span id="32221"></span>32221</td>
<td class="instruction">JR NZ,32232</td>
<td class="comment-1" rowspan="1">Give lines if ERIC's sitting or lying on the floor</td>
</tr>
<tr>
<td class="address-1"><span id="32223"></span>32223</td>
<td class="instruction">LD L,128</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32640.html">32640</a> (various game status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32225"></span>32225</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Should ERIC be seated by now (bit 7 is set by <a href="61696.html">61696</a>)?</td>
</tr>
<tr>
<td class="address-1"><span id="32227"></span>32227</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-2"><span id="32228"></span>32228</td>
<td class="instruction">LD A,8</td>
<td class="comment-1" rowspan="1">8+62=<a href="60580.html">70</a>: NOW SIT DOWN</td>
</tr>
<tr>
<td class="address-1"><span id="32230"></span>32230</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32231"></span>32231</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32232"></span>
<div class="comments">
<div class="paragraph">
At this point, <span class="register">A</span> holds the lines reprimand ID.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32232"></span>32232</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is ERIC in a forbidden zone?</td>
</tr>
<tr>
<td class="address-1"><span id="32233"></span>32233</td>
<td class="instruction">JR NZ,32278</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32235"></span>
<div class="comments">
<div class="paragraph">
ERIC is somewhere he's never allowed to be.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32235"></span>32235</td>
<td class="instruction">LD L,128</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32640.html">32640</a> (various game status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32237"></span>32237</td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-1" rowspan="1">Is MISS TAKE chasing ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="32239"></span>32239</td>
<td class="instruction">JR NZ,32277</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32241"></span>32241</td>
<td class="instruction">LD A,(32736)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=lesson descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="32244"></span>32244</td>
<td class="instruction">CP 2</td>
<td class="comment-1" rowspan="1">Is it PLAYTIME?</td>
</tr>
<tr>
<td class="address-1"><span id="32246"></span>32246</td>
<td class="instruction">JR Z,32277</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32248"></span>32248</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="32249"></span>32249</td>
<td class="instruction">CP 160</td>
<td class="comment-1" rowspan="1">Is ERIC in the girls' skool?</td>
</tr>
<tr>
<td class="address-1"><span id="32251"></span>32251</td>
<td class="instruction">JR C,32277</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32253"></span>
<div class="comments">
<div class="paragraph">
So it's not playtime, ERIC is in the girls' skool, and MISS TAKE is not (yet) chasing him out. Should she start?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32253"></span>32253</td>
<td class="instruction">LD HL,52226</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 2 of MISS TAKE's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="32256"></span>32256</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=MISS TAKE's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="32257"></span>32257</td>
<td class="instruction">CP D</td>
<td class="comment-1" rowspan="1">Are ERIC and MISS TAKE on the same floor?</td>
</tr>
<tr>
<td class="address-1"><span id="32258"></span>32258</td>
<td class="instruction">JR NZ,32275</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="32260"></span>32260</td>
<td class="instruction">LD L,29</td>
<td class="comment-1" rowspan="2">Set bit 0 of byte 29 of MISS TAKE's character buffer, triggering a restart of her command list (set to <a href="32371.html">32371</a> below)</td>
</tr>
<tr>
<td class="address-1"><span id="32262"></span>32262</td>
<td class="instruction">SET 0,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32264"></span>32264</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="4">Place the address of the command list at <a href="32371.html">32371</a> into bytes 27 and 28 of MISS TAKE's buffer; this command list contains a single routine address: <a href="32373.html">32373</a></td>
</tr>
<tr>
<td class="address-1"><span id="32265"></span>32265</td>
<td class="instruction">LD (HL),126</td>
</tr>
<tr>
<td class="address-1"><span id="32267"></span>32267</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="32268"></span>32268</td>
<td class="instruction">LD (HL),115</td>
</tr>
<tr>
<td class="address-1"><span id="32270"></span>32270</td>
<td class="instruction">LD HL,32640</td>
<td class="comment-1" rowspan="1"><a href="32640.html">32640</a> holds various game status flags</td>
</tr>
<tr>
<td class="address-1"><span id="32273"></span>32273</td>
<td class="instruction">SET 5,(HL)</td>
<td class="comment-1" rowspan="1">Signal: MISS TAKE is chasing ERIC</td>
</tr>
<tr>
<td class="address-2"><span id="32275"></span>32275</td>
<td class="instruction">LD H,127</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the game status buffer page</td>
</tr>
<tr>
<td class="address-2"><span id="32277"></span>32277</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">0+62=<a href="60455.html">62</a>: YOU ARE NOT ALLOWED HERE</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32278"></span>
<div class="comments">
<div class="paragraph">
Check how long it's been since ERIC last got lines.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32278"></span>32278</td>
<td class="instruction">LD L,247</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32759.html">32759</a> (MSB of the lines-giving delay counter)</td>
</tr>
<tr>
<td class="address-1"><span id="32280"></span>32280</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="2">Reset the zero flag if it's too soon for the teacher who gave ERIC lines last time to give him lines again</td>
</tr>
<tr>
<td class="address-1"><span id="32281"></span>32281</td>
<td class="instruction">INC (HL)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32282"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="63586.html">63586</a> with the zero flag set (meaning any teacher may give ERIC lines) and <span class="register">A</span> holding a lines reprimand ID.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32282"></span>32282</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Save the lines reprimand ID and the zero flag</td>
</tr>
<tr>
<td class="address-1"><span id="32283"></span>32283</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32284"></span>32284</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32285"></span>32285</td>
<td class="instruction">JR Z,32296</td>
<td class="comment-1" rowspan="1">Jump if any teacher (including the one who gave him lines last time) can give ERIC lines now</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32287"></span>
<div class="comments">
<div class="paragraph">
It's too soon for the teacher who gave ERIC lines last time to give him lines again. Remove that teacher from lines-giving range temporarily.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32287"></span>32287</td>
<td class="instruction">LD L,245</td>
<td class="comment-1" rowspan="2">Collect from <a href="32757.html">32757</a> into <span class="register">H</span> the character number of the teacher who last gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="32289"></span>32289</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32290"></span>32290</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=this teacher's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="32292"></span>32292</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="32293"></span>32293</td>
<td class="instruction">LD (HL),224</td>
<td class="comment-1" rowspan="1">Set this teacher's x-coordinate to 224 temporarily to take him out of lines-giving range</td>
</tr>
<tr>
<td class="address-1"><span id="32295"></span>32295</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Save the teacher's real x-coordinate in <span class="register">L</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32296"></span>
<div class="comments">
<div class="paragraph">
Now to find out which teacher (if any) should give ERIC lines.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32296"></span>32296</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32297"></span>32297</td>
<td class="instruction">CALL <a href="28002.html">28002</a></td>
<td class="comment-1" rowspan="1">Find the first adult within lines-giving range of ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="32300"></span>32300</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32301"></span>32301</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=character number of this adult, or 0 if there are none in range</td>
</tr>
<tr>
<td class="address-1"><span id="32302"></span>32302</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="32303"></span>32303</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=lines reprimand ID</td>
</tr>
<tr>
<td class="address-1"><span id="32304"></span>32304</td>
<td class="instruction">JR Z,32310</td>
<td class="comment-1" rowspan="1">Jump unless we need to restore the x-coordinate of the teacher who last gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="32306"></span>32306</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="3">Restore the x-coordinate of the teacher who last gave ERIC lines</td>
</tr>
<tr>
<td class="address-1"><span id="32307"></span>32307</td>
<td class="instruction">LD L,1</td>
</tr>
<tr>
<td class="address-1"><span id="32309"></span>32309</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-2"><span id="32310"></span>32310</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character number of the adult who can see ERIC, or 0 if there are no adults in range</td>
</tr>
<tr>
<td class="address-1"><span id="32311"></span>32311</td>
<td class="instruction">CP 205</td>
<td class="comment-1" rowspan="1">Is it ALBERT (and therefore none of the teachers)?</td>
</tr>
<tr>
<td class="address-1"><span id="32313"></span>32313</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so (ALBERT doesn't give lines)</td>
</tr>
<tr>
<td class="address-1"><span id="32314"></span>32314</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Can any adult character see ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="32315"></span>32315</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32316"></span>
<div class="comments">
<div class="paragraph">
A teacher is within lines-giving range.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32316"></span>32316</td>
<td class="instruction">LD HL,32640</td>
<td class="comment-1" rowspan="1"><a href="32640.html">32640</a> holds various game status flags</td>
</tr>
<tr>
<td class="address-1"><span id="32319"></span>32319</td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-1" rowspan="1">Is MR WACKER chasing ERIC to expel him?</td>
</tr>
<tr>
<td class="address-1"><span id="32321"></span>32321</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="32322"></span>32322</td>
<td class="instruction">LD L,245</td>
<td class="comment-1" rowspan="2">Store the character number of the lines-giver at <a href="32757.html">32757</a></td>
</tr>
<tr>
<td class="address-1"><span id="32324"></span>32324</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="32325"></span>32325</td>
<td class="instruction">LD L,247</td>
<td class="comment-1" rowspan="2">Reset the MSB of the lines-giving delay counter at <a href="32759.html">32759</a> to 10</td>
</tr>
<tr>
<td class="address-1"><span id="32327"></span>32327</td>
<td class="instruction">LD (HL),10</td>
</tr>
<tr>
<td class="address-1"><span id="32329"></span>32329</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=lines reprimand ID</td>
</tr>
<tr>
<td class="address-1"><span id="32330"></span>32330</td>
<td class="instruction">CP 6</td>
<td class="comment-1" rowspan="1">6+62=<a href="60554.html">68</a>: GET ALONG NOW</td>
</tr>
<tr>
<td class="address-1"><span id="32332"></span>32332</td>
<td class="instruction">JR NZ,32361</td>
<td class="comment-1" rowspan="1">Jump unless ERIC is late for class, dinner or assembly</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32334"></span>
<div class="comments">
<div class="paragraph">
ERIC is late for class, dinner or assembly. The appropriate lines reprimand depends on who saw him: his teacher for this period, or some other teacher.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32334"></span>32334</td>
<td class="instruction">LD A,(32736)</td>
<td class="comment-1" rowspan="1">Collect the lesson descriptor from <a href="32736.html">32736</a></td>
</tr>
<tr>
<td class="address-1"><span id="32337"></span>32337</td>
<td class="instruction">AND 240</td>
<td class="comment-1" rowspan="5">Keep only the bits relating to ERIC's teacher and shift them into bits 0-3</td>
</tr>
<tr>
<td class="address-1"><span id="32339"></span>32339</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32340"></span>32340</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32341"></span>32341</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32342"></span>32342</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="32343"></span>32343</td>
<td class="instruction">ADD A,199</td>
<td class="comment-1" rowspan="1">Now <span class="register">A</span>=character number of ERIC's teacher (200-203)</td>
</tr>
<tr>
<td class="address-1"><span id="32345"></span>32345</td>
<td class="instruction">CP D</td>
<td class="comment-1" rowspan="1">Was it that teacher who saw ERIC?</td>
</tr>
<tr>
<td class="address-1"><span id="32346"></span>32346</td>
<td class="instruction">JR NZ,32361</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32348"></span>
<div class="comments">
<div class="paragraph">
ERIC's teacher for this period is the lines-giver. His lines reprimand alternates between 'COME ALONG YOU MONSTER' and 'DON'T KEEP ME WAITING'.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="32348"></span>32348</td>
<td class="instruction">LD L,128</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32640.html">32640</a> (various game status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="32350"></span>32350</td>
<td class="instruction">LD A,16</td>
<td class="comment-1" rowspan="1">Set bit 4 in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="32352"></span>32352</td>
<td class="instruction">LD B,9</td>
<td class="comment-1" rowspan="1">9+62=<a href="60586.html">71</a>: COME ALONG YOU MONSTER</td>
</tr>
<tr>
<td class="address-1"><span id="32354"></span>32354</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-1" rowspan="2">Flip bit 4 in <a href="32640.html">32640</a>, toggling between <a href="60586.html">71</a> and <a href="60609.html">72</a></td>
</tr>
<tr>
<td class="address-1"><span id="32355"></span>32355</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="32356"></span>32356</td>
<td class="instruction">BIT 4,(HL)</td>
<td class="comment-1" rowspan="1">Should ERIC's teacher say 'COME ALONG YOU MONSTER' this time (bit 4 set)?</td>
</tr>
<tr>
<td class="address-1"><span id="32358"></span>32358</td>
<td class="instruction">JR NZ,32361</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="32360"></span>32360</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">10+62=<a href="60609.html">72</a>: DON'T KEEP ME WAITING</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="32361"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">D</span> holds the character number of the teacher who is going to give ERIC lines, and <span class="register">B</span> holds the lines reprimand ID.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="32361"></span>32361</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Now <span class="register">H</span>=character number of the lines-giver</td>
</tr>
<tr>
<td class="address-1"><span id="32362"></span>32362</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3"><span class="register">B</span>=lines reprimand ID</td>
</tr>
<tr>
<td class="address-1"><span id="32363"></span>32363</td>
<td class="instruction">ADD A,62</td>
</tr>
<tr>
<td class="address-1"><span id="32365"></span>32365</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="32366"></span>32366</td>
<td class="instruction">LD A,210</td>
<td class="comment-1" rowspan="1">210=ERIC (the lines recipient)</td>
</tr>
<tr>
<td class="address-1"><span id="32368"></span>32368</td>
<td class="instruction">JP <a href="29716.html">29716</a></td>
<td class="comment-1" rowspan="1">Make the teacher give lines to ERIC</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="32060.html">32060</a>
</td>
<td class="up">Up: <a href="../maps/all.html#32062">Map</a></td>
<td class="next">
Next: <a href="32371.html">32371</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20221122</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/7D3E.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>