<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 28085</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28067.html">28067</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28085">Map</a></td>
<td class="next">
Next: <a href="28114.html">28114</a>
</td>
</tr>
</table>
<div class="description">28085: Determine which floor ERIC's on when he's not standing directly on one</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from the routine at <a href="25534.html">25534</a>, having determined that ERIC's feet are not on the floor. On entry, the zero flag is set if (a) ERIC is jumping and the zero flag was set (by chance) upon entering the routine at <a href="25534.html">25534</a>, or (b) bits 1 and 2 of ERIC's status flags at <a href="32749.html">32749</a> are both reset. Returns with <span class="register">D</span>=17 if the zero flag is set upon entry (regardless of which floor ERIC is on, which is a <a href="../reference/bugs.html#jumpAbsent">bug</a>); otherwise returns with <span class="register">D</span>=3, 10, 14 or 17, indicating which floor ERIC is directly above.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">ERIC's y-coordinate</td>
</tr>
<tr>
<td class="register">E</td>
<td class="register-desc">ERIC's x-coordinate</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="28085"></span>28085</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="28086"></span>28086</td>
<td class="instruction">LD D,17</td>
<td class="comment-1" rowspan="1">17=bottom floor</td>
</tr>
<tr>
<td class="address-1"><span id="28088"></span>28088</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return with <span class="register">D</span>=17 if the zero flag was set upon entry (regardless of which floor ERIC is on, which is a <a href="../reference/bugs.html#jumpAbsent">bug</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="28089"></span>28089</td>
<td class="instruction">LD D,3</td>
<td class="comment-1" rowspan="1">3=top floor</td>
</tr>
<tr>
<td class="address-1"><span id="28091"></span>28091</td>
<td class="instruction">CP 4</td>
<td class="comment-1" rowspan="1">Is ERIC directly above the top floor?</td>
</tr>
<tr>
<td class="address-1"><span id="28093"></span>28093</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return with <span class="register">D</span>=3 if so</td>
</tr>
<tr>
<td class="address-1"><span id="28094"></span>28094</td>
<td class="instruction">LD D,10</td>
<td class="comment-1" rowspan="1">10=middle floor</td>
</tr>
<tr>
<td class="address-1"><span id="28096"></span>28096</td>
<td class="instruction">CP 11</td>
<td class="comment-1" rowspan="1">Is ERIC directly above the middle floor?</td>
</tr>
<tr>
<td class="address-1"><span id="28098"></span>28098</td>
<td class="instruction">RET C</td>
<td class="comment-1" rowspan="1">Return with <span class="register">D</span>=10 if so</td>
</tr>
<tr>
<td class="address-1"><span id="28099"></span>28099</td>
<td class="instruction">LD D,17</td>
<td class="comment-1" rowspan="1">17=bottom floor</td>
</tr>
<tr>
<td class="address-1"><span id="28101"></span>28101</td>
<td class="instruction">CP 15</td>
<td class="comment-1" rowspan="1">Is ERIC below the height of the stage?</td>
</tr>
<tr>
<td class="address-1"><span id="28103"></span>28103</td>
<td class="instruction">RET NC</td>
<td class="comment-1" rowspan="1">Return with <span class="register">D</span>=17 if so</td>
</tr>
<tr>
<td class="address-1"><span id="28104"></span>28104</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="28105"></span>28105</td>
<td class="instruction">CP 76</td>
<td class="comment-1" rowspan="4">Return with <span class="register">D</span>=17 if ERIC is not directly above the assembly hall stage</td>
</tr>
<tr>
<td class="address-1"><span id="28107"></span>28107</td>
<td class="instruction">RET C</td>
</tr>
<tr>
<td class="address-1"><span id="28108"></span>28108</td>
<td class="instruction">CP 82</td>
</tr>
<tr>
<td class="address-1"><span id="28110"></span>28110</td>
<td class="instruction">RET NC</td>
</tr>
<tr>
<td class="address-1"><span id="28111"></span>28111</td>
<td class="instruction">LD D,14</td>
<td class="comment-1" rowspan="1">14=assembly hall stage</td>
</tr>
<tr>
<td class="address-1"><span id="28113"></span>28113</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28067.html">28067</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28085">Map</a></td>
<td class="next">
Next: <a href="28114.html">28114</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20191115</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/6DB5.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>