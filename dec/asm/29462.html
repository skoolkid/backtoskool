<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 29462</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29278.html">29278</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29462">Map</a></td>
<td class="next">
Next: <a href="29567.html">29567</a>
</td>
</tr>
</table>
<div class="description">29462: Deal with ERIC when he's standing on the saddle of the bike</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Called by the routine at <a href="63405.html">63405</a> when bit 7 at <a href="32749.html">32749</a> is set (by the routine at <a href="29278.html">29278</a>). Listens for and responds appropriately to keypresses while ERIC is standing on the saddle of the bike.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29462"></span>29462</td>
<td class="instruction">LD HL,32755</td>
<td class="comment-1" rowspan="1"><a href="32755.html">32755</a> holds ERIC's main action timer</td>
</tr>
<tr>
<td class="address-1"><span id="29465"></span>29465</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Is it time to deal with ERIC yet?</td>
</tr>
<tr>
<td class="address-1"><span id="29466"></span>29466</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="29467"></span>29467</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Set ERIC's action timer to 1, ensuring that we pass through the following section of code on the next call to this routine if no keypress is detected this time</td>
</tr>
<tr>
<td class="address-1"><span id="29468"></span>29468</td>
<td class="instruction">CALL <a href="29178.html">29178</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=value from the <a href="58624.html">keypress offset table</a> corresponding to the key just pressed (if any)</td>
</tr>
<tr>
<td class="address-1"><span id="29471"></span>29471</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if no game key was pressed</td>
</tr>
<tr>
<td class="address-1"><span id="29472"></span>29472</td>
<td class="instruction">LD HL,32755</td>
<td class="comment-1" rowspan="1"><a href="32755.html">32755</a> holds ERIC's main action timer</td>
</tr>
<tr>
<td class="address-1"><span id="29475"></span>29475</td>
<td class="instruction">CP 114</td>
<td class="comment-1" rowspan="1">Was 'jump' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="29477"></span>29477</td>
<td class="instruction">JR Z,29517</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29479"></span>29479</td>
<td class="instruction">SET 3,A</td>
<td class="comment-1" rowspan="1">Ignore the difference between fast (upper case) and slow (lower case) keys when ERIC's on the bike</td>
</tr>
<tr>
<td class="address-1"><span id="29481"></span>29481</td>
<td class="instruction">CP 92</td>
<td class="comment-1" rowspan="1">Was 'up' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="29483"></span>29483</td>
<td class="instruction">JR Z,29517</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29485"></span>29485</td>
<td class="instruction">CP 94</td>
<td class="comment-1" rowspan="1">Was 'down' pressed?</td>
</tr>
<tr>
<td class="address-1"><span id="29487"></span>29487</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29488"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29574.html">29574</a> when ERIC has just got on the bike.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29488"></span>29488</td>
<td class="instruction">LD (HL),5</td>
<td class="comment-1" rowspan="1">Reset ERIC's main action timer at <a href="32755.html">32755</a> to 5</td>
</tr>
<tr>
<td class="address-1"><span id="29490"></span>29490</td>
<td class="instruction">LD L,237</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="32749.html">32749</a> (ERIC's status flags)</td>
</tr>
<tr>
<td class="address-1"><span id="29492"></span>29492</td>
<td class="instruction">LD (HL),1</td>
<td class="comment-1" rowspan="1">Set bit 0: ERIC is riding the bike</td>
</tr>
<tr>
<td class="address-1"><span id="29494"></span>29494</td>
<td class="instruction">LD H,210</td>
<td class="comment-1" rowspan="1">210=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="29496"></span>29496</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="29499"></span>29499</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=211: bike</td>
</tr>
<tr>
<td class="address-1"><span id="29500"></span>29500</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the bike's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="29503"></span>29503</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of the bike's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29505"></span>29505</td>
<td class="instruction">LD (HL),224</td>
<td class="comment-1" rowspan="1">Set the bike's x-coordinate to 224 (out of sight)</td>
</tr>
<tr>
<td class="address-1"><span id="29507"></span>29507</td>
<td class="instruction">LD L,18</td>
<td class="comment-1" rowspan="2">Remove the address of the routine at <a href="29194.html">29194</a> from bytes 17 and 18 of the bike's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29509"></span>29509</td>
<td class="instruction">LD (HL),0</td>
</tr>
<tr>
<td class="address-1"><span id="29511"></span>29511</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=210: ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="29512"></span>29512</td>
<td class="instruction">SUB 12</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=animatory state of ERIC riding the bike</td>
</tr>
<tr>
<td class="address-1"><span id="29514"></span>29514</td>
<td class="instruction">JP <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update ERIC's animatory state and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29517"></span>
<div class="comments">
<div class="paragraph">
ERIC has tried to jump off the saddle of the bike. Check whether he has the frog and is underneath a cup.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29517"></span>29517</td>
<td class="instruction">LD H,210</td>
<td class="comment-1" rowspan="1">210=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="29519"></span>29519</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for ERIC's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="29522"></span>29522</td>
<td class="instruction">ADD A,2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="../graphics/as.html#2">2 or 130</a></td>
</tr>
<tr>
<td class="address-1"><span id="29524"></span>29524</td>
<td class="instruction">DEC D</td>
<td class="comment-1" rowspan="2">Set <span class="register">D</span> to the y-coordinate of the spot above ERIC's hand as he jumps from the saddle</td>
</tr>
<tr>
<td class="address-1"><span id="29525"></span>29525</td>
<td class="instruction">DEC D</td>
</tr>
<tr>
<td class="address-1"><span id="29526"></span>29526</td>
<td class="instruction">CALL <a href="64460.html#64474">64474</a></td>
<td class="comment-1" rowspan="1">Prepare ERIC for his descent from the bike saddle</td>
</tr>
<tr>
<td class="address-1"><span id="29529"></span>29529</td>
<td class="instruction">LD H,210</td>
<td class="comment-1" rowspan="1">210=ERIC</td>
</tr>
<tr>
<td class="address-1"><span id="29531"></span>29531</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="29532"></span>29532</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0 of ERIC's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29533"></span>29533</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is ERIC facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="29535"></span>29535</td>
<td class="instruction">JR Z,29539</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29537"></span>29537</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="29539"></span>29539</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of ERIC's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29540"></span>29540</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of ERIC's hand</td>
</tr>
<tr>
<td class="address-1"><span id="29541"></span>29541</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Now <span class="register">DE</span>=coordinates of the spot above ERIC's hand</td>
</tr>
<tr>
<td class="address-1"><span id="29542"></span>29542</td>
<td class="instruction">LD HL,32747</td>
<td class="comment-1" rowspan="1"><a href="32747.html">32747</a> holds the inventory flags</td>
</tr>
<tr>
<td class="address-1"><span id="29545"></span>29545</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Has ERIC got the frog?</td>
</tr>
<tr>
<td class="address-1"><span id="29547"></span>29547</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="29548"></span>29548</td>
<td class="instruction">CALL <a href="30205.html#30216">30216</a></td>
<td class="comment-1" rowspan="1">Is ERIC's arm directly underneath a cup?</td>
</tr>
<tr>
<td class="address-1"><span id="29551"></span>29551</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="29552"></span>29552</td>
<td class="instruction">RES 2,(HL)</td>
<td class="comment-1" rowspan="1">Signal: ERIC no longer has the frog</td>
</tr>
<tr>
<td class="address-1"><span id="29554"></span>29554</td>
<td class="instruction">LD H,212</td>
<td class="comment-1" rowspan="1">212=frog</td>
</tr>
<tr>
<td class="address-1"><span id="29556"></span>29556</td>
<td class="instruction">LD A,28</td>
<td class="comment-1" rowspan="1"><a href="../graphics/as.html#28">28</a>: frog sitting (as on the floor or in a cup)</td>
</tr>
<tr>
<td class="address-1"><span id="29558"></span>29558</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="2">Set <span class="register">DE</span> to the frog's new in-cup coordinates</td>
</tr>
<tr>
<td class="address-1"><span id="29559"></span>29559</td>
<td class="instruction">LD D,11</td>
</tr>
<tr>
<td class="address-1"><span id="29561"></span>29561</td>
<td class="instruction">CALL <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the frog's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="address-1"><span id="29564"></span>29564</td>
<td class="instruction">JP <a href="62178.html#62401">62401</a></td>
<td class="comment-1" rowspan="1">Print the inventory and make a celebratory sound effect</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29278.html">29278</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29462">Map</a></td>
<td class="next">
Next: <a href="29567.html">29567</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20200811</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/7316.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>