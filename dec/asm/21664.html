<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 21664</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="21494.html">21494</a></span></td>
<td class="up">Up: <a href="../maps/all.html#21664">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="21746.html">21746</a></span></td>
</tr>
</table>
<div class="description">21664: Set the input method, change the characters' names, and start the game</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from <a href="21425.html">21425</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="21664"></span>21664</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="29118.html#29154">29154</a></td>
<td class="comment-11" rowspan="2">Wait for a keypress, and collect its ASCII code in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21667"></span>21667</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,21664</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21669"></span>21669</td>
<td class="bytes-0"></td>
<td class="instruction">OR 32</td>
<td class="comment-11" rowspan="1">Convert the keypress to lower case</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21671"></span>21671</td>
<td class="bytes-0"></td>
<td class="instruction">CP 99</td>
<td class="comment-11" rowspan="1">Was 'c' (Cursor) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21673"></span>21673</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,21705</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21675"></span>21675</td>
<td class="bytes-0"></td>
<td class="instruction">CP 110</td>
<td class="comment-11" rowspan="1">Was 'n' (None) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21677"></span>21677</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,21705</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21679"></span>21679</td>
<td class="bytes-0"></td>
<td class="instruction">CP 107</td>
<td class="comment-11" rowspan="1">Was 'k' (Kempston) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21681"></span>21681</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,21690</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21683"></span>21683</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="2">Set <a href="32748.html">32748</a> to 1: using Kempston</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21685"></span>21685</td>
<td class="bytes-0"></td>
<td class="instruction">LD (32748),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21688"></span>21688</td>
<td class="bytes-0"></td>
<td class="instruction">JR 21705</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="21690"></span>21690</td>
<td class="bytes-0"></td>
<td class="instruction">CP 105</td>
<td class="comment-11" rowspan="1">Was 'i' (Int2) pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21692"></span>21692</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,21664</td>
<td class="comment-11" rowspan="1">Jump back to wait for another keypress if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21694"></span>21694</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,21494</td>
<td class="comment-11" rowspan="4">Copy the 10-byte table at <a href="21494.html">21494</a> into the keypress offset table at <a href="58624.html">58624</a> if Int2 is being used</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21697"></span>21697</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,58624</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21700"></span>21700</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,10</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21703"></span>21703</td>
<td class="bytes-0"></td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="21705"></span>
<div class="comments">
<div class="paragraph">
The input method has been established. Now prepare the screen for the cast of characters.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="21705"></span>21705</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,46849</td>
<td class="comment-11" rowspan="9">Draw a line (the catwalk) across the screen, and set byte 1 of each character's buffer (which holds the character's x-coordinate) to a number between 1 and 32 (so that they are off-screen: the column of the play area at the far left of the screen, stored at <a href="32767.html">32767</a>, was set to 128 earlier on)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21708"></span>21708</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,18560</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21711"></span>21711</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21713"></span>21713</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,255</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="21715"></span>21715</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21716"></span>21716</td>
<td class="bytes-0"></td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21717"></span>21717</td>
<td class="bytes-0"></td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21718"></span>21718</td>
<td class="bytes-0"></td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21719"></span>21719</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ 21715</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21721"></span>21721</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,53762</td>
<td class="comment-11" rowspan="2">Set byte 2 of ERIC's character buffer (which holds his y-coordinate) to 8; this will be the y-coordinate of the characters as they proceed along the catwalk</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21724"></span>21724</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21726"></span>21726</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,248</td>
<td class="comment-11" rowspan="1">Message <a href="22223.html">248</a>: 'THE CHARACTERS'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21728"></span>21728</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,16448</td>
<td class="comment-11" rowspan="2">Print this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21731"></span>21731</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="20665.html#20668">20668</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21734"></span>21734</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="21152.html">21152</a></td>
<td class="comment-11" rowspan="1">Display the main characters and let the user change their names</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="21737"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="21920.html">21920</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="21737"></span>21737</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,20650</td>
<td class="comment-11" rowspan="2">Do the POKEs specified by the table at <a href="20650.html">20650</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21740"></span>21740</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="21408.html">21408</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="21743"></span>21743</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="63189.html">63189</a></td>
<td class="comment-11" rowspan="1">Start the game</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="21494.html">21494</a></span></td>
<td class="up">Up: <a href="../maps/all.html#21664">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="21746.html">21746</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20190617</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/54A0.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>