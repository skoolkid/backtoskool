<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 25700</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25699.html">25699</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25700">Map</a></td>
<td class="next">
Next: <a href="25812.html">25812</a>
</td>
</tr>
</table>
<div class="description">25700: Make a character go to a location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by command lists <a href="51516.html">0</a>, <a href="51772.html">2</a>, <a href="52028.html">4</a>, <a href="52284.html">6</a>, <a href="52540.html">8</a>, <a href="52796.html">10</a>, <a href="53052.html">12</a>, <a href="53308.html">14</a>, <a href="53564.html">16</a>, <a href="57942.html">20</a>, <a href="58368.html">22</a>, <a href="58880.html">24</a>, <a href="59136.html">26</a>, <a href="57956.html">28</a>, <a href="57970.html">30</a>, <a href="58768.html">32</a>, <a href="58779.html">34</a>, <a href="58798.html">36</a>, <a href="58813.html">38</a>, <a href="59151.html">40</a>, <a href="58844.html">44</a>, <a href="59488.html">46</a>, <a href="59499.html">48</a>, <a href="59519.html">50</a>, <a href="59530.html">52</a>, <a href="59550.html">54</a>, <a href="59584.html">56</a>, <a href="59612.html">58</a>, <a href="59629.html">60</a>, <a href="59646.html">62</a>, <a href="59663.html">64</a>, <a href="59673.html">66</a>, <a href="59681.html">70</a>, <a href="59699.html">72</a>, <a href="59715.html">74</a>, <a href="59724.html">76</a>, <a href="59765.html">78</a>, <a href="59788.html">80</a>, <a href="59801.html">82</a>, <a href="59812.html">84</a>, <a href="59823.html">86</a> and <a href="58862.html">88</a> to make a character go to a specified place.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (183-209)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="25700"></span>25700</td>
<td class="instruction">LD L,5</td>
<td class="comment-1" rowspan="2">Copy the destination coordinates from the command list into bytes 5 and 6 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25702"></span>25702</td>
<td class="instruction">CALL <a href="25188.html">25188</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25705"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="25815.html">25815</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25705"></span>25705</td>
<td class="instruction">LD L,3</td>
<td class="comment-1" rowspan="2">Replace the address of this routine in bytes 3 and 4 of the character's buffer with <a href="25700.html#25726">25726</a> (below)</td>
</tr>
<tr>
<td class="address-1"><span id="25707"></span>25707</td>
<td class="instruction">LD (HL),126</td>
</tr>
<tr>
<td class="address-1"><span id="25709"></span>25709</td>
<td class="instruction">LD L,0</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25711"></span>25711</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="25712"></span>25712</td>
<td class="instruction">AND 7</td>
<td class="comment-1" rowspan="2">Is the character sitting on a chair (kids only)?</td>
</tr>
<tr>
<td class="address-1"><span id="25714"></span>25714</td>
<td class="instruction">CP 4</td>
</tr>
<tr>
<td class="address-1"><span id="25716"></span>25716</td>
<td class="instruction">JR NZ,25726</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25718"></span>
<div class="comments">
<div class="paragraph">
The character is sitting on a chair. He'll have to stand up first.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25718"></span>25718</td>
<td class="instruction">CALL <a href="25012.html">25012</a></td>
<td class="comment-1" rowspan="1">Update the SRB for the character's current animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="25721"></span>25721</td>
<td class="instruction">AND 248</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=animatory state of the character standing up</td>
</tr>
<tr>
<td class="address-1"><span id="25723"></span>25723</td>
<td class="instruction">JP <a href="24880.html">24880</a></td>
<td class="comment-1" rowspan="1">Update the character's animatory state and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25726"></span>
<div class="comments">
<div class="paragraph">
The second and subsequent calls to this routine (from <a href="25296.html">25296</a>) enter here:
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25726"></span>25726</td>
<td class="instruction">LD L,6</td>
<td class="comment-1" rowspan="4">Collect the destination coordinates into <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="25728"></span>25728</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25729"></span>25729</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="25730"></span>25730</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25731"></span>25731</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25733"></span>25733</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=destination x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25734"></span>25734</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the character's current x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25735"></span>25735</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="address-1"><span id="25736"></span>25736</td>
<td class="instruction">JR NZ,25743</td>
<td class="comment-1" rowspan="1">Jump forward unless the character's current x-coordinate matches that of the destination</td>
</tr>
<tr>
<td class="address-1"><span id="25738"></span>25738</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=destination y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25739"></span>25739</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the character already at his destination?</td>
</tr>
<tr>
<td class="address-1"><span id="25740"></span>25740</td>
<td class="instruction">JP Z,<a href="25484.html">25484</a></td>
<td class="comment-1" rowspan="1">Move to the next command in the command list if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25743"></span>
<div class="comments">
<div class="paragraph">
The character hasn't reached his destination yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25743"></span>25743</td>
<td class="instruction">CALL <a href="25554.html">25554</a></td>
<td class="comment-1" rowspan="1">Get the region identifier for the character's destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25746"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">A</span> holds a region ID (189-196) corresponding to the character's destination:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">Region</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">Top floor, left of the left study door in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">190</td>
<td class="" colspan="1" rowspan="1">Middle floor, left of the far wall of the Science Lab storeroom</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">Bottom floor (anywhere)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">192</td>
<td class="" colspan="1" rowspan="1">Assembly hall stage</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">Near the middle-floor window in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">194</td>
<td class="" colspan="1" rowspan="1">Top floor, right of the left study door in the boys' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">Middle floor, girls' skool</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">Top floor, girls' skool</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25746"></span>25746</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="3">Collect the character's current coordinates into <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="25747"></span>25747</td>
<td class="instruction">DEC L</td>
</tr>
<tr>
<td class="address-1"><span id="25748"></span>25748</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="25749"></span>25749</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=destination region ID (189-196)</td>
</tr>
<tr>
<td class="address-1"><span id="25750"></span>25750</td>
<td class="instruction">CALL <a href="25554.html">25554</a></td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=region ID (189-196) for the character's current location</td>
</tr>
<tr>
<td class="address-1"><span id="25753"></span>25753</td>
<td class="instruction">CP L</td>
<td class="comment-1" rowspan="1">Will the character have to negotiate any staircases in order to reach his destination?</td>
</tr>
<tr>
<td class="address-1"><span id="25754"></span>25754</td>
<td class="instruction">JR Z,25800</td>
<td class="comment-1" rowspan="1">Jump if not (he's in the same region as his destination)</td>
</tr>
<tr>
<td class="address-1"><span id="25756"></span>25756</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=region ID of the character's current location (189-196)</td>
</tr>
<tr>
<td class="address-1"><span id="25757"></span>25757</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=destination region ID (189-196)</td>
</tr>
<tr>
<td class="address-1"><span id="25758"></span>25758</td>
<td class="instruction">SUB 129</td>
<td class="comment-1" rowspan="2"><span class="register">E</span>=destination region ID minus 129 (60-67)</td>
</tr>
<tr>
<td class="address-1"><span id="25760"></span>25760</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="25761"></span>25761</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Collect the appropriate staircase endpoint identifier</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25762"></span>
<div class="comments">
<div class="paragraph">
<span id="staircaseMatrix" /> The staircase endpoint identifiers are arranged in bytes 60-67 (corresponding to the destination) of pages 189-196 (corresponding to the current location) as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<td class="transparent" colspan="2" rowspan="1"></td>
<th colspan="1" rowspan="1">189</th>
<th colspan="1" rowspan="1">190</th>
<th colspan="1" rowspan="1">191</th>
<th colspan="1" rowspan="1">192</th>
<th colspan="1" rowspan="1">193</th>
<th colspan="1" rowspan="1">194</th>
<th colspan="1" rowspan="1">195</th>
<th colspan="1" rowspan="1">196</th>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="48444.html">48444</a></td>
<th colspan="1" rowspan="1">189</th>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
<td class="" colspan="1" rowspan="1">189</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="48700.html">48700</a></td>
<th colspan="1" rowspan="1">190</th>
<td class="" colspan="1" rowspan="1">190</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
<td class="" colspan="1" rowspan="1">191</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="48956.html">48956</a></td>
<th colspan="1" rowspan="1">191</th>
<td class="" colspan="1" rowspan="1">192</td>
<td class="" colspan="1" rowspan="1">192</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">193</td>
<td class="" colspan="1" rowspan="1">194</td>
<td class="" colspan="1" rowspan="1">194</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="49212.html">49212</a></td>
<th colspan="1" rowspan="1">192</th>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">196</td>
<td class="" colspan="1" rowspan="1">195</td>
<td class="" colspan="1" rowspan="1">195</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="49468.html">49468</a></td>
<th colspan="1" rowspan="1">193</th>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">198</td>
<td class="" colspan="1" rowspan="1">197</td>
<td class="" colspan="1" rowspan="1">197</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="49724.html">49724</a></td>
<th colspan="1" rowspan="1">194</th>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">199</td>
<td class="" colspan="1" rowspan="1">199</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="49980.html">49980</a></td>
<th colspan="1" rowspan="1">195</th>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="" colspan="1" rowspan="1">200</td>
<td class="transparent" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">206</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"><a href="50236.html">50236</a></td>
<th colspan="1" rowspan="1">196</th>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="" colspan="1" rowspan="1">207</td>
<td class="transparent" colspan="1" rowspan="1"></td>
</tr>
</table>
</div>
<div class="paragraph">
<span id="staircases" /> The staircase endpoint indentifier now in <span class="register">A</span> (189-200, 206 or 207) corresponds to the top or bottom of the first staircase the character will have to negotiate in order to reach his destination. The x-coordinate (x), direction indicator (d), appropriate routine address LSB (56 for <a href="25656.html">25656</a>, 77 for <a href="25677.html">25677</a>) and number of steps (n) for the staircase can be found in bytes 68-71 of pages 189-200 and 206-207, as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">ID</th>
<th colspan="1" rowspan="1">x</th>
<th colspan="1" rowspan="1">d</th>
<th colspan="1" rowspan="1">LSB</th>
<th colspan="1" rowspan="1">n</th>
<th colspan="1" rowspan="1">Staircase endpoint</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="48452.html">189</a></td>
<td class="centre" colspan="1" rowspan="1">26</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the Revision Library</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="48708.html">190</a></td>
<td class="centre" colspan="1" rowspan="1">19</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the Revision Library</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="48964.html">191</a></td>
<td class="centre" colspan="1" rowspan="1">15</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the bottom floor on the far left of the boys' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="49220.html">192</a></td>
<td class="centre" colspan="1" rowspan="1">22</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the middle floor on the far left of the boys' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="49476.html">193</a></td>
<td class="centre" colspan="1" rowspan="1">83</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="49732.html">194</a></td>
<td class="centre" colspan="1" rowspan="1">176</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the middle floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="49988.html">195</a></td>
<td class="centre" colspan="1" rowspan="1">80</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="50244.html">196</a></td>
<td class="centre" colspan="1" rowspan="1">81</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up from the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="50500.html">197</a></td>
<td class="centre" colspan="1" rowspan="1">85</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the assembly hall stage</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="50756.html">198</a></td>
<td class="centre" colspan="1" rowspan="1">91</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the head's study</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="51012.html">199</a></td>
<td class="centre" colspan="1" rowspan="1">84</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down from the head's study</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="51268.html">200</a></td>
<td class="centre" colspan="1" rowspan="1">183</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to the bottom floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="52804.html">206</a></td>
<td class="centre" colspan="1" rowspan="1">186</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">56</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Bottom of the staircase leading up to the top floor in the girls' skool</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="53060.html">207</a></td>
<td class="centre" colspan="1" rowspan="1">179</td>
<td class="centre" colspan="1" rowspan="1">128</td>
<td class="centre" colspan="1" rowspan="1">77</td>
<td class="" colspan="1" rowspan="1">8</td>
<td class="" colspan="1" rowspan="1">Top of the staircase leading down to middle floor in the girls' skool</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25762"></span>25762</td>
<td class="instruction">LD D,A</td>
<td class="comment-1" rowspan="1">Place the staircase endpoint identifier in <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="25763"></span>25763</td>
<td class="instruction">LD E,68</td>
<td class="comment-1" rowspan="1">Byte 68 holds the x-coordinate of the top or bottom of the staircase identified by <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="25765"></span>25765</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="2">Point <span class="register">DE</span> at byte 1 of the character's buffer, and <span class="register">HL</span> at the staircase endpoint x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25767"></span>25767</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="25768"></span>25768</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's current x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25769"></span>25769</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Is the character already at the top or bottom of the appropriate staircase?</td>
</tr>
<tr>
<td class="address-1"><span id="25770"></span>25770</td>
<td class="instruction">JR NZ,25796</td>
<td class="comment-1" rowspan="1">Jump forward if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25772"></span>
<div class="comments">
<div class="paragraph">
At this stage the character is standing at the top or bottom of the first staircase he will have to negotiate in order to reach his destination.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="25772"></span>25772</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">(<span class="register">HL</span>)=0 if the character has to face left to ascend or descend the stairs, 128 otherwise</td>
</tr>
<tr>
<td class="address-1"><span id="25773"></span>25773</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="25774"></span>25774</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="25775"></span>25775</td>
<td class="instruction">XOR (HL)</td>
<td class="comment-1" rowspan="2">Set the carry flag if the character has to turn round to negotiate the staircase</td>
</tr>
<tr>
<td class="address-1"><span id="25776"></span>25776</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="25777"></span>25777</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> so that <span class="register">H</span> holds the character number</td>
</tr>
<tr>
<td class="address-1"><span id="25778"></span>25778</td>
<td class="instruction">JP C,<a href="25581.html#25648">25648</a></td>
<td class="comment-1" rowspan="1">Turn the character round if he's facing the wrong way</td>
</tr>
<tr>
<td class="address-1"><span id="25781"></span>25781</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> back again</td>
</tr>
<tr>
<td class="address-1"><span id="25782"></span>25782</td>
<td class="instruction">LD E,11</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25784"></span>25784</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=70</td>
</tr>
<tr>
<td class="address-1"><span id="25785"></span>25785</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="2"><span class="register">BC</span>=<a href="25656.html">25656</a> if the stairs are to be ascended, <a href="25677.html">25677</a> if descended</td>
</tr>
<tr>
<td class="address-1"><span id="25786"></span>25786</td>
<td class="instruction">LD B,100</td>
</tr>
<tr>
<td class="address-1"><span id="25788"></span>25788</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="25789"></span>25789</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=71</td>
</tr>
<tr>
<td class="address-1"><span id="25790"></span>25790</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=1 + number of steps in the staircase</td>
</tr>
<tr>
<td class="address-1"><span id="25791"></span>25791</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Place this number of steps in byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25792"></span>25792</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Swap <span class="register">DE</span> and <span class="register">HL</span> so that <span class="register">H</span> holds the character number</td>
</tr>
<tr>
<td class="address-1"><span id="25793"></span>25793</td>
<td class="instruction">JP <a href="25520.html">25520</a></td>
<td class="comment-1" rowspan="1">Copy the interruptible subcommand routine address from <span class="register">BC</span> into bytes 9 and 10 of the character's buffer and jump to it</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25796"></span>
<div class="comments">
<div class="paragraph">
The character is not yet at the top or bottom of the appropriate staircase.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25796"></span>25796</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of the top or bottom of the staircase</td>
</tr>
<tr>
<td class="address-1"><span id="25797"></span>25797</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="25798"></span>25798</td>
<td class="instruction">JR 25803</td>
<td class="comment-1" rowspan="1">Send the character towards the staircase</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="25800"></span>
<div class="comments">
<div class="paragraph">
The character can reach his destination without negotiating any staircases.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="25800"></span>25800</td>
<td class="instruction">LD L,5</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 5 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25802"></span>25802</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of the character's destination</td>
</tr>
<tr>
<td class="address-2"><span id="25803"></span>25803</td>
<td class="instruction">LD L,11</td>
<td class="comment-1" rowspan="2">Place the x-coordinate of the top or bottom of the staircase, or the destination, into byte 11 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="25805"></span>25805</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="25806"></span>25806</td>
<td class="instruction">LD BC,25581</td>
<td class="comment-1" rowspan="2">Place the address of the interruptible subcommand routine at <a href="25581.html">25581</a> into bytes 9 and 10 of the character's buffer and jump to it, thus guiding the character to this x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="25809"></span>25809</td>
<td class="instruction">JP <a href="25520.html">25520</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="25699.html">25699</a>
</td>
<td class="up">Up: <a href="../maps/all.html#25700">Map</a></td>
<td class="next">
Next: <a href="25812.html">25812</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20221122</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/6464.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>