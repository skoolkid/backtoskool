<!DOCTYPE html>
<html>
<head>
<title>Back to Skool: Routine at 23831</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="load-Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Back to Skool" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Load routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
</td>
<td class="up">Up: <a href="load.html#23831">Map</a></td>
<td class="next">
Next: <a href="32768.html">32768</a>
</td>
</tr>
</table>
<div class="description">23831: After the program 'bak2skool' has loaded, this is where it all starts...</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
<table class="">
<tr>
<td class="" colspan="1" rowspan="1"><img alt="loader" src="../../images/scr/loader.png" /></td>
<td class="" colspan="1" rowspan="1">This is the initial loader program for Back to Skool (as it appears after doing 'POKE 23762,0' to change the INK for the BASIC listing from white to black). Don't be fooled by the 'RANDOMIZE USR 23794': the floating point number stored underneath is actually 23831.</td>
</tr>
</table>
</div>
<div class="paragraph">
Entering the code here from BASIC means that <span class="register">C</span>=23 (the LSB of 23831); this value is used later on in the routine at <a href="32815.html">32815</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="23831"></span>23831</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts</td>
</tr>
<tr>
<td class="address-1"><span id="23832"></span>23832</td>
<td class="instruction">LD B,49</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="23834"></span>23834</td>
<td class="instruction">LD DE,65487</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="23837"></span>23837</td>
<td class="instruction">CALL 24046</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="24046"></span>
<div class="comments">
<div class="paragraph">
And so begins the misdirection.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="24046"></span>24046</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23840</td>
</tr>
<tr>
<td class="address-1"><span id="24047"></span>24047</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23791</td>
</tr>
<tr>
<td class="address-1"><span id="24048"></span>24048</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="24049"></span>24049</td>
<td class="instruction">LD DE,7</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="24052"></span>24052</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23798</td>
</tr>
<tr>
<td class="address-1"><span id="24053"></span>24053</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Jump to 23791</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="23791"></span>
<div class="comments">
<div class="paragraph">
Undo some code obfuscation before continuing.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="23791"></span>23791</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="6">Do some XOR-ing on the 49 bytes from 23798 to 23846</td>
</tr>
<tr>
<td class="address-1"><span id="23792"></span>23792</td>
<td class="instruction">XOR H</td>
</tr>
<tr>
<td class="address-1"><span id="23793"></span>23793</td>
<td class="instruction">XOR L</td>
</tr>
<tr>
<td class="address-1"><span id="23794"></span>23794</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="23795"></span>23795</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="23796"></span>23796</td>
<td class="instruction">DJNZ 23791</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="23798"></span>
<div class="comments">
<div class="paragraph">
After the XOR-ing:
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="23798"></span>23798</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="23799"></span>23799</td>
<td class="instruction">EX (SP),HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL'</span>=11563</td>
</tr>
<tr>
<td class="address-1"><span id="23800"></span>23800</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=45</td>
</tr>
<tr>
<td class="address-1"><span id="23801"></span>23801</td>
<td class="instruction">AND L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=41</td>
</tr>
<tr>
<td class="address-1"><span id="23802"></span>23802</td>
<td class="instruction">ADD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=84</td>
</tr>
<tr>
<td class="address-1"><span id="23803"></span>23803</td>
<td class="instruction">ADD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=127</td>
</tr>
<tr>
<td class="address-1"><span id="23804"></span>23804</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1"><span class="register">H'</span>=127</td>
</tr>
<tr>
<td class="address-1"><span id="23805"></span>23805</td>
<td class="instruction">ADD A,78</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=205</td>
</tr>
<tr>
<td class="address-1"><span id="23807"></span>23807</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">HL'</span>=32717</td>
</tr>
<tr>
<td class="address-1"><span id="23808"></span>23808</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="23809"></span>23809</td>
<td class="instruction">LD HL,23551</td>
<td class="comment-1" rowspan="5">INK 1: PAPER 1</td>
</tr>
<tr>
<td class="address-2"><span id="23812"></span>23812</td>
<td class="instruction">LD (HL),9</td>
</tr>
<tr>
<td class="address-1"><span id="23814"></span>23814</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="23815"></span>23815</td>
<td class="instruction">BIT 3,H</td>
</tr>
<tr>
<td class="address-1"><span id="23817"></span>23817</td>
<td class="instruction">JR NZ,23812</td>
</tr>
<tr>
<td class="address-2"><span id="23819"></span>23819</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-1" rowspan="4">Clear the display file</td>
</tr>
<tr>
<td class="address-1"><span id="23821"></span>23821</td>
<td class="instruction">DEC HL</td>
</tr>
<tr>
<td class="address-1"><span id="23822"></span>23822</td>
<td class="instruction">BIT 6,H</td>
</tr>
<tr>
<td class="address-1"><span id="23824"></span>23824</td>
<td class="instruction">JR NZ,23819</td>
</tr>
<tr>
<td class="address-1"><span id="23826"></span>23826</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span>=9</td>
</tr>
<tr>
<td class="address-1"><span id="23827"></span>23827</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address-1"><span id="23828"></span>23828</td>
<td class="instruction">CALL 24046</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="24046"></span>
<div class="comments">
<div class="paragraph">
More misdirection.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="24046"></span>24046</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23831</td>
</tr>
<tr>
<td class="address-1"><span id="24047"></span>24047</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23840</td>
</tr>
<tr>
<td class="address-1"><span id="24048"></span>24048</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="24049"></span>24049</td>
<td class="instruction">LD DE,7</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="24052"></span>24052</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23847</td>
</tr>
<tr>
<td class="address-1"><span id="24053"></span>24053</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Jump to 23840</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="23840"></span>
<div class="comments">
<div class="paragraph">
Undo some more code obfuscation before continuing.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="23840"></span>23840</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="6">Do some XOR-ing and RLC-ing on the 217 bytes from 23847 to 24063</td>
</tr>
<tr>
<td class="address-1"><span id="23841"></span>23841</td>
<td class="instruction">XOR E</td>
</tr>
<tr>
<td class="address-1"><span id="23842"></span>23842</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="23843"></span>23843</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="23844"></span>23844</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="23845"></span>23845</td>
<td class="instruction">JR NZ,23840</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="23847"></span>
<div class="comments">
<div class="paragraph">
After the XOR-ing and RLC-ing:
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="23847"></span>23847</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=23808</td>
</tr>
<tr>
<td class="address-1"><span id="23848"></span>23848</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="23849"></span>23849</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1"><span class="register">DE'</span>=23808</td>
</tr>
<tr>
<td class="address-1"><span id="23850"></span>23850</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">DE'</span>=32717</td>
</tr>
<tr>
<td class="address-1"><span id="23851"></span>23851</td>
<td class="instruction">LD BC,255</td>
<td class="comment-1" rowspan="2">Copy 255 bytes from 23808-24062 to 32717-32971</td>
</tr>
<tr>
<td class="address-1"><span id="23854"></span>23854</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="address-1"><span id="23856"></span>23856</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1"><span class="register">E'</span>=47</td>
</tr>
<tr>
<td class="address-1"><span id="23857"></span>23857</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">HL'</span>=32815</td>
</tr>
<tr>
<td class="address-1"><span id="23858"></span>23858</td>
<td class="instruction">JP (HL)</td>
<td class="comment-1" rowspan="1">Jump to <a href="32815.html">32815</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
</td>
<td class="up">Up: <a href="load.html#23831">Map</a></td>
<td class="next">
Next: <a href="32768.html">32768</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Back to Skool RAM disassembly 20200811</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../load/5D17.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>